<!DOCTYPE html><html><head>
      <title>fullbook</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0-rc.1/dist/katex.min.css">
      
      
      
      
      
      
      
      
      

      <style> 
      /* http://prismjs.com/download.html?themes=prism&languages=markup+css+clike+javascript+abap+actionscript+ada+apacheconf+apl+applescript+asciidoc+aspnet+autoit+autohotkey+bash+basic+batch+c+brainfuck+bro+bison+csharp+cpp+coffeescript+ruby+css-extras+d+dart+django+diff+docker+eiffel+elixir+erlang+fsharp+fortran+gherkin+git+glsl+go+graphql+groovy+haml+handlebars+haskell+haxe+http+icon+inform7+ini+j+jade+java+jolie+json+julia+keyman+kotlin+latex+less+livescript+lolcode+lua+makefile+markdown+matlab+mel+mizar+monkey+nasm+nginx+nim+nix+nsis+objectivec+ocaml+oz+parigp+parser+pascal+perl+php+php-extras+powershell+processing+prolog+properties+protobuf+puppet+pure+python+q+qore+r+jsx+reason+rest+rip+roboconf+crystal+rust+sas+sass+scss+scala+scheme+smalltalk+smarty+sql+stylus+swift+tcl+textile+twig+typescript+vbnet+verilog+vhdl+vim+wiki+xojo+yaml */
/**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #a67f59;
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}html body{font-family:"Helvetica Neue",Helvetica,"Segoe UI",Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ul,html body>ol{margin-bottom:16px}html body ul,html body ol{padding-left:2em}html body ul.no-list,html body ol.no-list{padding:0;list-style-type:none}html body ul ul,html body ul ol,html body ol ol,html body ol ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:bold;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:bold}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em !important;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::before,html body code::after{letter-spacing:-0.2em;content:"\00a0"}html body pre>code{padding:0;margin:0;font-size:.85em !important;word-break:normal;white-space:pre;background:transparent;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;font-size:.85em !important;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:before,html body pre tt:before,html body pre code:after,html body pre tt:after{content:normal}html body p,html body blockquote,html body ul,html body ol,html body dl,html body pre{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body pre,html body code{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview .pagebreak,.markdown-preview .newpage{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center !important}.markdown-preview:not([for="preview"]) .code-chunk .btn-group{display:none}.markdown-preview:not([for="preview"]) .code-chunk .status{display:none}.markdown-preview:not([for="preview"]) .code-chunk .output-div{margin-bottom:16px}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0}@media screen and (min-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px)}}@media screen and (max-width:914px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode]) .markdown-preview{font-size:14px !important;padding:1em}}@media print{html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for="html-export"]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,0.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,0.66);border:4px solid rgba(150,150,150,0.66);background-clip:content-box}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{padding:0 1.6em;margin-top:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc li{margin-bottom:.8em}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc ul{list-style-type:none}html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% -  300px);padding:2em calc(50% - 457px -  150px);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for="html-export"]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for="html-export"]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
 
      </style>
    </head>
    <body for="html-export">
      <div class="mume markdown-preview   ">
      <p style="font-size:40pt;font-weight:bold">
A Course in Data Structures and Object-Oriented Design
</p>
<p style="font-size:20pt;font-weight:bold">
by Don Sheehy
</p>
<p style="page-break-after:always;"></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#basic-python">Basic Python</a>
<ul>
<li><a href="#sequence-selection-and-iteration">Sequence, Selection, and Iteration</a></li>
<li><a href="#expressions-and-evaluation">Expressions and Evaluation</a></li>
<li><a href="#variables-types-and-state">Variables, Types,  and State</a></li>
<li><a href="#collections">Collections</a>
<ul>
<li><a href="#strings-str">Strings  (<code>str</code>)</a></li>
<li><a href="#lists-list">Lists (<code>list</code>)</a></li>
<li><a href="#tuples-tuple">Tuples (<code>tuple</code>)</a></li>
<li><a href="#dictionaries-dict">Dictionaries (<code>dict</code>)</a></li>
<li><a href="#sets-set">Sets (<code>set</code>)</a></li>
</ul>
</li>
<li><a href="#some-common-things-to-do-with-collections">Some common things to do with collections</a></li>
<li><a href="#iterating-over-a-collection">Iterating over a collection</a></li>
<li><a href="#other-forms-of-control-flow">Other Forms of Control Flow</a></li>
<li><a href="#modules-and-imports">Modules and Imports</a></li>
</ul>
</li>
<li><a href="#object-oriented-programming">Object-Oriented Programming</a>
<ul>
<li><a href="#a-simple-example">A simple example</a></li>
<li><a href="#encapsulation-and-the-public-interface-of-a-class">Encapsulation and the Public Interface of a Class</a></li>
<li><a href="#inheritance-and-is-a-relationships">Inheritance and &quot;is a&quot; relationships</a></li>
<li><a href="#duck-typing">Duck Typing</a></li>
<li><a href="#composition-and-has-a-relationships">Composition and &quot;has a&quot; relationships</a></li>
</ul>
</li>
<li><a href="#testing">Testing</a>
<ul>
<li><a href="#writing-tests">Writing Tests</a></li>
<li><a href="#unit-testing-with-unittest">Unit Testing with <code>unittest</code></a></li>
<li><a href="#test-driven-development">Test-Driven Development</a></li>
<li><a href="#what-to-test">What to Test</a></li>
<li><a href="#testing-and-object-oriented-design">Testing and Object-Oriented Design</a></li>
</ul>
</li>
<li><a href="#running-time-analysis">Running Time Analysis</a>
<ul>
<li><a href="#timing-programs">Timing Programs</a></li>
<li><a href="#example-adding-the-first-k-numbers">Example: Adding the first k numbers.</a></li>
<li><a href="#modeling-the-running-time-of-a-program">Modeling the Running Time of a Program</a>
<ul>
<li><a href="#list-operations">List Operations</a></li>
<li><a href="#dictionary-operations">Dictionary Operations</a></li>
<li><a href="#set-operations">Set Operations</a></li>
</ul>
</li>
<li><a href="#asymptotic-analysis-and-the-order-of-growth">Asymptotic Analysis and the Order of Growth</a></li>
<li><a href="#focus-on-the-worst-case">Focus on the Worst Case</a></li>
<li><a href="#big-o">Big-O</a></li>
<li><a href="#the-most-important-features-of-big-o-usage">The most important features of big-O usage</a></li>
</ul>
</li>
<li><a href="#practical-use-of-the-big-o-and-common-functions">Practical Use of the Big-O and Common Functions</a>
<ul>
<li><a href="#bases-for-logarithms">Bases for Logarithms</a></li>
</ul>
</li>
<li><a href="#practice-examples">Practice examples</a></li>
<li><a href="#stacks-and-queues">Stacks and Queues</a>
<ul>
<li><a href="#abstract-data-types">Abstract Data Types</a></li>
<li><a href="#the-stack-adt">The Stack ADT</a></li>
<li><a href="#the-queue-adt">The Queue ADT</a></li>
<li><a href="#dealing-with-errors">Dealing with errors</a></li>
</ul>
</li>
<li><a href="#deques-and-linked-lists">Deques and Linked Lists</a>
<ul>
<li><a href="#the-deque-adt">The Deque ADT</a></li>
<li><a href="#linked-lists">Linked Lists</a></li>
<li><a href="#implementing-a-queue-with-a-linkedlist">Implementing a Queue with a LinkedList</a></li>
<li><a href="#storing-the-length">Storing the length</a></li>
<li><a href="#testing-against-the-adt">Testing Against the ADT</a></li>
<li><a href="#the-main-lessons">The Main Lessons:</a></li>
<li><a href="#design-patterns-the-wrapper-pattern">Design Patterns:  The Wrapper Pattern</a></li>
<li><a href="#the-main-lessons-1">The Main Lessons:</a></li>
</ul>
</li>
<li><a href="#doubly-linked-lists">Doubly-Linked Lists</a>
<ul>
<li><a href="#concatenating-doubly-linked-lists">Concatenating Doubly Linked Lists</a></li>
</ul>
</li>
<li><a href="#recursion">Recursion</a>
<ul>
<li><a href="#recursion-and-induction">Recursion and Induction</a></li>
<li><a href="#some-basics">Some Basics</a></li>
<li><a href="#the-function-call-stack">The Function Call Stack</a></li>
<li><a href="#the-fibonacci-sequence">The Fibonacci Sequence</a></li>
<li><a href="#euclids-algorithm">Euclid&apos;s Algorithm</a></li>
</ul>
</li>
<li><a href="#dynamic-programming">Dynamic Programming</a>
<ul>
<li><a href="#a-greedy-algorithm">A Greedy Algorithm</a></li>
<li><a href="#a-recursive-algorithm">A Recursive Algorithm</a></li>
<li><a href="#a-memoized-version">A Memoized Version</a></li>
<li><a href="#a-dynamic-programming-algorithm">A Dynamic Programming Algorithm</a></li>
<li><a href="#another-example">Another example</a></li>
</ul>
</li>
<li><a href="#binary-search">Binary Search</a>
<ul>
<li><a href="#the-sorted-list-adt">The Sorted List ADT</a></li>
</ul>
</li>
<li><a href="#sorting">Sorting</a>
<ul>
<li><a href="#the-quadratic-time-sorting-algorithms">The Quadratic-Time Sorting Algorithms</a></li>
<li><a href="#sorting-in-python">Sorting in Python</a></li>
</ul>
</li>
<li><a href="#sorting-with-divide-and-conquer">Sorting with Divide and Conquer</a>
<ul>
<li><a href="#mergesort">Mergesort</a>
<ul>
<li><a href="#an-analysis">An Analysis</a></li>
<li><a href="#merging-iterators">Merging Iterators</a></li>
</ul>
</li>
<li><a href="#quicksort">Quicksort</a></li>
</ul>
</li>
<li><a href="#selection">Selection</a>
<ul>
<li><a href="#the-quickselect-algorithm">The <code>quickselect</code> algorithm</a></li>
<li><a href="#analysis">Analysis</a></li>
<li><a href="#one-last-time-without-recursion">One last time without recursion</a></li>
<li><a href="#divide-and-conquer-recap">Divide-and-Conquer Recap</a></li>
<li><a href="#a-note-on-derandomization">A Note on Derandomization</a></li>
</ul>
</li>
<li><a href="#mappings-and-hash-tables">Mappings and Hash Tables</a>
<ul>
<li><a href="#the-mapping-adt">The Mapping ADT</a></li>
<li><a href="#a-minimal-implementation">A minimal implementation</a></li>
<li><a href="#the-extended-mapping-adt">The extended Mapping ADT</a></li>
<li><a href="#its-too-slow">It&apos;s Too Slow!</a>
<ul>
<li><a href="#how-many-buckets-should-we-use">How many buckets should we use?</a></li>
<li><a href="#rehashing">Rehashing</a></li>
</ul>
</li>
<li><a href="#factoring-out-a-superclass">Factoring Out A Superclass</a></li>
</ul>
</li>
<li><a href="#trees">Trees</a>
<ul>
<li><a href="#some-more-definitions">Some more definitions</a></li>
<li><a href="#a-recursive-view-of-trees">A recursive view of trees</a></li>
<li><a href="#tree-traversal">Tree Traversal</a></li>
<li><a href="#if-you-want-to-get-fancy">If you want to get fancy...</a>
<ul>
<li><a href="#theres-a-catch">There&apos;s a catch!</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#binary-search-trees">Binary Search Trees</a>
<ul>
<li><a href="#the-sorted-mapping-adt">The Sorted Mapping ADT</a></li>
<li><a href="#binary-search-tree-properties-and-definitions">Binary Search Tree Properties and Definitions</a></li>
<li><a href="#a-minimal-implementation-1">A Minimal implementation</a>
<ul>
<li><a href="#the-floor-function">The <code>floor</code> function</a></li>
<li><a href="#iteration">Iteration</a></li>
</ul>
</li>
<li><a href="#removal">Removal</a></li>
</ul>
</li>
<li><a href="#balanced-binary-search-trees">Balanced Binary Search Trees</a>
<ul>
<li><a href="#a-bstmapping-implementation">A <code>BSTMapping</code> implementation</a>
<ul>
<li><a href="#forward-compatibility-of-factories">Forward Compatibility of Factories</a></li>
</ul>
</li>
<li><a href="#weight-balanced-trees">Weight Balanced Trees</a></li>
<li><a href="#height-balanced-trees-avl-trees">Height-Balanced Trees (AVL Trees)</a></li>
<li><a href="#splay-trees">Splay Trees</a></li>
</ul>
</li>
<li><a href="#priority-queues">Priority Queues</a>
<ul>
<li><a href="#the-priority-queue-adt">The Priority Queue ADT</a></li>
<li><a href="#using-a-list">Using a list</a></li>
<li><a href="#heaps">Heaps</a></li>
<li><a href="#storing-a-tree-in-a-list">Storing a tree in a list</a></li>
<li><a href="#building-a-heap-from-scratch">Building a Heap from scratch</a></li>
<li><a href="#changing-priorities">Changing priorities</a></li>
</ul>
</li>
<li><a href="#graphs">Graphs</a>
<ul>
<li><a href="#a-graph-adt">A Graph ADT</a></li>
<li><a href="#the-edgesetgraph-implementation">The <code>EdgeSetGraph</code> Implementation</a></li>
<li><a href="#the-adjacencysetgraph-implementation">The <code>AdjacencySetGraph</code> Implementation</a></li>
<li><a href="#paths-and-connectivity">Paths and Connectivity</a></li>
</ul>
</li>
<li><a href="#graph-search">Graph Search</a>
<ul>
<li><a href="#depth-first-search">Depth-First Search</a></li>
<li><a href="#removing-the-recursion">Removing the Recursion</a></li>
<li><a href="#breadth-first-search">Breadth-First Search</a></li>
<li><a href="#weighted-graphs-and-shortest-paths">Weighted Graphs and Shortest Paths</a></li>
<li><a href="#prims-algorithm-for-minimum-spanning-trees">Prim&apos;s Algorithm for Minimum Spanning Trees</a></li>
<li><a href="#an-optimization-for-priority-first-search">An optimization for Priority-First search</a></li>
</ul>
</li>
</ul>
<p style="page-break-after:always;"></p>
<p style="page-break-after:always;"></p>
    <a name="chapter_00" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 0
    </p>
    <hr>
<h1 class="mume-header" id="overview">Overview</h1>

<p><em>This book is designed to cover a lot of ground quickly, without taking shortcuts.</em></p>
<p><strong>What does that mean?</strong>
It means that concepts are motivated and start with simple examples.
The ideas follow the problems.
The abstractions follow the concrete instances.</p>
<p><strong>What does it not mean?</strong>
The book is not meant to be comprehensive, covering all of data structures,
nor is it a complete introduction to all the details of python.
Introducing the minimum necessary knowledge to make interesting programs and learn useful concepts is not taking shortcuts, it&apos;s just being directed.</p>
<p>There are many books that will teach idiomatic python programming, and many others that will teach problem solving, data structures, or algorithms.
There are many books for learning design patterns, testing, and many of the other important practices of software engineering.
The aim of this book is cover many of these topics as part of an integrated course.</p>
<p>Towards that aim, the organization is both <em>simple</em> and <em>complex</em>.
The <em>simple</em> part is that the overall sequencing of the main topics is motivated by the data structuring problems, as is evident from the chapter titles.
The <em>complex</em> part is that many other concepts including problem solving strategies, more advanced python, object-oriented design principles, and testing methodologies are introduced bit by bit throughout the text in a logical, incremental way.</p>
<p>As a result, the book is not meant to be a reference.
It is meant to be worked through from beginning to end.
Many topics dear to my heart were left out to make it possible to work through the whole book in a single semester course.</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_01" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 1
    </p>
    <hr>
<h1 class="mume-header" id="basic-python">Basic Python</h1>

<div class="code-chunk" data-id="type" data-cmd="python"><div class="input-div"><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>This book is not intended as a first course in programming.
It will be assumed that the reader has some experience with programming.
Therefore, it will be assumed that certain concepts are already familiar to them, the most basic of which is a mental model for programming that is sometimes called <em>Sequence, Selection, and Iteration</em>.</p>
<h2 class="mume-header" id="sequence-selection-and-iteration">Sequence, Selection, and Iteration</h2>

<p>A recurring theme in this course is the process of moving from <em>thinking about</em> code to <em>writing</em> code.  We will try to shape the way we think about programs, the way we write programs, and how we go between the two in <em>both</em> directions.  That is, we want to have facility with both direct manipulation of code as well as high-level description of programs.<br>
A nice model for thinking about (imperative) programming is called Sequence-Selection-Iteration.  It refers to:</p>
<ol>
<li><strong>Sequence</strong>: Performing operations one at a time in a specified order.</li>
<li><strong>Selection</strong>: Using conditional statements such as <code>if</code> to select which operations to execute.</li>
<li><strong>Iteration</strong>: Repeating some operations using loops or recursion.</li>
</ol>
<p>In any given programming language, there are usually several mechanisms for selection and iteration, while sequencing is just the default behavior.<br>
In fact, you usually have to have special constructions in a language to do something other than performing the given operations in the given order.</p>
<h2 class="mume-header" id="expressions-and-evaluation">Expressions and Evaluation</h2>

<p>Python can do simple arithmetic.  For example, <code>2+2</code> is a simple arithmetic <strong>expression</strong>.
Expressions get <strong>evaluated</strong> and produce a <strong>value</strong>.  Some values are numerical like the <code>2 + 2</code> example, but they don&#x2019;t need to be.
For example, <code>5 &gt; 7</code> is an expression that evaluates to the boolean value <code>False</code>.
Expressions can become more complex by combining many operations and functions.
For example, <code>5 * (3 + abs(-12) / 3)</code> contains four different functions.  Parentheses and the order of operations determine the order that the functions are evaluated.  Recall that in programming the order of operations is also called <strong>operator precedence</strong>.  In the above example, the functions are executed in the following order: <code>abs</code>, <code>/</code>,  <code>+</code>, <code>*</code>.</p>
<h2 class="mume-header" id="variables-types-and-state">Variables, Types,  and State</h2>

<p>Imagine you are trying to work out some elaborate math problem without a computer.   It helps to have paper.  You write things down, so that you can use them later.  It&apos;s the same in programming.  It often happens that you compute something and want to keep it until later when you will use it.  We often refer to stored information as <strong>state</strong>.</p>
<p>We store information in <strong>variables</strong>.  In Python, a variable is created by an <strong>assignment</strong> statement.  That is a statement of the form:</p>
<p><code>variable_name = some_value</code></p>
<p>The equals sign is <em>doing</em> something (assignment) rather than <em>describing</em> something (equality).
The right side of <code>=</code> is an expression that gets evaluated first.  Only later does the assignment happen.
If the left side of the assignment is a variable name that already exist, it is overwritten.
If it doesn&#x2019;t already exist, it is created.</p>
<p>The order of evaluation is very important.  Having the right side evaluated first means that assignments like <code>x = x + 1</code> make sense, because the value of <code>x</code> doesn&#x2019;t change until after <code>x + 1</code> is evaluated.  Incidentally, there is a shorthand for this kind of update: <code>x += 1</code>.  There are similar notations for <code>-=</code>, <code>*=</code>, and <code>/=</code>.</p>
<p>An assignment statement is not expression.  It doesn&#x2019;t have a value.  This turns out to be useful in avoiding a common bug arising from confusing assignment and equality testing (i.e. <code>x == y</code>).  However, multiple assignment like <code>x = y = 1</code> does work as you would expect it to, setting both <code>x</code> and <code>y</code> to <code>1</code>.</p>
<p>Variables are  just names.  Every name is associated with some piece of data, called an object.<br>
The name is a string of characters and it is mapped to an object.
The name of a variable, by itself, is treated as an expression that evaluates to whatever object it is mapped to.
This mapping of strings to objects is often depicted using boxes to represent the objects and arrows to show the mapping.</p>
<p>Every object has a <strong>type</strong>.  The type often determines what you can do with the variable.  The so-called <strong>atomic types</strong> in Python are <em>integers</em>, <em>floats</em>, and <em>booleans</em>, but any interesting program will contain variables of many other types as well.  You can inspect the type of a variable using the <code>type()</code> function.  In Python, the word <em>type</em> and <em>class</em> mean the same thing (most of the time).</p>
<p>The difference between a variable and the <strong>object</strong> it represents can get lost in our common speech because the variable is usually acting as the <em>name</em> of the object.  There are some times when it&apos;s useful to be clear about the difference, in particular when copying objects.  You might want to try some examples of copying objects from one variable to another.  Does changing one of them affect the other?</p>
<div class="code-chunk" data-id="j4htmm25" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=1, cmd id=&quot;j4htmm25&quot; continue=&quot;type&quot;}" class="language-python">x <span class="token operator">=</span> <span class="token number">5</span>
y <span class="token operator">=</span> <span class="token number">3.2</span>
z <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;x has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;y has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;z has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">x has type &lt;class &apos;int&apos;&gt;
y has type &lt;class &apos;float&apos;&gt;
z has type &lt;class &apos;bool&apos;&gt;
</pre></div></div><p>You should think of an object as having three things: an <em>identity</em>, a <em>type</em>, and a <em>value</em>.
It&#x2019;s identity cannot change.  It can be used to see if two objects are actually the same object with the <code>is</code> keyword.
For example, consider the following code.</p>
<div class="code-chunk" data-id="code-chunk-id-2" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=2, cmd}" class="language-python">x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> x
z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>x <span class="token keyword">is</span> y<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x <span class="token keyword">is</span> z<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>x <span class="token operator">==</span> z<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">True
False
True
</pre></div></div><p>An object cannot change its identity.
In Python, you also cannot change the type of an object.
You can reassign a variable to point to different object of a different type, but that&apos;s not the same thing.
There are several functions that may seem to be changing the types of objects, but they are really just creating a new object from the old.</p>
<div class="code-chunk" data-id="j4htp29r" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=3, cmd id=&quot;j4htp29r&quot; continue=&quot;type&quot;}" class="language-python">x <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;x =&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;float(x) =&quot;</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;x still has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Overwriting x.&quot;</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Now, x has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">x = 2
float(x) = 2.0
x still has type &lt;class &apos;int&apos;&gt;
Overwriting x.
Now, x has type &lt;class &apos;float&apos;&gt;
</pre></div></div><p>You can do more elaborate things as well.</p>
<div class="code-chunk" data-id="j4htrk52" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=4, cmd id=&quot;j4htrk52&quot; continue=&quot;type&quot;}" class="language-python">numstring <span class="token operator">=</span> <span class="token string">&quot;3.1415926&quot;</span>
y <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>numstring<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;y has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span>

best_number <span class="token operator">=</span> <span class="token number">73</span>
x <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>best_number<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;x has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>

thisworks <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">&quot;inf&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;float(\&apos;inf\&apos;) has type&quot;</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>thisworks<span class="token punctuation">)</span><span class="token punctuation">)</span>
infinity_plus_one <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">&apos;inf&apos;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">y has type &lt;class &apos;float&apos;&gt;
x has type &lt;class &apos;str&apos;&gt;
float(&apos;inf&apos;) has type &lt;class &apos;float&apos;&gt;
</pre></div></div><p>This last example introduced a new type, that of a <strong>string</strong>.  A string is a sequence of characters.  In Python, there is no special class for a single character (as in C for example).
If you want a single character, you use a string of length one.</p>
<p>The value of an object may or may not be changed, depending on the type of object.
If the value can be changed, we say that the object is <strong>mutable</strong>.
If it cannot be changed, we say that the object is <strong>immutable</strong>.
For example, strings are immutable.  If you want to change a string, for example, by converting it to lowercase, then you will be creating a new string.</p>
<h2 class="mume-header" id="collections">Collections</h2>

<p>The next five most important types in Python are strings, lists, tuples, dictionaries, and sets.  We call these collections as each can be used for storing a collection of things.  We will see many other examples of collections in this course.</p>
<h3 class="mume-header" id="strings-str">Strings  (<code>str</code>)</h3>

<p><strong>Strings</strong> are sequences of characters and can be used to store text of all kinds.  Note that you can <strong>concatenate</strong> strings to create a new string using the plus sign.  You can also access individual characters using square brackets and an <strong>index</strong>.  The name of the class for strings is <code>str</code>.  You can often turn other objects into strings.</p>
<div class="code-chunk" data-id="code-chunk-id-5" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=5, cmd continue=&quot;type&quot;}" class="language-python">s <span class="token operator">=</span> <span class="token string">&quot;Hello, &quot;</span>
t <span class="token operator">=</span> <span class="token string">&quot;World.&quot;</span>
u <span class="token operator">=</span> s <span class="token operator">+</span> t
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
n <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token number">9876</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;class &apos;str&apos;&gt;
Hello, World.
r
7
</pre></div></div><h3 class="mume-header" id="lists-list">Lists (<code>list</code>)</h3>

<p><strong>Lists</strong> are ordered sequences of objects.  The objects do not have to be the same type.  They are indicated by square brackets and the <strong>elements</strong> of the list are separated by commas.  You can append an item to the end of a list <code>L</code> by using the command <code>L.append(newitem)</code>.
It is possible to index into a list exactly as we did with strings.</p>
<div class="code-chunk" data-id="code-chunk-id-6" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=6, cmd continue=&quot;type&quot;}" class="language-python">L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>
L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;class &apos;list&apos;&gt;
[1, 2, 3, 400]
</pre></div></div><h3 class="mume-header" id="tuples-tuple">Tuples (<code>tuple</code>)</h3>

<p><strong>Tuples</strong> are also ordered sequences of objects, but unlike lists, they are immutable.  You can access the items but you can&#x2019;t change what items are in the tuple after you create it.  For example, trying to <code>append</code> raises an exception.</p>
<div class="code-chunk" data-id="j4htlbaj" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=7, cmd id=&quot;j4htlbaj&quot; continue=&quot;type&quot;}" class="language-python">t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;skip a few&quot;</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
t<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">101</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;class &apos;tuple&apos;&gt;
(1, 2, &apos;skip a few&apos;, 99, 100)
100
Traceback (most recent call last):
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/knunbuw1x_code_chunk.py&quot;, line 10, in <module>
    t.append(101)
AttributeError: &apos;tuple&apos; object has no attribute &apos;append&apos;
</module></pre></div></div><h3 class="mume-header" id="dictionaries-dict">Dictionaries (<code>dict</code>)</h3>

<p><strong>Dictionaries</strong> store <em>key-value</em> pairs.  That is, every element of a dictionary has two parts, a <strong>key</strong> and a <strong>value</strong>.  If you have the key, you can get the value.  The name comes from the idea that in a real dictionary (book), a word (the key) allows you to find its definition (the value).  Notice that the keys can be different types, but they must be immutable types such as atomic types, tuples, or strings.  The reason for this requirement is that we will determine where to store something using the key.  If the key changes, we will look in the wrong place when it&apos;s time to look it up again.</p>
<p>Dictionaries are also known as maps,  <strong>mappings</strong>, or hash tables.  We will go deep into how these are constructed later in the course.
A dictionary doesn&apos;t have a fixed order.</p>
<div class="code-chunk" data-id="code-chunk-id-8" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python  {code_chunk_offset=8, cmd}" class="language-python">d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
d<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;two&quot;</span>
d<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;five&quot;</span>
d<span class="token punctuation">[</span><span class="token string">&quot;pi&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3.1415926</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span><span class="token string">&quot;pi&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">{2: &apos;two&apos;, 5: &apos;five&apos;, &apos;pi&apos;: 3.1415926}
3.1415926
</pre></div></div><h3 class="mume-header" id="sets-set">Sets (<code>set</code>)</h3>

<p><strong>Sets</strong> correspond to our notion of sets in math.  They are collections of objects without duplicates.  We use curly braces to denote them and commas to separate elements.  As with dictionaries, a set has no fixed ordering.  We say that sets and dictionaries are <strong>nonsequential collections</strong>.</p>
<p>Be careful that empty braces <code>{}</code> indicates an empty dictionary and not an empty set.  Here is an example of a newly created set.  Some items are added.  Notice that the duplicates have no effect on the value as its printed.</p>
<div class="code-chunk" data-id="code-chunk-id-9" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=9, cmd continue=&quot;type&quot;}" class="language-python">s <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;class &apos;set&apos;&gt;
{1, 2, 3}
</pre></div></div><h2 class="mume-header" id="some-common-things-to-do-with-collections">Some common things to do with collections</h2>

<p>There are several operations that can be performed on any of the collections classes (and indeed often on many other types objects).</p>
<p>You can find the number of elements in the collection (the <strong>length</strong>) using <code>len</code>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">a <span class="token operator">=</span> <span class="token string">&quot;a string&quot;</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;my&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;second&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;favorite&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;tuple&quot;</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&apos;a&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;b&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;b&apos;</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&apos;c&apos;</span><span class="token punctuation">:</span> <span class="token boolean">False</span><span class="token punctuation">}</span>
e <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">}</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>8 4 2 3 4
</code></pre><p>For the sequential types (lists, tuples, and strings), you can <strong>slice</strong> a subsequence of indices using square brackets and a colon as in the following examples.  The range of indices is half open in that the slice will start with the first index and proceed up to but not including the last index.  Negative indices count backwards from the end.  Leaving out the first index is the same as starting at 0.  Leaving out the second index will continue the slice until the end of the sequence.</p>
<p><strong>Important</strong>: slicing a sequence creates a new object.  That means a big slice will do a lot of copying.  It&apos;s really easy to write inefficient code this way.</p>
<div class="code-chunk" data-id="code-chunk-id-10" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=10, cmd}" class="language-python">a <span class="token operator">=</span> <span class="token string">&quot;a string&quot;</span>
b <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;my&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;second&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;favorite&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">&quot;tuple&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">trin
 stri
[&apos;second&apos;, &apos;favorite&apos;, &apos;list&apos;]
(1, 2)
</pre></div></div><h2 class="mume-header" id="iterating-over-a-collection">Iterating over a collection</h2>

<p>It is very common to want to loop over a collection.
The pythonic way of doing iteration is with a <code>for</code> loop.</p>
<p>The syntax is shown in the following examples.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">mylist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
mytuple <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&apos;skip a few&apos;</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
myset <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&apos;a&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;b&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;z&apos;</span><span class="token punctuation">}</span>
mystring <span class="token operator">=</span> <span class="token string">&apos;abracadabra&apos;</span>
mydict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&apos;a&apos;</span><span class="token punctuation">:</span> <span class="token number">96</span><span class="token punctuation">,</span> <span class="token string">&apos;b&apos;</span><span class="token punctuation">:</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token string">&apos;c&apos;</span><span class="token punctuation">:</span> <span class="token number">98</span><span class="token punctuation">}</span>

<span class="token keyword">for</span> item <span class="token keyword">in</span> mylist<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>

<span class="token keyword">for</span> item <span class="token keyword">in</span> mytuple<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>

<span class="token keyword">for</span> element <span class="token keyword">in</span> myset<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>

<span class="token keyword">for</span> character <span class="token keyword">in</span> mystring<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>character<span class="token punctuation">)</span>

<span class="token keyword">for</span> key <span class="token keyword">in</span> mydict<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> mydict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

<span class="token keyword">for</span> value <span class="token keyword">in</span> mydict<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
</pre><p>There is class called <code>range</code> to represent a sequence of numbers that behaves like a collection.
It is often used in for loops as follows.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    j <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span><span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="other-forms-of-control-flow">Other Forms of Control Flow</h2>

<p><strong>Control flow</strong> refers to the commands in a language that affect the order or what operations are executed.
The <code>for</code> loops from the previous section are classic examples if this.  The other basic forms of control flow are <code>if</code> statements, <code>while</code> loops,  <code>try</code> blocks, and function calls.  We&#x2019;ll cover each briefly and refer the reader to the python documentation for more detailed info.</p>
<p>An <code>if</code> statement in its simplest form evaluates an expression and tries to interpret it as a boolean.  This expression is referred to as a predicate.  If the predicate evaluates to <code>True</code>, then a block of code is executed.  Otherwise, the code is not executed.  This is the <em>selection</em> of sequence, selection, and iteration.  Here is an example.</p>
<div class="code-chunk" data-id="code-chunk-id-11" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=11, cmd}" class="language-python"><span class="token keyword">if</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;This should be printed.&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token number">2</span> <span class="token operator">**</span> <span class="token number">8</span> <span class="token operator">!=</span> <span class="token number">256</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;This should not be printed.&quot;</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">This should be printed.
</pre></div></div><p>An <code>if</code> statement can also include an <code>else</code> clause.  This is a second block of code that executes if the predicate evaluates to <code>False</code>.</p>
<div class="code-chunk" data-id="code-chunk-id-12" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=12, cmd}" class="language-python"><span class="token keyword">if</span> <span class="token boolean">False</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;This is bad.&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;This will print.&quot;</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">This will print.
</pre></div></div><p>A <code>while</code> loop also has a predicate.  It is evaluated at the top of a block of code.  If it evaluates to <code>True</code>, then the block is executed and then it repeats.  The repetition continues until the predicate evaluate to <code>False</code> or until the code reaches a <code>break</code> statement.</p>
<div class="code-chunk" data-id="code-chunk-id-13" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=13, cmd}" class="language-python">x <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">while</span> x <span class="token operator">&lt;</span> <span class="token number">128</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    x <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token number">2</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">1
2
4
8
16
32
64
</pre></div></div><p>A <code>try</code> block is the way to catch and recover from errors while a program is running.  If you have some code that may cause an error, but you don&#x2019;t want it to crash your program, you can put the code in a <code>try</code> block.  Then, you can <em>catch</em> the error (also known as an <strong>exception</strong>) and deal with it.  A simple example might be a case where you want to convert some number to a <code>float</code>.  Many types of objects can be converted to <code>float</code>, but many cannot.  If we simply try to do the conversion and it works, everything is fine.  Otherwise, if there is a <code>ValueError</code>, we can do something else instead.</p>
<div class="code-chunk" data-id="code-chunk-id-14" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=14, cmd}" class="language-python">x <span class="token operator">=</span> <span class="token string">&quot;not a number&quot;</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;You can&#x2019;t do that!&quot;</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">You can&#x2019;t do that!
</pre></div></div><p>A function also changes the control flow.  In Python, you define a function with the <code>def</code> keyword.  This keyword creates an object to store the block of code.  The parameters for the function are listed in parentheses after the function name.  The <code>return</code> statement causes the control flow to revert back to where the function was called and determines the value of the function call.</p>
<div class="code-chunk" data-id="code-chunk-id-15" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=15, cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">8</span> <span class="token operator">*</span> x <span class="token operator">+</span> y

<span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">(</span><span class="token string">&quot;Na&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot; batman&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">17
NaNaNaNaNaNaNaNa batman
</pre></div></div><p>Notice that there is no requirement that we specify the types of objects a function expects for its arguments.  This is very convenient, because it means that we can use the same function to operate on different types of objects (as in the example above).  If we define a function twice, even if we change the parameters, the first will be overwritten by the second.  This is exactly the same as assigning to a variable twice.  The name of a function is just a name; it refers to an object (the function).  Functions can be treated like any other object.</p>
<div class="code-chunk" data-id="code-chunk-id-16" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=16, cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> <span class="token number">2</span>

<span class="token keyword">def</span> <span class="token function">bar</span><span class="token punctuation">(</span>somefunction<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> somefunction<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>bar<span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span>
somevariable <span class="token operator">=</span> foo
<span class="token keyword">print</span><span class="token punctuation">(</span>bar<span class="token punctuation">(</span>somevariable<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">6
6
</pre></div></div><h2 class="mume-header" id="modules-and-imports">Modules and Imports</h2>

<p>As we start to write more complex programs, it starts to make sense to break up the code across several files.  A single <code>.py</code> file is called a module.  You can import one module into another using the <code>import</code> keyword.  The name of a module, by default, is the name of the file (without the <code>.py</code> extension).  When we import a module, the code in that module is executed.  Usually, this should be limited to defining some functions and classes, but can technically include anything.  The module also has a namespace in which these functions and classes are defined.</p>
<p>For example, suppose we have the following files.</p>
<div class="code-chunk" data-id="twofunctions" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=17, cmd id=&quot;twofunctions&quot;}" class="language-python"><span class="token comment"># File: twofunctions.py</span>

<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">2</span> <span class="token operator">*</span> x <span class="token operator">+</span> <span class="token number">3</span>

<span class="token keyword">def</span> <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><pre data-role="codeBlock" data-info="python" class="language-python"><span class="token comment"># File: theimporter.py</span>
<span class="token keyword">import</span> twofunctions

<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">-</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>twofunctions<span class="token punctuation">.</span>f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Will print 5</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token comment"># Will print 0</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>twofunctions<span class="token punctuation">.</span>g<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Will print 15</span>
</pre><p>The <code>import</code> brings the module name into the current namespace.  I can then use it to identify the functions from the module.</p>
<p>There is very little magic in an import.  In some sense, it&#x2019;s just telling the current program about the results of another program.  Because the import (usually) results in the module being executed, it&#x2019;s good practice to change the behavior of a script depending on whether it is being run directly, or being run as part of an import.  It is possible to check by looking at the <code>__name__</code> attribute of the module.  If you run the module directly (i.e. as a script), then the <code>__name__</code> variable is automatically set to <code>__main__</code>.  If the module is being imported, the <code>__name__</code> defaults to the module name.  This is easily seen from the following experiment.</p>
<div class="code-chunk" data-id="code-chunk-id-18" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=18, cmd}" class="language-python"><span class="token comment"># File: mymodule.py</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;The name of this module is&quot;</span><span class="token punctuation">,</span> __name__<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">The name of this module is __main__
</pre></div></div><pre data-role="codeBlock" data-info="python" class="language-python"><span class="token comment"># File: theimporter.py</span>

<span class="token keyword">import</span> mymodule
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Notice that it will print something different when imported?&quot;</span><span class="token punctuation">)</span>
</pre><p>Here is how we use the <code>__name__</code> attribute to check how the program is being run.</p>
<div class="code-chunk" data-id="code-chunk-id-19" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=19, cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">somefunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Real important stuff here.&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    somefunction<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Real important stuff here.
</pre></div></div><p>In the preceding code, the message is printed only when the module is executed as a script.  It is not printed (i.e. the <code>somefunction</code> function is not called) if the module is being imported.  This is a very common python idiom.</p>
<p>One caveat is that modules are only executed the first time they are imported.  If, for example, we import the same module twice, it will only be executed once.  At that point, the namespace exists and can be accessed for the second one.  This also avoids any infinite loops you might try to construct by having two modules, each of which imports the other.</p>
<p>There are a couple other common variations on the standard <code>import</code> statement.</p>
<ol>
<li>You can <code>import</code> just a particular name or collection of names from a module: <code>from modulename import thethingIwanted</code>.  This brings the new name <code>thethingIwanted</code> into the current namespace.  It doesn&#x2019;t need to be preceded by <code>modulename</code> and a dot.</li>
<li>You can<code>import</code> all the names from the module into the current namespace: <code>from modulename import *</code>.  If you do this, every name defined in the module will be accessible in the current namespace.  It doesn&#x2019;t need to be preceded by <code>modulename</code> and a dot.  Although easy to write and fast for many things, this is generally frowned upon as you often won&#x2019;t know exactly what names you are importing when you do this.</li>
<li>You can rename module after importing it: <code>import numpy as np</code>.  This allows you to use a different name to refer to the objects of the module.  In this example, I can write <code>np.array</code> instead of <code>numpy.array</code>.  The most common reason to do this is to have a shorter name.  The other, more fundamental use is to avoid naming conflicts.</li>
</ol>
<p style="page-break-after:always;"></p>
    <a name="chapter_02" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 2
    </p>
    <hr>
<h1 class="mume-header" id="object-oriented-programming">Object-Oriented Programming</h1>

<div class="code-chunk" data-id="type02" data-cmd="python"><div class="input-div"><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>A primary goal of <strong>object-oriented programming</strong> is to make it possible to write code that is close to the way you think about the things your code represents.
This will make it easier to reason about the code and think through its correctness.</p>
<p>A <strong>class</strong> is a data type.  In python <em>type</em> and <em>class</em> are (mostly) synonymous.  An <strong>object</strong> is an <strong>instance</strong> of a class.  For example, python has a <code>list</code> class.  If I make a list called <code>mylist</code>.  Then, <code>mylist</code> is an object of type <code>list</code>.</p>
<div class="code-chunk" data-id="j32a915x" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=21, cmd id=&quot;j32a915x&quot; continue=&quot;type02&quot;}" class="language-python">mylist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>mylist<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>mylist<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">isinstance</span><span class="token punctuation">(</span>mylist<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;class &apos;list&apos;&gt;
True
False
</pre></div></div><p>There are all kinds of classes built into python.  Some you might not expect.</p>
<div class="code-chunk" data-id="j32a89ox" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=22, cmd id=&quot;j32a89ox&quot; continue=&quot;type02&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;class &apos;function&apos;&gt;
</pre></div></div><p>For the advanced students, here is a more exotic example called a generator.  In python you can <code>yield</code> instead of <code>return</code>.  If so, the result will be something called a generator and not a function.  This powerful idea shows up a lot in python, but we won&apos;t really be able to get our head around it until we understand how classes are able to package up data and code.</p>
<div class="code-chunk" data-id="j32a5vrk" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=23, cmd id=&quot;j32a5vrk&quot; continue=&quot;type02&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">mygenerator</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> i

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>mygenerator<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>mygenerator<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;class &apos;function&apos;&gt;
&lt;class &apos;generator&apos;&gt;
</pre></div></div><h2 class="mume-header" id="a-simple-example">A simple example</h2>

<p>One of the first ways that we learn about to combine multiple pieces of information into a single object is in calculus or linear algebra, with the introduction of vectors.  We can think of a 2-dimensional vector as a pair of numbers.  If we are trying to write some code that works with 2-dimensional vectors, we could just use tuples.  It&apos;s not too hard to define some basic functions that work with vectors.</p>
<div class="code-chunk" data-id="j32a9p9s" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=24, cmd id=&quot;j32a9p9s&quot;}" class="language-python">u <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
v <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">subtract</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">dot</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">norm</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">0.5</span>

<span class="token keyword">def</span> <span class="token function">isvertical</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>norm<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>add<span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>u <span class="token operator">+</span> v<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>isvertical<span class="token punctuation">(</span>subtract<span class="token punctuation">(</span>v<span class="token punctuation">,</span> u<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">5.0
(6, 10)
(3, 4, 3, 6)
True
</pre></div></div><p>This could be fine if that&apos;s all we wanted to do, but as we fill out the code, things will start to get messier.  For example, suppose we want to make sure that the inputs to these functions really are tuples that contain two numbers.  We might add some code to every method to check for this error or recover otherwise, but this is not great, because we really just want to operate on vectors.  Moreover, we might want to <code>add</code> other types of things besides vectors.  This would probably require us to make the add function much more complicated, or rename it something more descriptive such as <code>vectoradd</code>.</p>
<div class="code-chunk" data-id="j32aaa83" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=25, cmd id=&quot;j32aaa83&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Vector</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y

    <span class="token keyword">def</span> <span class="token function">norm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>y <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">0.5</span>

u <span class="token operator">=</span> Vector<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>Vector<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">5.0
13.0
</pre></div></div><p>A function defined in a class is called a <strong>method</strong>.  It is a standard convention to use <code>self</code> as the name of the first parameter to a method.  This parameter is object that will generally be operated on by the method.  When, calling the method, you don&apos;t have to pass a parameter explicitly for <code>self</code>.  Instead, the dot notation fills in this parameter for you.  That is <code>u.norm()</code> is translated into <code>vector.norm(u)</code>.</p>
<p>The <code>__init__</code> method is called a <strong>initializer</strong>.  Methods like this one that start and end with two underscores are sometimes called the <strong>magic methods</strong> or also <strong>dunder methods</strong>.  You should not make up your own methods starting and ending with two underscores.  That&apos;s how python sets them apart so you don&apos;t actually call your own methods the same thing.  Also, dunder methods are usually not called explicitly, but instead provide some other means of calling them.  In the case of a initializer, calling the name of the class as a function invokes the initializer.  You&apos;ve seen this before, such as in <code>float(&quot;3.14159&quot;)</code>.</p>
<p>We will use another magic method to implement addition.</p>
<div class="code-chunk" data-id="j32aaotj" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=26, cmd id=&quot;j32aaotj&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Vector</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y

    <span class="token keyword">def</span> <span class="token function">norm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>y <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">0.5</span>

    <span class="token keyword">def</span> <span class="token function">__add__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newx <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x
        newy <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> other<span class="token punctuation">.</span>y
        <span class="token keyword">return</span> Vector<span class="token punctuation">(</span>newx<span class="token punctuation">,</span> newy<span class="token punctuation">)</span>

u <span class="token operator">=</span> Vector<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
v <span class="token operator">=</span> Vector<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>u <span class="token operator">+</span> v<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">&lt;__main__.Vector object at 0x103376198&gt;
</pre></div></div><p>That output is pretty weird.  It&apos;s telling me that u + v is a vector object at some memory address, but doesn&apos;t tell me what vector it is.  We need to implement <code>__str__</code> in order to print the vector nicely.  This magic method is called by the print function to convert its parameters into a string.  It is not obvious how a string ought to be printed for a given class.  We have to specify it ourselves.</p>
<p>In the example below, I added a <code>__str__</code> method as well as some type checking on the inputs.  The result will guarantee that a vector has two floats as coordinates.</p>
<div class="code-chunk" data-id="j32abjfi" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=27, cmd id=&quot;j32abjfi&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Vector</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0.0</span>
            self<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">0.0</span>

    <span class="token keyword">def</span> <span class="token function">norm</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>y <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">0.5</span>

    <span class="token keyword">def</span> <span class="token function">__add__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newx <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> other<span class="token punctuation">.</span>x
        newy <span class="token operator">=</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> other<span class="token punctuation">.</span>y
        <span class="token keyword">return</span> Vector<span class="token punctuation">(</span>newx<span class="token punctuation">,</span> newy<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;(%f, %f)&quot;</span> <span class="token operator">%</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>

u <span class="token operator">=</span> Vector<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span>
v <span class="token operator">=</span> Vector<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>u <span class="token operator">+</span> v<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">(6.000000, 10.000000)
</pre></div></div><h2 class="mume-header" id="encapsulation-and-the-public-interface-of-a-class">Encapsulation and the Public Interface of a Class</h2>

<p>The word <strong>encapsulation</strong> has two different, but related, meanings.  The first is the idea of encapsulating or combining into a single thing, data and the methods that operate on that data.  In Python, this is accomplished via classes, as we have seen.</p>
<p>The second meaning of encapsulation emphasizes the boundary between the inside and the outside of the class, specifying what is visible to the users of a class.  Often this means partitioning the attributes into <strong>public</strong> and <strong>private</strong>.  In Python, there is no formal mechanism to keep one from accessing attributes of a class from outside that class.  So, in a sense, everything is public.  However, there is a convention to make it clear what <em>ought</em> to be kept private.  Any attribute that starts with an underscore is considered private.  Think of it like someone&#x2019;s unlocked diary.  You can read it, but you shouldn&#x2019;t.</p>
<div class="code-chunk" data-id="diary" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=28, cmd id=&quot;diary&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Diary</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>title <span class="token operator">=</span> title
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">addentry</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>entry<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_lastentry</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>In the example above, the <code>addentry</code> method is public.  Anyone can add an entry.  However, the <code>_lastentry</code> method is private.  One should not call this method from outside of the <code>Diary</code> class. (Again, you can, but you shouldn&#x2019;t.)  The <code>title</code> is also public, but the list <code>_entries</code> is private.  The collection of all public attributes (in this case, <code>addentry</code> and <code>title</code>) constitute the <strong>public interface</strong> of the class.  This is what a user of the class should interact with.  For example, one can use the class above as follows.</p>
<div class="code-chunk" data-id="code-chunk-id-29" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=29, cmd continue=&quot;diary&quot;}" class="language-python">mydiary <span class="token operator">=</span> Diary<span class="token punctuation">(</span><span class="token string">&quot;Don&#x2019;t read this!!!&quot;</span><span class="token punctuation">)</span>
mydiary<span class="token punctuation">.</span>addentry<span class="token punctuation">(</span><span class="token string">&quot;It was a good day.&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;The diary is called &quot;</span><span class="token punctuation">,</span> mydiary<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">The diary is called  Don&#x2019;t read this!!!
</pre></div></div><p>Notice that in this example, the encapsulation of the class is not about security.  Heck, if it&#x2019;s my diary, I should be able to read it, right?  The reason to respect the private attributes and stick to the public interface is really to help us write working code that continues to work in the future.  Code gets changed all the time.  If you are modifying a class that is being used elsewhere in the code, you have to be careful not to break that code.  If the public interface and its behavior doesn&#x2019;t change, then one can be confident that the changes don&#x2019;t affect the other code.  One could change the name of a private variable, say changing <code>_entries</code> to <code>_diaryentries</code> and be confident that this won&#x2019;t cause some other code somewhere else to break.</p>
<h2 class="mume-header" id="inheritance-and-is-a-relationships">Inheritance and &quot;is a&quot; relationships</h2>

<p>Whenever we talk about the types of things in our everyday life, it&#x2019;s possible to talk about them at different levels of generality.  We can talk about a specific basketball player, say Kylie Irving, or we can talk about professional basketball players, or all basketball players, or people or living creatures.  The specific player we started with could be said to belong to any of these classes.  The same principle applies to code that we write.</p>
<p>Consider this example from a geometry program.</p>
<div class="code-chunk" data-id="code-chunk-id-30" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=30, cmd}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Triangle</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_sides <span class="token operator">=</span> <span class="token number">3</span>
        self<span class="token punctuation">.</span>_points <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_points<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">&quot;Wrong number of points.&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">sides</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">3</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;I&#x2019;m a triangle.&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_sides <span class="token operator">=</span> <span class="token number">4</span>
        self<span class="token punctuation">.</span>_points <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_points<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">4</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">&quot;Wrong number of points.&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">sides</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">4</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;I&#x2019;m so square.&quot;</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>These are obviously, very closely related classes.  One can make another class for which these two classes are <strong>subclasses</strong>.  Then, anything common between the two classes can be put into the larger class or <strong>superclass</strong>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Polygon</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sides<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_sides <span class="token operator">=</span> sides
        self<span class="token punctuation">.</span>_points <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_points<span class="token punctuation">)</span> <span class="token operator">!=</span> self<span class="token punctuation">.</span>_sides<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">&quot;Wrong number of points.&quot;</span><span class="token punctuation">)</span>		

    <span class="token keyword">def</span> <span class="token function">sides</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_sides

<span class="token keyword">class</span> <span class="token class-name">Triangle</span><span class="token punctuation">(</span>Polygon<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Polygon<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> points<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;I&#x2019;m a triangle.&quot;</span>

<span class="token keyword">class</span> <span class="token class-name">Square</span><span class="token punctuation">(</span>Polygon<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        Polygon<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> points<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;I&#x2019;m so square.&quot;</span>
</pre><p>Notice that the class definitions of <code>Triangle</code> and <code>Square</code> now indicate the <code>Polygon</code> class in parentheses.  This is called <strong>inheritance</strong>.  The <code>Triangle</code> class <strong>inherits from</strong> (or <strong>extends</strong>) the <code>Polygon</code> class.  The <strong>superclass</strong> <code>Polyon</code> and the <strong>subclasses</strong> are <code>Triangle</code> and <code>Square</code>.  When we call a method on an object, if that method is not defined in the class of that object, Python will look for the method in the superclass.   This search for the correct function to call is called the <strong>method resolution order</strong>.   If a method from the superclass is redefined in the subclass, then calling the method on an instance of the subclass calls the subclass method instead.</p>
<p>The initializer of the superclass is not called automatically when we create a new instance (unless we didn&#x2019;t define <code>__init__</code> in the subclass).  In this case, we manually call the <code>Polygon.__init__</code> function.  This is one of the few times where it&#x2019;s acceptable to call a diner method by name.</p>
<p>When using inheritance, you should always remember the most important rule of inheritance:</p>
<blockquote>
<p>Inheritance means <strong>is a</strong>.</p>
</blockquote>
<p>This means that if <code>ClassB</code> extends <code>ClassA</code>, then a <code>ClassB</code> object <strong>is a</strong> <code>ClassA</code> object.  This should be true at the conceptual level.  So, in our shapes example, we followed this rule, because a triangle is a polygon.</p>
<p>In total, this might look like more code.  However, it has less duplication.  Duplication is very bad.  Even though it&#x2019;s easy to copy and paste on a computer, this is a source of many bugs.  The reason is simple.  Bugs are everywhere.  If you copy and paste a code with a bug, then now you have two bugs.  If you find the bug, you have to hope you remember to fix it both places.  Anytime you are relying on your memory, you are going to get yourself in trouble.</p>
<p>Software engineers use the acronym <strong>DRY</strong>, to mean <strong>Don&#x2019;t Repeat Yourself</strong>.  They will even use it as an adjective, saying &quot;Keep the code DRY&quot;.   The process of removing duplication by putting common code into a superclass is called <strong>factoring out a superclass</strong>.  This is the most common way that inheritance enters a codebase.  Sometimes, opportunities for inheritance are identified at the design stage, before coding begins.</p>
<h2 class="mume-header" id="duck-typing">Duck Typing</h2>

<p>Inheritance is considered a staple of object-oriented programming, and it&#x2019;s important to understand it.  That said, it&#x2019;s not nearly as useful in Python as it is in other languages.  The reason is that python has built-in (parametric) <strong>polymorphism</strong>.   That means we can pass any type of object we want to a function.  For example, suppose we have a class to store collections of polygons as follows.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">PolygonCollection</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_triangles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_squares <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> polygon<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> polygon<span class="token punctuation">.</span>sides<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_triangles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>polygon<span class="token punctuation">)</span>
        <span class="token keyword">if</span> polygon<span class="token punctuation">.</span>sides<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_squares<span class="token punctuation">.</span>append<span class="token punctuation">(</span>polygon<span class="token punctuation">)</span>
</pre><p>Notice that the <code>add</code> method would work equally well with either version of the <code>Triangle</code> and <code>Square</code> classes defined previously.  In fact, we could pass it any object that has a method called <code>sides</code>.  We didn&#x2019;t <em>need</em> inheritance in order to treat Triangles and squares as special cases of the same object.  Sometimes, inheritance is the right way to combine classes so they can be treated as a single class, but in Python, it&#x2019;s not as necessary as it is in other languages.</p>
<p>Python&#x2019;s polymorphism is based on the idea of <strong>duck typing</strong>.  The name comes from an old expression that if something walks like a duck and quacks like a duck, then it <em>is</em> a duck.  In the <code>PolygonCollection</code> example, if I call the <code>add</code> method with an argument that has a <code>sides</code> method that returns something that can be compared to an integer, then the code will run without error.  Having the right methods is equivalent to &quot;walking and talking like a duck&quot;.  This means that although inheritance should always mean <strong>is a</strong>, not every <em>&#x201C;is a&#x201D;</em> relationship in your code needs to be expressed with inheritance.</p>
<p>This idea that <em>not only inheritance means &#x201C;is a&#x201D;</em> is very important in Python and will be very important throughout this course.  We will discuss this more when we look in more depth at abstract data types.</p>
<p>One example that we have already seen is the <code>str</code> function.  Different types objects can be converted to strings, including objects of classes that we have defined ourselves.  As long as we implemented the <code>__str__</code> method on our class, then we can call <code>str</code> on an instance of that class.  That function calls the corresponding method, i.e., <code>str(t)</code> for a <code>Triangle</code> <code>t</code> calls <code>t.__str__()</code> which is equivalent to <code>Triangle.__str__(t)</code>.</p>
<h2 class="mume-header" id="composition-and-has-a-relationships">Composition and &quot;has a&quot; relationships</h2>

<p>There are many cases where we want objects of different types to share some functionality.  Sometimes, inheritance is used to allow for this sharing, but more often we use something called <strong>composition</strong>.  This is where one class stores an instance of another class.  It allows us to produce more complex objects.  The most important rule about composition is the following.</p>
<blockquote>
<p>Composition means &quot;has a&quot;.</p>
</blockquote>
<p>Consider the case where we want a class to behave like a <code>list</code>.  For example, we&#x2019;d like to be able to append to the list and access items by their index, but we don&#x2019;t want any of the other list stuff.  In this case, it would be <em>wrong</em> to use inheritance.  Instead, we would make our class store a list internally (composition).  Then, the public interface to our class would contain the methods we want while making calls to the stored <code>list</code> instance to avoid duplicating the list implementation.  Here is an example.</p>
<div class="code-chunk" data-id="MyLimitedList" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd, id=&quot;MyLimitedList&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyLimitedList</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">append</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Here, the magic method <code>__getitem__</code> will allow us to use the square bracket notation with our class.  As with other magic methods, we don&#x2019;t call it directly.</p>
<div class="code-chunk" data-id="code-chunk-id-32" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=31, cmd continue=&quot;MyLimitedList&quot;}" class="language-python">L <span class="token operator">=</span> MyLimitedList<span class="token punctuation">(</span><span class="token punctuation">)</span>
L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>L<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">100
</pre></div></div><p style="page-break-after:always;"></p>
    <a name="chapter_03" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 3
    </p>
    <hr>
<h1 class="mume-header" id="testing">Testing</h1>

<p>Python is an interpreted language.  This gives it a great deal of flexibility, such as duck typing.  However, this can also lead to different types of common bugs.  For example, if you pass a <code>float</code> to a function that really should only receive  an <code>int</code>, Python won&#x2019;t stop you, but it might lead to unexpected behavior.  In general, we have to run the code to get an error, but not all bugs will generate errors.  Towards the goal of writing correct code, we use tests to determine two things:</p>
<ol>
<li><strong>Does it work?</strong>  That is, does the code do what it&#x2019;s supposed to do?</li>
<li><strong>Does it still work?</strong> Can you be confident that the changes you made haven&#x2019;t caused other part of the code to break?</li>
</ol>
<h2 class="mume-header" id="writing-tests">Writing Tests</h2>

<p>Testing your code means writing more code that checks that the behavior matches your expectations. This is important:</p>
<blockquote>
<p>Test  behavior, not implementation.</p>
</blockquote>
<p>You have some idea of what code is supposed to do.  You run the code.  Did it do what you expected?  How about some other inputs?  In the simplest case, you could simply add some code to the bottom of the module.</p>
<div class="code-chunk" data-id="code-chunk-id-33" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=32, cmd}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Doubler</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_n <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> n

    <span class="token keyword">def</span> <span class="token function">n</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_n

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> &#x2018;__main__&#x2019;<span class="token punctuation">:</span>
    x <span class="token operator">=</span> Doubler<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>n<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span>
    y <span class="token operator">=</span> Doubler<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>n<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/3t4rf0yzp_code_chunk.py&quot;, line 8
    if __name__ == &#x2018;__main__&#x2019;:
                            ^
SyntaxError: invalid character in identifier
</pre></div></div><p>The <code>assert</code> statement will raise an error if the predicate that follows it is <code>False</code>.  Otherwise, the program just continues as usual.  Assertions are much better than just printing because you don&#x2019;t have to manually check to see that it printed what you expected it to print.  Also, people have a tendency to delete old print statements to reduce clutter in their test output.  Deleting tests after they pass is a <em>very bad idea</em>.  Your code is going to change, and you will want to know if a change breaks something that <em>used</em> to work.</p>
<p>The line <code>if __name__ == &#x2018;__main__&#x2019;:</code> makes sure that the tests will not run when the module is imported from somewhere else.</p>
<p>For some, learning to test their code runs into a substantial psychological block.  They feel that testing the code will reveal its flaws and thus reveal the programmer&#x2019;s flaws.  If you feel the slightest hesitation to testing your own code, you should practice the OGAE protocol.  It stands for, &quot;Oh Good, An Error!&quot;.  Every time you get an error, you say this with honest enthusiasm.  The computer has just done you a huge favor by identifying something wrong, and it has done so in the safety of your room or office.  You can fix it before it becomes any bigger.</p>
<h2 class="mume-header" id="unit-testing-with-unittest">Unit Testing with <code>unittest</code></h2>

<p>The simple kind of testing in the module described above is fine for tiny programs that will not be needed again, but for anything remotely serious, you will need proper <strong>unit tests</strong>.  The word unit in <em>unit</em> testing is meant to imply a single indivisible case.  Thus, unit tests are supposed to test a specific behavior of a specific function.  This means you will have many tests and you will run them all, every time you change the code.</p>
<p>To make the process go smoothly, there is a standard package  called <code>unittest</code> for writing unit tests in Python.  The package provides a standard way to write the tests, the ability to run the tests all together, and the ability to see the results of the tests in a clear format.  In modern software engineering, tests are also run automatically as part of build and deployment systems.</p>
<p>To use the <code>unittest</code> package, you will want to import the package in your test file.
Then, import the code you want to test.
The actual tests will be methods in a class that extends the <code>unittest.TestCase</code> class.
Every test method must start with the word &quot;test&quot;.  If it doesn&#x2019;t start with &quot;test&quot;, then it will not run.
Tests are run by calling the <code>unittest.main</code> function.</p>
<p>Here is an example that tests a particular behavior of a hypothetical <code>DayOfTheWeek</code> class.</p>
<div class="code-chunk" data-id="code-chunk-id-34" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=33, cmd}" class="language-python"><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> dayoftheweek <span class="token keyword">import</span> DayOfTheWeek

<span class="token keyword">class</span> <span class="token class-name">TestDayOfTheWeek</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">testinitwithabbreviation</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        d <span class="token operator">=</span> DayOfTheWeek<span class="token punctuation">(</span>&#x2018;F&#x2019;<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEquals<span class="token punctuation">(</span>d<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> &#x2018;Friday&#x2019;<span class="token punctuation">)</span>

        d <span class="token operator">=</span> DayOfTheWeek<span class="token punctuation">(</span>&#x2018;Th&#x2019;<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEquals<span class="token punctuation">(</span>d<span class="token punctuation">.</span>name<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> &#x2018;Thursday&#x2019;<span class="token punctuation">)</span>		

unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/hooc57eac_code_chunk.py&quot;, line 6
    d = DayOfTheWeek(&#x2018;F&#x2019;)
                       ^
SyntaxError: invalid character in identifier
</pre></div></div><p>Notice that even if we have never seen the code for the <code>DayOfTheWeek</code> class, we can get a good sense of its expected behavior from reading the tests.  In this case, we see that it can be instantiated with the abbreviation <code>F</code> and the <code>name()</code> function will return the value &quot;Friday&quot;.  It often happens that unit tests like this give the clearest specification of a data structure&#x2019;s expected behavior.  Moreover, because the tests can be executed, one can be certain that the class really has the expected behavior.  With documentation, one sometimes finds that changes in the code are not reflected in the documentation, but passing tests don&#x2019;t have this problem.</p>
<h2 class="mume-header" id="test-driven-development">Test-Driven Development</h2>

<p><strong>Test-Driven Development (TDD)</strong> is based on the simple idea that you can write the tests before you write the code.  But won&#x2019;t the test fail if the code hasn&#x2019;t been written yet?  Yes, if it&#x2019;s a good test.  What if it passes?  Then, either you&#x2019;re done (unlikely) or there is something wrong with your test.</p>
<p>Writing tests first forces you to do two things:</p>
<ol>
<li>Decide how you want to be able to use some function.  What should the parameters be?  What should it return?</li>
<li>Write only the code that you need.  If there is code that doesn&#x2019;t support some desired behavior with tests, then you don&#x2019;t need to write it.</li>
</ol>
<p>The TDD mantra is <strong>Red-Green-Refactor</strong>.  It refers to three phases of the testing process.</p>
<ul>
<li><strong>Red:</strong> The tests fail.  They better!  You haven&#x2019;t written the code yet!</li>
<li><strong>Green:</strong> You get the tests to pass by changing the code.</li>
<li><strong>Refactor:</strong> You clean up the code, removing duplication.</li>
</ul>
<p>The terms &quot;Red&quot; and &quot;Green&quot; refer to many testing fameworks that show failed tests in red and passing tests in green.</p>
<p><strong>Refactoring</strong> is the process of cleaning up code, most often referring to the process of removing duplication.  Duplication in code, whether it comes from copy-and-paste or just repeating logic can be a source of many errors.  If you duplicate code with a bug, now you have two bugs.  If you find the bug, you will have to find it twice.</p>
<p>Here is a simple example of refactored code:</p>
<p><strong>Original Code with Minor Duplication:</strong></p>
<pre data-role="codeBlock" data-info="python" class="language-python">avg1 <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>L1<span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>L1<span class="token punctuation">)</span>
avg2 <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>L2<span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>L2<span class="token punctuation">)</span>
</pre><p>Then, it is observed that there should be some default behavior for empty lists so (a test is added and) the code is updated as follows.</p>
<p><strong>Updated Code Before Refactoring:</strong></p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L1<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    avg1 <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    avg1 <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>L1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L1<span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L2<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
    avg2 <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    avg2 <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>L2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L2<span class="token punctuation">)</span>
</pre><p><strong>Refactored Code:</strong></p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">avg</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>

avg1 <span class="token operator">=</span> avg<span class="token punctuation">(</span>L1<span class="token punctuation">)</span>
avg2 <span class="token operator">=</span> avg<span class="token punctuation">(</span>L2<span class="token punctuation">)</span>
</pre><p>In the refactored code, the details of the <code>avg</code> function are not duplicated.  If we want to later modify how the code handles empty lists, we will only have to change it in one place.</p>
<p>The refactored code is also easier to read.</p>
<h2 class="mume-header" id="what-to-test">What to Test</h2>

<p>Step away from the computer.  Think about the problem you are trying to solve.  Think about the methods you are writing.  Ask yourself, <em>&quot;What should happen when I run this code?&quot;</em>. Also ask yourself, <em>&quot;How do I want to use this code?&quot;</em></p>
<ul>
<li>Write tests that use the code the way it ought to be used.</li>
<li>Then write tests that use the code incorrectly to test that your code <em>fails gracefully</em>.  Does it give clear error messages?</li>
<li>Test the <em>edge cases</em>, those tricky cases that may rarely come up.  Try to break your own code.</li>
<li>Turn bugs into tests.  A bug or an incorrect behavior can reappear after you fix it.  You want to catch it when it does.  Sometimes you notice a bug when a different test fails.  Write a specific test to reveal the bug, then fix it.</li>
<li>Test the public interface.  Usuually you don&#x2019;t need to or want to test the private methods of a class.  You should treat the test code as a user of the class and it should make no assumptions about private attributes.  This way, if a private gets renamed or refactored, you don&#x2019;t have to change the tests.</li>
</ul>
<h2 class="mume-header" id="testing-and-object-oriented-design">Testing and Object-Oriented Design</h2>

<p>In object-oriented design, we divide the code into classes.  These classes have certain relationships sometimes induced by inheritance or composition.  The classes have public methods.  We call these public methods the <strong>interface</strong> to the class.</p>
<p>To start a design, we look at the problem and identify nouns (classes) and verbs (methods).  In our description, we express what <em>should</em> happen.  Often these expectations are expressed in &quot;if...then&quot; language, i.e., &quot;if I call this method with these parameters, then this will happen.&quot;. A unit test will encode this expectation.  It will check that the actual behavior of the code matches the expected behavior.</p>
<p>When writing a class, it helps focus our attention and reduce the number fo things to think about if we assume each class works the way it is supposed to.  We try to make this true by testing each class individually.  Then, when we compose classes into more complex classes, we can have more confidence that any errors we find are in the new class and not somewhere lurking in the previously written classes.</p>
<p>At first it may seem like a waste of time to thoroughly test your code.  However, any small savings in time you might reap early on by skipping tests will very quickly be spent in the headaches of countless hours debugging untested code.  When you have lots of untested code, every time there is an unexpected behavior, the error could be anywhere.  The debugging process can virtually grind to a halt.  If and when this happens to you: Stop. Pick one piece. Test it. Repeat.  Being careful and systematic will take you substantially less time overall. <strong>It is faster to go slow</strong>.</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_04" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 4
    </p>
    <hr>
<h1 class="mume-header" id="running-time-analysis">Running Time Analysis</h1>

<p>Our major goal in programming is to write code that is <em>correct</em>, <em>efficient</em>, and <em>readable</em>.
When writing code to solve a problem, there are many ways to write correct code.
When the code is not correct, we debug it.
When the code is inefficient, we may not notice when running small tests because we only see the problem when inputs get larger.
It can be much harder to track down problems with efficiency.</p>
<p>We want to develop a vocabulary for describing the efficiency of our code.
Sentences like &quot;This code is fast&quot; or &quot;This code is slow&quot; tell us very little.
How fast or slow is it?
Moreover, the same code will take different amounts of time and memory depending on the input.
It will also run faster on a faster computer.
So, our goals are challenging:</p>
<blockquote>
<p>We want to give a nuanced description of the efficiency of a program that adapts to <em>different inputs</em> and to <em>different computers</em>.</p>
</blockquote>
<p>We will achieve both goals with <strong>asymptotic analysis</strong>.
To develop this theory, we will start by measuring the time taken to run some programs.
By simple experiments, we can observe how the running times change as the inputs get larger.
For example, a program that takes a list as input may run slower if that list has a million items than if it only has ten items, but maybe not.
It will depend on the program.</p>
<p>Next, we will give an accounting scheme for counting up the <strong>cost</strong> of a program.
This will assign costs to different operations.
The cost of the whole program will be the sum of the costs of all the operations executed by the program.
Often, the cost will be a function of the input size, rather than a fixed number.</p>
<p>Finally, we will introduce some vocabulary for classifying functions.
This is the asymptotic part of asymptotic analysis.
The <strong>big-O</strong> notation gives a very convenient way of grouping this (running time) functions into classes that can easily be compared.
Thus, we&apos;ll be able to talk about and compare the efficiency of different algorithms or programs without having to do extensive experiments.</p>
<p>Thinking about and analyzing the efficiency of programs helps us develop good habits and intuitions that lead to good design decisions.
The goal of increasing efficiency in our data structures will be the primary motivation for introducing new structures and new ideas
as we proceed.</p>
<h2 class="mume-header" id="timing-programs">Timing Programs</h2>

<p>To start, let&apos;s observe some differences in running time for different functions that do the same thing.
We might say these functions have the same behavior or the same <strong>semantics</strong>.</p>
<p>Here is a function that takes a list as input; it returns <code>True</code> if there are any duplicates and <code>False</code> otherwise.</p>
<div class="code-chunk" data-id="duplicates1" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=34, cmd id=&quot;duplicates1&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">duplicates1</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">!=</span> j <span class="token operator">and</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">assert</span><span class="token punctuation">(</span>duplicates1<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token operator">not</span> duplicates1<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>A basic question that we will ask again and again is the following?</p>
<blockquote>
<p>How fast is this code?</p>
</blockquote>
<p>The simplest answer to this question comes from simply running the program and measuring how long it takes.
We could do this as follows.</p>
<div class="code-chunk" data-id="j543h66u" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=35, cmd continue=&quot;duplicates1&quot; id=&quot;j543h66u&quot;}" class="language-python"><span class="token keyword">import</span> time

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token number">1000</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    duplicates1<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    timetaken <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Time taken for n = &quot;</span><span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token string">&quot;: &quot;</span><span class="token punctuation">,</span> timetaken<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Time taken for n =  1000 :  1.8518569469451904
Time taken for n =  1000 :  0.4454491138458252
Time taken for n =  1000 :  0.3369910717010498
Time taken for n =  1000 :  0.29959917068481445
Time taken for n =  1000 :  0.39844179153442383
</pre></div></div><p>Notice that we see some variation in the time required.
This is caused by many factors, but the main one is that the computer is performing many other tasks at the same time.
It is running an operating system and several other programs at the same time.
Also, if run on different computers, one could expect to see wildly different results based on the speed of the processor and other differences between the computers.
For now, let&apos;s run the code several times and take the average to smooth them out for a given computer.
We&apos;ll wrap this idea in a general function that takes another function as input, and a length.
It runs the given function on lists of the given length and averages the time take per run.</p>
<div class="code-chunk" data-id="timetrials" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=36, cmd continue=&quot;duplicates1&quot; id=&quot;timetrials&quot;}" class="language-python"><span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">timetrials</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> n<span class="token punctuation">,</span> trials <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    totaltime <span class="token operator">=</span> <span class="token number">0</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>trials<span class="token punctuation">)</span><span class="token punctuation">:</span>
        func<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        totaltime <span class="token operator">+=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;average =%10.7f for n = %d&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>totaltime<span class="token operator">/</span>trials<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>We can now look at the average running time as the length of the list gets longer.
It&apos;s not surprising to see that the average time goes up as the length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> increases.</p>
<div class="code-chunk" data-id="j543zqs2" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=37, cmd continue=&quot;timetrials&quot; id=&quot;j543zqs2&quot;}" class="language-python"><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">3200</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    timetrials<span class="token punctuation">(</span>duplicates1<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">average = 0.0024803 for n = 50
average = 0.1164138 for n = 100
average = 0.3578582 for n = 200
average = 1.0359500 for n = 400
average = 1.1122982 for n = 800
average = 3.8332858 for n = 1600
average =10.1191428 for n = 3200
</pre></div></div><p>Let&apos;s try to make our code faster.
Simple improvements can be made by eliminating situations where we are doing unnecessary or redundant work.
In the <code>duplicates1</code> function, we are comparing each pair of elements twice because both <code>i</code> and <code>j</code> range over all <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> indices.
We can eliminate this using a standard trick of only letting <code>j</code> range up to <code>i</code>.
Here is what the code would look like.</p>
<div class="code-chunk" data-id="duplicates2" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=38, cmd continue=&quot;timetrials&quot;, id=&quot;duplicates2&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">duplicates2</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="j544j8r7" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=39, cmd continue=&quot;duplicates2&quot;, id=&quot;j544j8r7&quot;}" class="language-python"><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">3200</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    timetrials<span class="token punctuation">(</span>duplicates2<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">average = 0.0008192 for n = 50
average = 0.0155221 for n = 100
average = 0.0759071 for n = 200
average = 0.7172584 for n = 400
average = 0.6758642 for n = 800
average = 1.5905780 for n = 1600
average = 5.2967585 for n = 3200
</pre></div></div><p>There is a python shortcut the kind of loop used in <code>duplicates2</code>.
The <code>any</code> function takes an iterable collection of booleans and returns <code>True</code> if any of the booleans are true.
You can make an iterable collection in an expression in the same way one does for comprehensions.
This can be very handy.</p>
<div class="code-chunk" data-id="duplicates3" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=40, cmd continue=&quot;timetrials&quot; id=&quot;duplicates3&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">duplicates3</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="j544qfui" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=41, cmd continue=&quot;duplicates3&quot;, id=&quot;j544qfui&quot;}" class="language-python"><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">3200</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    timetrials<span class="token punctuation">(</span>duplicates3<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">average = 0.0013027 for n = 50
average = 0.0041689 for n = 100
average = 0.1940023 for n = 200
average = 0.9592630 for n = 400
average = 0.6890199 for n = 800
average = 2.1572227 for n = 1600
average = 6.6591870 for n = 3200
</pre></div></div><p>This last optimization reduces the number of lines of code and may be desirable for code readability, but it doesn&apos;t improve the speed.</p>
<p>If we want to make a real improvement, we&apos;ll need a substantial new idea.
One possibility is to sort the list and look at adjacent elements in the list.
If there are duplicates, they will be adjacent after sorting.</p>
<div class="code-chunk" data-id="duplicates4" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=42, cmd continue=&quot;timetrials&quot; id=&quot;duplicates4&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">duplicates4</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    L<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="duplicates5" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=43, cmd continue=&quot;duplicates3&quot;, id=&quot;duplicates5&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">duplicates5</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    L<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">duplicates6</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> e <span class="token keyword">in</span> L<span class="token punctuation">:</span>
        <span class="token keyword">if</span> e <span class="token keyword">in</span> s<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">duplicates7</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">duplicates8</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>e <span class="token keyword">in</span> s <span class="token operator">or</span> s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> L<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="j544qfur" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=44, cmd continue=&quot;duplicates5&quot;, id=&quot;j544qfur&quot;}" class="language-python"><span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">1600</span><span class="token punctuation">,</span> <span class="token number">3200</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Quadratic: &quot;</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    timetrials<span class="token punctuation">(</span>duplicates3<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Sorting:   &quot;</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    timetrials<span class="token punctuation">(</span>duplicates5<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Sets:      &quot;</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    timetrials<span class="token punctuation">(</span>duplicates7<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;---------------------------&apos;</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Quadratic: average = 0.0032634 for n = 50
Sorting:   average = 0.0000782 for n = 50
Sets:      average = 0.0000278 for n = 50
---------------------------
Quadratic: average = 0.0046324 for n = 100
Sorting:   average = 0.0769885 for n = 100
Sets:      average = 0.0000414 for n = 100
---------------------------
Quadratic: average = 0.0787251 for n = 200
Sorting:   average = 0.0009244 for n = 200
Sets:      average = 0.0000571 for n = 200
---------------------------
Quadratic: average = 0.9280167 for n = 400
Sorting:   average = 0.0006500 for n = 400
Sets:      average = 0.0001098 for n = 400
---------------------------
Quadratic: average = 0.6709501 for n = 800
Sorting:   average = 0.0009470 for n = 800
Sets:      average = 0.0002243 for n = 800
---------------------------
Quadratic: average = 2.1743325 for n = 1600
Sorting:   average = 0.0019652 for n = 1600
Sets:      average = 0.0005208 for n = 1600
---------------------------
Quadratic: average = 6.7035970 for n = 3200
Sorting:   average = 0.0041606 for n = 3200
Sets:      average = 0.0008269 for n = 3200
---------------------------
</pre></div></div><p>Some key ideas:
The Data Structures really matter.  The speed of the set membership testing or set construction gives a big improvement.
We made assumptions about the elements of the list, that they were comparable or hashable.  These assumptions can be thought of as assumptions about the <em>type</em> of the elements.  This is not the same as the class.  It&apos;s duck typing.  The assumption is that certain methods can be called.
The example also gives some practice using generator expressions.</p>
<p>The main important idea is that the running time depends on the size of the input.  The time goes up as the length goes up.
Sometimes, the gap between two pieces of code will increase as the input size grows.</p>
<h2 class="mume-header" id="example-adding-the-first-k-numbers">Example: Adding the first k numbers.</h2>

<p>Below is a program that adds up the first <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> positive integers and returns both the sum and time required to do the computation.</p>
<div class="code-chunk" data-id="sumk1" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=45, cmd id=&quot;sumk1&quot;}" class="language-python"><span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">sumk</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

    total <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        total <span class="token operator">=</span> total <span class="token operator">+</span> i
    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> total<span class="token punctuation">,</span> end<span class="token operator">-</span>start
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="j54378j3" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=46, cmd continue=&quot;sumk1&quot; id=&quot;j54378j3&quot;}" class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Sum: %d, time taken: %f&quot;</span> <span class="token operator">%</span> sumk<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Sum: 50005000, time taken: 0.000869
Sum: 50005000, time taken: 0.000859
Sum: 50005000, time taken: 0.000864
Sum: 50005000, time taken: 0.000888
Sum: 50005000, time taken: 0.000873
</pre></div></div><p>Notice that we see some variation in the time required.
This is caused by many factors, but the main one is that the computer is performing many other tasks at the same time.
It is running an operating system and several other programs at the same time.
Also, if run on different computers, one could expect to see wildly different results based on the speed of the processor and other differences between the computers.
For now, let&apos;s run the code several times and take the average to smooth them out for a given computer.</p>
<div class="code-chunk" data-id="timetrials2" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=47, cmd continue=&quot;sumk1&quot; id=&quot;timetrials2&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">timetrials</span><span class="token punctuation">(</span>func<span class="token punctuation">,</span> k<span class="token punctuation">,</span> trials <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    totaltime <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>trials<span class="token punctuation">)</span><span class="token punctuation">:</span>
        totaltime <span class="token operator">+=</span> func<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;average =%10.7f for k = %d&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>totaltime<span class="token operator">/</span>trials<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="j5437vpd" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=48, cmd continue=&quot;timetrials2&quot; id=&quot;j5437vpd&quot;}" class="language-python">timetrials<span class="token punctuation">(</span>sumk<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
timetrials<span class="token punctuation">(</span>sumk<span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span>
timetrials<span class="token punctuation">(</span>sumk<span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
timetrials<span class="token punctuation">(</span>sumk<span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">average = 0.0008822 for k = 10000
average = 0.1074006 for k = 100000
average = 0.2528910 for k = 1000000
average = 1.2954269 for k = 10000000
</pre></div></div><p>Seeing the times for different values of <code>k</code> reveals a rather unsuprising pattern.
As <code>k</code> goes up by a factor of 10, the time required for <code>sumk</code> also goes up by a factor of <code>10</code>.
This makes sense, because it has to do about <code>k</code> additions and assignments.
To say it another way, the time is proportional to <code>k</code>.
We will often be more concerned with finding what the running time is proportional to than finding the exact time itself.
We expect to see this relationship between the running time and the input <code>k</code> regardless of what computer we run the code on.</p>
<p>The code we wrote seems to be correct, however, there is another, much simpler way to compute the sum of the numbers from <code>1</code> to <code>k</code> using a formula that is very important for this class.
It will show up again and again.
To prove that</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><munderover><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>k</mi></munderover><mi>i</mi><mo>=</mo><mn>1</mn><mo>+</mo><mn>2</mn><mo>+</mo><mn>3</mn><mo>+</mo><mo>&#x22EF;</mo><mo>+</mo><mi>k</mi><mo>=</mo><mi>k</mi><mo>(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo>)</mo><mi mathvariant="normal">/</mi><mn>2</mn><mo separator="true">,</mo></mrow><annotation encoding="application/x-tex">\sum_{i = 1}^k i = 1 + 2 + 3 + \cdots + k = k (k + 1) / 2,</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:3.1137820000000005em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">&#x2211;</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="minner">&#x22EF;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">2</span><span class="mpunct">,</span></span></span></span></span></p>
<p>it suffices to observe that you can add the numbers in pairs, matching <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathit">i</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>&#x2212;</mo><mi>i</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-i + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> starting with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>.
There are <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">k/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord">/</span><span class="mord">2</span></span></span></span> such pairs and each adds up to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k+1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>.
Let&apos;s use this formula to rewrite our <code>sumk</code> function and time it.</p>
<div class="code-chunk" data-id="j5439nl1" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=49, cmd continue=&quot;timetrials2&quot; id=&quot;j5439nl1&quot;}" class="language-python"><span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">sumk2</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    total <span class="token operator">=</span> <span class="token punctuation">(</span>k<span class="token operator">*</span><span class="token punctuation">(</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span>
    end <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> total<span class="token punctuation">,</span> end<span class="token operator">-</span>start

timetrials<span class="token punctuation">(</span>sumk2<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
timetrials<span class="token punctuation">(</span>sumk2<span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">)</span>
timetrials<span class="token punctuation">(</span>sumk2<span class="token punctuation">,</span> <span class="token number">1000000</span><span class="token punctuation">)</span>
timetrials<span class="token punctuation">(</span>sumk2<span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">)</span>
timetrials<span class="token punctuation">(</span>sumk2<span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">average = 0.0000006 for k = 10000
average = 0.0000002 for k = 100000
average = 0.0000004 for k = 1000000
average = 0.0000004 for k = 10000000
average = 0.0000004 for k = 100000000
</pre></div></div><p>This is much much faster.
Even as <code>k</code> becomes very large, it doesn&apos;t seem to slow down.</p>
<h2 class="mume-header" id="modeling-the-running-time-of-a-program">Modeling the Running Time of a Program</h2>

<p>We will introduce a general technique for describing and summarizing the number of operations required to run a piece of code, be it a single line, a function, or an entire program.
Along the way, we will develop a vocabulary for comparing the efficiency of algorithms that doesn&apos;t require us to run them and time them.</p>
<p>It&apos;s not enough to count lines of code.
A single line of code can do a lot of stuff.
Here&apos;s a one line function that does all kinds of stuff.
It creates a list of 200 items and sums all the entries for each of value of i from 0 to k-1 and returns a list of the results.</p>
<div class="code-chunk" data-id="j543abkc" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=50, cmd id=&quot;j543abkc&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">f001</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f001<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">[100, 300, 500, 700, 900, 1100, 1300, 1500, 1700]
</pre></div></div><p>Instead, we will want to count operations a little more carefully.
The unit we will use to describe the <strong>running time</strong> of an algorithm is the number of atomic operations.
This is not exactly a unit of time, but at some level, the atomic operations that we will describe can all be performed in a small number of clock cycles on your CPU and so correspond to a real amount of time.</p>
<p><em>(Please don&apos;t say &quot;runtime&quot; as a replacement for &quot;running time&quot;.  These are not the same thing!)</em></p>
<p>Atomic operations include</p>
<ul>
<li>arithmetic and boolean operations</li>
<li>variable assignment</li>
<li>accessing the value of a variable from its name</li>
<li>branching (jumping to another part of the code for if/for/while statements)</li>
<li>calling a function</li>
<li>returning from a function</li>
</ul>
<p>Below, there is listings of the asymptotic running time of the most common operations on the standard python collections classes.
You should familiarize yourself with these listings.
In particular, you should be aware of which operations on collections produce a new copy of the collection.
For example, concatenation and slicing both produce a new collection and thus the running times are proportional to the length of the newly created collection.
In almost all cases, one can see the reason for the running times by understanding what work the algorithms must do and also how the data structure is laid out in memory.</p>
<h3 class="mume-header" id="list-operations">List Operations</h3>

<table>
<thead>
<tr>
<th>Operation Name</th>
<th>Code</th>
<th style="text-align:center">Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>index access</td>
<td><code>L[i]</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>index assignment</td>
<td><code>L[i] = newvalue</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>Append</td>
<td><code>L.append(newitem)</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>Pop (from end of list)</td>
<td><code>L.pop()</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>Pop (from index <code>i</code>)</td>
<td><code>L.pop(i)</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">n - i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathit">i</span></span></span></span></td>
</tr>
<tr>
<td>Insert at index <code>i</code></td>
<td><code>insert(i, newitem)</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">n-i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathit">i</span></span></span></span></td>
</tr>
<tr>
<td>Delete an item (at index <code>i</code>)</td>
<td><code>del(item)</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mi>i</mi></mrow><annotation encoding="application/x-tex">n - i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathit">i</span></span></span></span></td>
</tr>
<tr>
<td>Membership testing</td>
<td><code>item in L</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span></td>
</tr>
<tr>
<td>Slice</td>
<td><code>L[a:b]</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo>&#x2212;</mo><mi>a</mi></mrow><annotation encoding="application/x-tex">b-a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathit">b</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">a</span></span></span></span></td>
</tr>
<tr>
<td>Concatenate two lists</td>
<td><code>L1 + L2</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>1</mn></msub><mo>+</mo><msub><mi>n</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">n_1 + n_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td>Sort</td>
<td><code>L.sort()</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><msub><mi>log</mi><mo>&#x2061;</mo><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">n \log_2 n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span></span></span></span></td>
</tr>
</tbody>
</table>
<p>Note that these running times are the same for the other sequential collections, <code>list</code> and <code>str</code> assuming the operation exists for those immutable types.
For example, index access, membership testing, slicing, and concatenation all work.
Remember that slicing and concatenation produce new objects and don&apos;t change the originals.</p>
<h3 class="mume-header" id="dictionary-operations">Dictionary Operations</h3>

<p>Unlike the <code>list</code> operations, the costs of <code>dict</code> operations are a bit mysterious.
Some may seem downright impossible.
Should it really cost just one atomic operation to test if a given item is in a set of a billion elements?
There are three things to remember:</p>
<ol>
<li>We will study how dictionaries are implemented and how they exploit one of the wonderful, clever ideas of computer science.</li>
<li>This is just a model, albeit a useful and accurate one.</li>
<li>The actual cost is a kind of average.  It could take longer sometimes.</li>
</ol>
<table>
<thead>
<tr>
<th>Operation Name</th>
<th>Code</th>
<th style="text-align:center">Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>Get item</td>
<td><code>D[key]</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>Set item</td>
<td><code>D[key] = value</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>(key) membership testing</td>
<td><code>key in D</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>Delete an item by its key</td>
<td><code>del D[key]</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
</tbody>
</table>
<h3 class="mume-header" id="set-operations">Set Operations</h3>

<p>A <code>set</code> is very much like a <code>dict</code> where the entries have keys but no values.
They are implemented the same way and so, the running times for their common operations are the same.
Some set operations that correspond to our mathematical idea of a set do not correspond to operations on dictionaries.
Operations that produce a new set will leave the input sets unchanged.
Below, let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">n_A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">A</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> be the size of set <code>A</code> and let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">n_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> be the size of set <code>B</code>.</p>
<table>
<thead>
<tr>
<th>Operation Name</th>
<th>Code</th>
<th style="text-align:center">Cost</th>
</tr>
</thead>
<tbody>
<tr>
<td>Add a new item</td>
<td><code>A.add(newitem)</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>Delete an item</td>
<td><code>A.delete(item)</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></td>
</tr>
<tr>
<td>Union</td>
<td><code>A | B</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>A</mi></msub><mo>+</mo><msub><mi>n</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">n_A + n_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">A</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td>Intersection</td>
<td><code>A &amp; B</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>min</mi><mo>&#x2061;</mo><mo>{</mo><msub><mi>n</mi><mi>A</mi></msub><mo separator="true">,</mo><msub><mi>n</mi><mi>B</mi></msub><mo>}</mo></mrow><annotation encoding="application/x-tex">\min\{n_A, n_B\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">{</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">A</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></td>
</tr>
<tr>
<td>Set differences</td>
<td><code>A - B</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>A</mi></msub></mrow><annotation encoding="application/x-tex">n_A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">A</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td>Symmetric Difference</td>
<td><code>A ^ B</code></td>
<td style="text-align:center"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>A</mi></msub><mo>+</mo><msub><mi>n</mi><mi>B</mi></msub></mrow><annotation encoding="application/x-tex">n_A + n_B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">A</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.05017em;">B</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></td>
</tr>
</tbody>
</table>
<h2 class="mume-header" id="asymptotic-analysis-and-the-order-of-growth">Asymptotic Analysis and the Order of Growth</h2>

<p>The goal is not to predict exactly how much time an algorithm will take, but rather to predict the <strong>order of growth</strong> of the time as the input size grows.
That is, if we have algorithm that operates on a list of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>, the running time could be proportional to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.
In that case, the algorithm will take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>100</mn></mrow><annotation encoding="application/x-tex">100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span> times longer on a list that is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>100</mn></mrow><annotation encoding="application/x-tex">100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span> times longer.
A second algorithm might have a running time proportional to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> for inputs of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.
Then, the algorithm will take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>10000</mn></mrow><annotation encoding="application/x-tex">10000</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span><span class="mord">0</span></span></span></span> times longer on a list that is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>100</mn></mrow><annotation encoding="application/x-tex">100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span> times longer.
Notice, that <em>the exact constant of proportionality is not important for these facts.</em></p>
<p>The <em>size of the input</em> refers to the number of bits needed to encode it.
As we will be ignoring constant factors, we could just as easily refer to the number of words (a word is 64 bits) needed to encode it.
An integer or a float is generally stored in one word.
Technically, we can store some really big numbers in a python integer which would require many more words, but as a convention, we will assume that ints and floats fit in a constant number of bits.
This is necessary to assume that arithmetic takes constant time.</p>
<h2 class="mume-header" id="focus-on-the-worst-case">Focus on the Worst Case</h2>

<p>Usually, different inputs of the same length may have different running times.
The standard convention we will use most of the time is to consider the worst case.
We are looking for <strong>upper bounds</strong> on the running time.
If the algorithm has a running time that is better than the analysis predicts, that&apos;s okay.</p>
<h2 class="mume-header" id="big-o">Big-O</h2>

<p>We will almost always describe running times as a function of the input size.
That is, the running time on an input of size <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> might be <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>n</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">5n^2 + 3n + 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>.
If we were to write this as a (mathematical) function of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>, we could call it <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span> and write <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>n</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(n) = 5n^2 + 3n + 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>.
In this example, the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">5n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> is by far the most important</p>
<p>The formal mathematical definition that allows us to ignore constant factors is called the <strong>big-O notation</strong>.
As a warmup example, we say that
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">f(n) = O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>
if there exists a constant <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">c</span></span></span></span> such that</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>&#x2264;</mo><mi>c</mi><msup><mi>n</mi><mn>2</mn></msup><mtext>for&#xA0;all&#xA0;sufficiently&#xA0;large&#xA0;</mtext><mi>n</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">f(n) \le cn^2 \text{for all sufficiently large } n.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.0585479999999998em;vertical-align:-0.19444em;"></span><span class="mord mathit">c</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord text"><span class="mord">for&#xA0;all&#xA0;sufficiently&#xA0;large&#xA0;</span></span><span class="mord mathit">n</span><span class="mord">.</span></span></span></span></span></p>
<p>This is correct for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>n</mi><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">f(n) = 5n^2 + 3n + 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> because if we take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mo>=</mo><mn>6</mn></mrow><annotation encoding="application/x-tex">c = 6</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">6</span></span></span></span>, we see that as long as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">n &gt; 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span>, we have</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>n</mi><mo>+</mo><mn>2</mn><mo>&lt;</mo><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><mn>4</mn><mi>n</mi><mo>&lt;</mo><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><msup><mi>n</mi><mn>2</mn></msup><mo>&#x2264;</mo><mn>6</mn><msup><mi>n</mi><mn>2</mn></msup><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">f(n) = 5n^2 + 3n + 2 &lt; 5n^2 + 4n &lt; 5n^2 + n^2 \le 6n^2.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68354em;vertical-align:-0.0391em;"></span><span class="mord">4</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9474379999999999em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.0000779999999998em;vertical-align:-0.13597em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8641079999999999em;vertical-align:0em;"></span><span class="mord">6</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p>
<p>The above inequalities came from repeated using the fact that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">n &gt; 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span>.</p>
<p>We can now state the formal definition of the big-O notation:
Given (nondecreasing) functions <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>g</mi></mrow><annotation encoding="application/x-tex">g</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.03588em;">g</span></span></span></span>, we say <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><mi>O</mi><mo>(</mo><mi>g</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">f(n) = O(g(n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> if there exist constants <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">c</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">n_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> such that for all <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&gt;</mo><msub><mi>n</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">n&gt;n_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> we have <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>&#x2264;</mo><mi>c</mi><mi>g</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">f(n) \le cg(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">c</span><span class="mord mathit" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.</p>
<h2 class="mume-header" id="the-most-important-features-of-big-o-usage">The most important features of big-O usage</h2>

<ol>
<li>
<p>The big-O <em>hides constant factors</em>.  Any term that does not depend on the size of the input is considered a constant and will be suppressed in the big-O.</p>
</li>
<li>
<p>The big-O tells us about what will eventually be true <em>when the input is sufficiently large</em>.</p>
</li>
</ol>
<p>These two features are present in the formal definition.
The constant <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">c</span></span></span></span> is the constant that stands in for all other constant factors.
This constant also allows us to suppress lower order terms.
The constant <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">n_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the threshold after which the inequality is true.</p>
<h1 class="mume-header" id="practical-use-of-the-big-o-and-common-functions">Practical Use of the Big-O and Common Functions</h1>

<p>Even though the definition of the big-O notation allows us to compare all kinds of functions, we will usually use it to simplify functions, eliminating extraneous constants and low order terms.
So, for example, you should write <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> instead of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>3</mn><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(3n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">3</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> instead of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>5</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><mn>3</mn><mi>n</mi><mo>+</mo><mn>2</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(5n^2 + 3n + 2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">5</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span></span>.
There are several functions that will come up so often that we will want to have them in our vocabulary.</p>
<ul>
<li><strong>Constant Functions</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mn>1</mn><mo>)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></li>
<li><strong>Logarithmic Functions</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></li>
<li><strong>Linear Functions</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></li>
<li><strong>&quot;n Log n&quot;</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span></li>
<li><strong>Quadratic Functions</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li><strong>Polynomial Functions</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mi>k</mi></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.099108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> for some constant <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>.</li>
<li><strong>Exponential Functions</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mn>2</mn><mi>n</mi></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(2^n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> (this is different from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow></msup></mrow><annotation encoding="application/x-tex">2^{O(n)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8879999999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right:0.02778em;">O</span><span class="mopen mtight">(</span><span class="mord mathit mtight">n</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span>)</li>
<li><strong>Factorial Functions</strong>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>!</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n!)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">!</span><span class="mclose">)</span></span></span></span></li>
</ul>
<h2 class="mume-header" id="bases-for-logarithms">Bases for Logarithms</h2>

<p>You may have noticed that we didn&apos;t give a base for the logarithm above.
The reason is that inside the big-O, logarithms of any constant base are the same.
That is, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mi>a</mi></msub><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><mi>O</mi><mo>(</mo><msub><mi>log</mi><mo>&#x2061;</mo><mi>b</mi></msub><mo>(</mo><mi>n</mi><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\log_a(n) = O(\log_b(n))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.24196799999999993em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">b</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mclose">)</span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">a</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit">b</span></span></span></span> are any two constants.
Here&apos;s the proof.
Let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mi>b</mi></msub><mo>(</mo><mi>a</mi><mo>)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">c = \frac{1}{\log_b(a)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">c</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3762159999999999em;vertical-align:-0.5311079999999999em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop mtight">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.23015999999999992em;"><span style="top:-2.2341314285714287em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">b</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.26586857142857145em;"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathit mtight">a</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.5311079999999999em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n_0 = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mi>a</mi></msub><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><mfrac><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mi>b</mi></msub><mo>(</mo><mi>n</mi><mo>)</mo></mrow><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mi>b</mi></msub><mo>(</mo><mi>a</mi><mo>)</mo></mrow></mfrac><mo>&#x2264;</mo><mi>c</mi><msub><mi>log</mi><mo>&#x2061;</mo><mi>b</mi></msub><mo>(</mo><mi>n</mi><mo>)</mo><mtext>&#xA0;for&#xA0;all&#xA0;</mtext><mi>n</mi><mo>&gt;</mo><msub><mi>n</mi><mn>0</mn></msub><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">\log_a(n) = \frac{\log_b(n)}{\log_b(a)} \le c \log_b(n) \text{ for all }n&gt;n_0.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.057252em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">a</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.24196799999999993em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">b</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">a</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.24196799999999993em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">b</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">c</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.24196799999999993em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">b</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mord text"><span class="mord">&#xA0;for&#xA0;all&#xA0;</span></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">.</span></span></span></span></span></p>
<h1 class="mume-header" id="practice-examples">Practice examples</h1>

<p>In each of the following examples, assume the input is a list of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">f002</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>    
    newlist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 2 creating a new list and variable assignment</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> L<span class="token punctuation">:</span>   <span class="token comment"># loops n times</span>
        <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>  <span class="token comment"># 1</span>
            newlist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment"># 1 (append is constant time on lists)</span>
    <span class="token keyword">return</span> newlist  <span class="token comment"># 1 return</span>
</pre><p>Let&apos;s count up the cost of each line of code.
The costs are in the comments.
So, the total cost is something like <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mi>n</mi><mo>+</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">2n+3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span></span></span></span> in the worst case (i.e. when all the items are even).
We would report this as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> and we would call this a <strong>linear-time</strong> algorithm, or sometimes simply a linear algorithm.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">f003</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">0</span>   <span class="token comment"># 1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> L<span class="token punctuation">:</span>   <span class="token comment"># loop n times</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> L<span class="token punctuation">:</span>   <span class="token comment"># loop n times</span>
            x <span class="token operator">+=</span> i<span class="token operator">*</span>j  <span class="token comment"># 3 two arithmetic operations and assignment</span>
    <span class="token keyword">return</span> x <span class="token comment"># 1</span>
</pre><p>Again, let&apos;s count up the cost of each line of code.
The costs are in the comments.
The inner loop costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><mi>n</mi></mrow><annotation encoding="application/x-tex">3n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">3</span><span class="mord mathit">n</span></span></span></span> and it runs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> times, so the total for the whole method is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><msup><mi>n</mi><mn>2</mn></msup><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">3n^2 + 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.897438em;vertical-align:-0.08333em;"></span><span class="mord">3</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>.
We would report this as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> and call this a <strong>quadratic-time</strong> algorithm, or sometimes simply a quadratic algorithm.</p>
<p>Here&apos;s an example we&apos;ve seen several times.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">f004</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># 1</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># loops n-1 times</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token comment"># loops j times</span>
            x <span class="token operator">+=</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token comment"># 5 two list accesses, two arithmetic operations and assignment</span>
    <span class="token keyword">return</span> x <span class="token comment"># 1</span>
</pre><p>It&apos;s a little trickier to figure this one out because the number of times the inner loop runs changes with each iteration of the outer loop.
In this case, it&apos;s not hard to add up the cost of each of the outer loops one at a time.
The first costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn></mrow><annotation encoding="application/x-tex">5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">5</span></span></span></span>, the second costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>10</mn></mrow><annotation encoding="application/x-tex">10</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span></span></span></span>, and so on to that the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>j</mi></mrow><annotation encoding="application/x-tex">j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span></span>th costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>5</mn><mi>j</mi></mrow><annotation encoding="application/x-tex">5j</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.85396em;vertical-align:-0.19444em;"></span><span class="mord">5</span><span class="mord mathit" style="margin-right:0.05724em;">j</span></span></span></span>.
The total costs (including initializing <code>x</code> and returning is
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mo>+</mo><munderover><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>&#x2212;</mo><mn>1</mn></mrow></munderover><mn>5</mn><mi>i</mi><mo>=</mo><mn>2</mn><mo>+</mo><mn>5</mn><munderover><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>n</mi><mo>&#x2212;</mo><mn>1</mn></mrow></munderover><mi>i</mi><mo>=</mo><mn>2</mn><mo>+</mo><mfrac><mrow><mn>5</mn><mi>n</mi><mo>(</mo><mi>n</mi><mo>&#x2212;</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac><mo>=</mo><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">2 + \sum_{i=1}^{n-1}5i = 2 + 5\sum_{i=1}^{n-1}i = 2 + \frac{5n(n-1)}{2} = O(n^2).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">&#x2211;</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">5</span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="mord">5</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">&#x2211;</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">5</span><span class="mord mathit">n</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
<p>We will see this kind of sum often so it&apos;s worth recognizing it (both in the code and as a mathematical expression).</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_05" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 5
    </p>
    <hr>
<h1 class="mume-header" id="stacks-and-queues">Stacks and Queues</h1>

<h2 class="mume-header" id="abstract-data-types">Abstract Data Types</h2>

<p>Throughout the book, we will use <strong>abstract data types</strong> or <strong>ADTs</strong> as a starting point for any discussion of a particular data structure.
An ADT is not a data structure, but it does tell us about data structures.
The way we use the term ADT, it will be very similar to the term <strong>interface</strong>.
An ADT answers two main questions:</p>
<ol>
<li>What is the <em>data</em> to be stored or represented?</li>
<li>What can we do with the data?</li>
</ol>
<p>These together describe the <strong>behavior</strong> or <strong>semantics</strong> of the data structure.
When we give an ADT, we will list the names of the methods that will be present, what kind of input they take, and what is their expected output.
The ADT may also describe error situations and what should happen if they occur.
A <strong>data structure</strong> is an implementation of an ADT.
To make, this distinction, it is sometimes useful to call them <strong>concrete data structures</strong>, though we will usually omit the word &quot;concrete&quot;.</p>
<p>The ADT tells us what methods the data structure will implement.
However, the ADT <em>does not</em> give an hints or prescriptions for how the data structure is implemented.
This is important both as a definition, but also as a guiding design idea in object-oriented programming, that I will write it again:</p>
<blockquote>
<p><strong>The ADT should be independent of all concerns about its implementation.</strong></p>
</blockquote>
<p>You may have noticed that the two questions ADTs answer are related to the definition of <strong>encapsulation</strong> we gave in our earlier discussion of object-oriented programming.
As such, when we implement data structures in python, we will package them as classes.</p>
<h2 class="mume-header" id="the-stack-adt">The Stack ADT</h2>

<ul>
<li><strong>push</strong> - add a new item to the stack.</li>
<li><strong>pop</strong> - remove and return the next item in Last In First Out (LIFO) ordering.</li>
<li><strong>peek</strong> - return the next item in LIFO ordering.</li>
<li><strong>size</strong> - returns the number of items in the stack (we&apos;ll use the pythonic <code>__len__</code> method)</li>
<li><strong>isempty</strong> - return <code>True</code> if the stack has no items and return <code>False</code> otherwise.</li>
</ul>
<p>This ADT can be implemented quite easily using a <code>list</code>.
We will implement it with a class called <code>ListStack</code>.
Here, we are giving hints about the implementation in the name.
This is more common in Java programming, but we adopt the convention in the book to help us distinguish between different implementations of the same ADT.</p>
<div class="code-chunk" data-id="_liststack_00" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=51, cmd id=&quot;_liststack_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListStack</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">push</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">pop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">peek</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">isempty</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>

</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The <code>Stack</code> class above illustrates the object-oriented strategy of <em>composition</em> (the <code>Stack</code> has a <code>list</code>).  It is also an example of the <strong>Wrapper Pattern</strong>.  The Python builtin <code>list</code> is doing all the heavy lifting, but from the user&apos;s perpective, they don&apos;t know or care how the methods are implemented.  This is not exactly true.  The user would start to care if the performance is bad.  It wouldn&apos;t be too hard to make this inefficient.  For example, we could have implemented the Stack by pushing new items into the front of the list.  Here we use inheritance to avoid rewriting the methods that will not be changing.</p>
<div class="code-chunk" data-id="code-chunk-id-53" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=52, cmd continue=&quot;_liststack_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">BadStack</span><span class="token punctuation">(</span>ListStack<span class="token punctuation">)</span><span class="token punctuation">:</span>    
    <span class="token keyword">def</span> <span class="token function">push</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">pop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">peek</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>A simple asymptotic analysis shows why this implementation is far less efficient.
Inserting a new item into a list requires that all the other items in the list have to move over to make room for the new item.
If we insert at the beginning of the list, then every item has to be copied to a new position.  Thus, the <code>insert</code> call in <code>push</code> takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.
Similarly, if we pop an item at the beginning of the list, then every other item in the list gets moved over one space to fill in the gap.
Thus, the <code>list.pop</code> call in our <code>pop</code> method will take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time as well.   So, <code>push</code> and <code>pop</code> both take linear time in this implementation.  It really earns its name.</p>
<h2 class="mume-header" id="the-queue-adt">The Queue ADT</h2>

<ul>
<li><strong>enqueue</strong> - add a new item to the queue.</li>
<li><strong>dequeue</strong> - remove and return the next item in First In First Out (FIFO) ordering.</li>
<li><strong>len</strong> - returns the number of items in the queue.</li>
<li><strong>isempty</strong> - return <code>True</code> if the queue has no items and return <code>False</code> otherwise.</li>
</ul>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Queue</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">enqueue</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">dequeue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">isempty</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
</pre><p>&quot;But wait,&quot; you say.  &quot;I thought calling <code>pop(0)</code> was a bad thing to do.&quot;</p>
<p>Yes, it takes time proportional to the length of the list, but what can we do?  If we dequeue off the end of the list, we would have to enqueue by inserting into the front of the list.  That&apos;s bad too.</p>
<p>Here&apos;s a different idea.  Let&apos;s not really delete things from the front of the list.  Instead, we&apos;ll ignore them by keeping the index of the head of the queue.</p>
<div class="code-chunk" data-id="_listqueue_00" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=53, cmd id=&quot;_listqueue_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Queue</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">enqueue</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">dequeue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span>self<span class="token punctuation">.</span>_head<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>_head

    <span class="token keyword">def</span> <span class="token function">isempty</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>There is something a little odd about this code: it never gets rid of old items after they have been dequeued.  Even if it deleted them, it still keeps a place in the list for them.  This is a kind of <strong>lazy</strong> update.  Shouldn&apos;t we clean up after ourselves?  Yes, but let&apos;s wait.  Here&apos;s the idea.  If the list ever gets half empty, that is, if <code>_head</code> is more than half the length of <code>_L</code>, then we will bite the bullet and replace <code>_L</code> with a slice of it.  &quot;Biting the bullet&quot; is an especially good turn of phrase here if you view this process as a kind of amputation of the old gangrenous stump of the list.</p>
<div class="code-chunk" data-id="_listqueue_01" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=54, cmd id=&quot;_listqueue_01&quot; continue=&quot;_listqueue_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListQueue</span><span class="token punctuation">(</span>Queue<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">dequeue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span>self<span class="token punctuation">.</span>_head<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token operator">&gt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_L <span class="token operator">=</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span>self<span class="token punctuation">.</span>_head<span class="token punctuation">:</span><span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>_head <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">return</span> item
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>So, it looks like we lost all the benefits of our lazy update, because now we have a <code>dequeue</code> method that sometimes takes linear time.  However, we don&apos;t do that <em>every</em> time.  How expensive is it really?  If we do all our <code>enqueue</code> operations first, and then dequeue all our items afterwards, then some items at the end of the list get moved (i.e. copied to a new memory location during the slicing operation) many times.  The first half of the items don&apos;t get moved at all.  The next quarter of the list (from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">1/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mord">2</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">3/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord">/</span><span class="mord">4</span></span></span></span>) gets moved exactly one time.  The next eighth of the list moves exactly twice.  Of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> total items, there are <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">n/2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0746639999999998em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span></span></span></span></span></span></span></span> items that get moved <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">i-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.74285em;vertical-align:-0.08333em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> times.  Thus the total number of moves for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> items is at most <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><msubsup><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><mi>log</mi><mo>&#x2061;</mo><mi>n</mi></mrow></msubsup><mfrac><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow><msup><mn>2</mn><mi>i</mi></msup></mfrac><mo>&lt;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">n\sum_{i=1}^{\log n} \frac{i-1}{2^i} &lt; n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3340079999999999em;vertical-align:-0.345em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9890079999999999em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029000000000005em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.855664em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7570857142857143em;"><span style="top:-2.786em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathit mtight">i</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&lt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.  So, &quot;on average&quot;,  the cost per item is constant.</p>
<p>This kind of lazy update is very important.  In fact, it&apos;s how python is able to do <code>list.pop</code> quickly.  Technically, <code>pop()</code> can also take linear time for some calls but on average, the cost is constant per operation.  The same idea makes <code>append</code> fast.  In that case, python allocates extra space for the list and every time it fills up, the list is copied to a bigger area, that roughly doubles in size.</p>
<h2 class="mume-header" id="dealing-with-errors">Dealing with errors</h2>

<p>Often, we make assumptions about how a class can or ought to be used.
This is also considered part of the semantics of the class and it affects how we program it.
We would like to write error-free code.
We&apos;d like to make it so that it always works no matter how it gets misused, but sometimes, an error message is the correct behavior.</p>
<p>In python we <strong>raise an error</strong> the way one might throw an egg.
Either someone gently catches it or it crashes.
Depending on the situation, either might be the right thing to do.</p>
<p>In the case of a stack, it is never correct usage to <code>pop</code> from an empty stack.
Thus, it makes sense that someone using our <code>Stack</code> class should have their program crash and see an error message if they attempt to call <code>pop</code> when there are no items left on the stack.
In the list implementation above, this does happen:</p>
<div class="code-chunk" data-id="liststackerror" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=55, cmd id=&quot;liststackerror&quot; continue=&quot;_liststack_00&quot;}" class="language-python">s <span class="token operator">=</span> ListStack<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Traceback (most recent call last):
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/xsashqkx3_code_chunk.py&quot;, line 24, in <module>
    s.pop()
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/xsashqkx3_code_chunk.py&quot;, line 9, in pop
    return self._L.pop()
IndexError: pop from empty list
</module></pre></div></div><p>If we look at the error message, it even seems pretty good.
It says we tried to <code>pop from empty list</code>.
But if you look at the code, you might ask, &quot;What list?&quot;
We know how the <code>ListStack</code> class is implemented, and the name even gives a hint at its implementation, so we might guess what&apos;s going on, but the user does have to search up the stack trace a little to see the line of their own code that caused the problem.
We could catch the exception in our <code>pop</code> method and raise a different error so the source of the problem is more obviously the user&apos;s code.
Otherwise, the stack trace reports the error in our code.
Then, a user, might have to try to understand our class in order to backtrack to understand what they did wrong in their code.
Instead, give them an error that explains exactly what happened.</p>
<div class="code-chunk" data-id="anotherstackerror" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=56, cmd id=&quot;anotherstackerror&quot; continue=&quot;_liststack_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">AnotherStack</span><span class="token punctuation">(</span>ListStack<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">pop</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
            <span class="token keyword">raise</span> RuntimeError<span class="token punctuation">(</span><span class="token string">&quot;pop from empty stack&quot;</span><span class="token punctuation">)</span>

s <span class="token operator">=</span> AnotherStack<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>push<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Traceback (most recent call last):
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/7h4i2br7g_code_chunk.py&quot;, line 24, in pop
    return self._L.pop()
IndexError: pop from empty list

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/7h4i2br7g_code_chunk.py&quot;, line 31, in <module>
    s.pop()
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/7h4i2br7g_code_chunk.py&quot;, line 26, in pop
    raise RuntimeError(&quot;pop from empty stack&quot;)
RuntimeError: pop from empty stack
</module></pre></div></div><p style="page-break-after:always;"></p>
    <a name="chapter_06" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 6
    </p>
    <hr>
<h1 class="mume-header" id="deques-and-linked-lists">Deques and Linked Lists</h1>

<p>A <strong>deque</strong> (pronounced &quot;deck&quot;) is a doubly-ended queue.
It acts like both a stack and a queue, storing an ordered collection of items with the ability to add or remove from both the beginning and the end.
Here is the ADT.</p>
<h2 class="mume-header" id="the-deque-adt">The Deque ADT</h2>

<ul>
<li><strong>addfirst(item)</strong> - add <code>item</code> to the front of the deque.</li>
<li><strong>addlast(item)</strong> - add <code>item</code> to the end of the deque.</li>
<li><strong>removefirst(item)</strong> - remove and return the first item in the deque.</li>
<li><strong>removelast(item)</strong> - remove and return the last item in the deque.</li>
<li><strong>len</strong> - return the number of items in the deque.</li>
</ul>
<p>As a start, let&apos;s see what a deque implementation would look like using a list.</p>
<div class="code-chunk" data-id="_listdeque" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=57, cmd id=&quot;_listdeque&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListDeque</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">addfirst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addlast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">removefirst</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">removelast</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The code is simple enough, but a couple of operations will start to get slow as the deque gets large.
Inserting and popping at index <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.
This follows from the way lists are stored sequentially in memory.
There is no way to change the beginning of the list without shifting all the other elements to make room or fill gaps.
To make this work, we are going to have to give up on the idea of having the items laid out sequentially in memory.
Instead, we&apos;ll store some more information with each item that we can use to extract the order.</p>
<h2 class="mume-header" id="linked-lists">Linked Lists</h2>

<p>Linked lists are a simple data structure for storing a sequential collection.
Unlike a standard python list, it will allow us to insert at the beginning quickly.
The idea is to store the items in individual objects called <strong>nodes</strong>.
A special node is the head of the list.
Each node stores a reference to the next node in the list.</p>
<p>We will use the usual trick of looking back into our intuitive description above to find the nouns that will be the types we will need to define.
In this case, there is the list itself and the nodes.
Let&apos;s write a class for a <code>ListNode</code>.</p>
<div class="code-chunk" data-id="_linkedlist_00" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=58, cmd id=&quot;_linkedlist_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListNode</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> link <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
        self<span class="token punctuation">.</span>link <span class="token operator">=</span> link
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Now, to start the <code>LinkedList</code>, we will store the head of the list.
We will provide two methods, <code>addfirst</code> and <code>removefirst</code> both of which modify the beginning of the list.
These will behove roughly like the push and pop operations of the stack.
This first implementation will hide the nodes from the user.
That is, from a users perspective, they can create a linked list, and they can add and remove nodes, but they don&apos;t have to touch (or even know about) the nodes.
This is abstraction (hiding details)!</p>
<div class="code-chunk" data-id="simplelinkedlist" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=59, cmd id=&quot;simplelinkedlist&quot;, continue=&quot;_linkedlist_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">addfirst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">removefirst</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>data
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>link
        <span class="token keyword">return</span> item
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="implementing-a-queue-with-a-linkedlist">Implementing a Queue with a LinkedList</h2>

<p>Recall that even our best list implementation of a Queue required linear time in the worst case for <code>dequeue</code> operations (though constant on average).
We could hope to do better with a linked list.
However, right now, we have no way to add to or remove from the end of the linked list.
Here is an inefficient, though simple and correct way to do it.</p>
<div class="code-chunk" data-id="linkedlist_A" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=60, cmd id=&quot;linkedlist_A&quot; continue=&quot;_linkedlist_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">addfirst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addlast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>addfirst<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            currentnode <span class="token operator">=</span> self<span class="token punctuation">.</span>_head
            <span class="token keyword">while</span> currentnode<span class="token punctuation">.</span>link <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                currentnode <span class="token operator">=</span> currentnode<span class="token punctuation">.</span>link
            currentnode<span class="token punctuation">.</span>link <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">removefirst</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>data
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>link
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">removelast</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>link <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>removefirst<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            currentnode <span class="token operator">=</span> self<span class="token punctuation">.</span>_head
            <span class="token keyword">while</span> currentnode<span class="token punctuation">.</span>link<span class="token punctuation">.</span>link <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                currentnode <span class="token operator">=</span> currentnode<span class="token punctuation">.</span>link
            currentnode<span class="token punctuation">.</span>link <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">return</span> currentnode<span class="token punctuation">.</span>data
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-62" data-cmd="python"><div class="input-div"><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The new <code>addlast</code> method implements a very common pattern in linked lists.
It starts at the head of the linked list and <strong>traverses</strong> to the end by following the <code>link</code>s.
It uses the convention that the <code>link</code> of the last node is <code>None</code>.</p>
<p>Similarly, <code>removelast</code> traverses the list until it reaches the second to last element.</p>
<p>This traversal approach is not very efficient.
For a list of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>, we would need <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time to find the end.</p>
<p>A different approach might be to store the last node (or <strong>tail</strong>) of the list so we don&apos;t have to search for it when we need it.
This requires a bit of overhead to make sure it always stores the correct node.
Most of the special cases happen when there is only one item in the list.
We will be able to use this to get some improvement for <code>addlast</code>, because we will be able to jump right to the end without traversing.  We will also be able to clean up the code for <code>removelast</code> a little by eliminating the <code>link.link</code> stuff and instead just check if we reached the tail.</p>
<div class="code-chunk" data-id="linkedlist_B" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=62, cmd id=&quot;linkedlist_B&quot; continue=&quot;_linkedlist_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">addfirst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_tail <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> self<span class="token punctuation">.</span>_head

    <span class="token keyword">def</span> <span class="token function">addlast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>add<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link

    <span class="token keyword">def</span> <span class="token function">removefirst</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>data
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>link
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> <span class="token boolean">None</span>
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">removelast</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>removefirst<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            currentnode <span class="token operator">=</span> self<span class="token punctuation">.</span>_head
            <span class="token keyword">while</span> currentnode<span class="token punctuation">.</span>link <span class="token keyword">is</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">:</span>
                currentnode <span class="token operator">=</span> currentnode<span class="token punctuation">.</span>link
            item <span class="token operator">=</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>data
            self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> currentnode
            self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">return</span> item

</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-64" data-cmd="python"><div class="input-div"><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Now we can implement the Queue ADT with a linked list.
It will be surprisingly easy.</p>
<div class="code-chunk" data-id="_linkedqueue" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=64, cmd id=&quot;_linkedqueue&quot;}" class="language-python"><span class="token comment"># linkedqueue.py</span>
<span class="token keyword">from</span> linkedlist <span class="token keyword">import</span> LinkedList

<span class="token keyword">class</span> <span class="token class-name">LinkedQueue</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> LinkedList<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">enqueue</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>addlast<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">dequeue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>removefirst<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="storing-the-length">Storing the length</h2>

<p>With our <code>ListQueue</code>, we implemented <code>__len__</code> to give the number of items in the queue.
To implement the same method on the <code>LinkedQueue</code>, we will want <strong>delegate</strong> the length computation to the <code>LinkedList</code>.</p>
<p>Let&apos;s add the ability to get the length of the linked list.
We&apos;ll do it by storing the length and updating it with each operation.</p>
<div class="code-chunk" data-id="_linkedlist_01" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=65, cmd id=&quot;_linkedlist_01&quot; continue=&quot;_linkedlist_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">LinkedList</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">addfirst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_tail <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> self<span class="token punctuation">.</span>_head
        self<span class="token punctuation">.</span>_length <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">addlast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>addfirst<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link
            self<span class="token punctuation">.</span>_length <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">removefirst</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>data
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>link
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">removelast</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>removefirst<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            currentnode <span class="token operator">=</span> self<span class="token punctuation">.</span>_head
            <span class="token keyword">while</span> currentnode<span class="token punctuation">.</span>link <span class="token keyword">is</span> <span class="token operator">not</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">:</span>
                currentnode <span class="token operator">=</span> currentnode<span class="token punctuation">.</span>link
            item <span class="token operator">=</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>data
            self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> currentnode
            self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link <span class="token operator">=</span> <span class="token boolean">None</span>
            self<span class="token punctuation">.</span>_length <span class="token operator">-=</span> <span class="token number">1</span>
            <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_length
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-67" data-cmd="python"><div class="input-div"><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>We still have to iterate through the whole list in order to remove from the end.
It seems very hard to avoid this.
As a result, our <code>removelast</code> method still takes linear time.
We won&apos;t fix this until the next chapter and it will require a new idea.
So, instead of testing the deque ADT methods now, we&apos;ll instead see how to implement an efficient queue using a linked list.</p>
<h2 class="mume-header" id="testing-against-the-adt">Testing Against the ADT</h2>

<p>Recall that the Queue ADT specifies the expected behavior of a Queue data structure.
It describes the <strong>public interface</strong> to the class.
Now that we can use our <code>LinkedList</code> class to implement a Queue with worst-case constant time operations, we have multiple distinct implementations of the ADT.
Good tests for these data structures would only assume that they implement what is provided in the ADT.
In fact, we probably want to test both implementations with the same tests.</p>
<p>If we rename our first Queue implementations <code>ListQueue</code>, we might have had the following tests for it.</p>
<div class="code-chunk" data-id="code-chunk-id-68" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=67, cmd}" class="language-python"><span class="token keyword">import</span> unittest
<span class="token keyword">from</span> listqueue <span class="token keyword">import</span> ListQueue

<span class="token keyword">class</span> <span class="token class-name">TestListQueue</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">testinit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> ListQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testaddandremoveoneitem</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> ListQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testalternatingaddremove</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> ListQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testmanyoperations</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> ListQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testlength</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> ListQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">.....
----------------------------------------------------------------------
Ran 5 tests in 0.150s

OK
</pre></div></div><p>Now that we have another implementation, we might be tempted to just copy and paste the old tests, changing the references from <code>ListQueue</code> to <code>LinkedQueue</code>.
That is a lot of code duplication and code duplication leads to problems.
For example, suppose we realize that our code has issues if we try to <code>dequeue</code> from an empty queue.
If we decide on the right behavior, we will enforce it with a test.
Do we also copy the test to the other (copied) test file?
What if one implementation is fixed and the other is not?</p>
<p>This is a standard situation where inheritance is called for.
We wanted to copy a bunch of methods to be included in two different classes (<code>TestListQueue</code> and <code>TestLinkedQueue</code>).
Instead we want them to <em>share</em> the methods.
So, we <strong>refactor</strong> the code, by <strong>extracting a superclass</strong>.
Our new class will be called <code>TestQueue</code>.
Both <code>TestListQueue</code> and <code>TestLinkedQueue</code> will extend <code>TestQueue</code>.
Remember extending means inheriting from.</p>
<div class="code-chunk" data-id="_testqueue" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=68, cmd id=&quot;_testqueue&quot;}" class="language-python"><span class="token comment"># testqueue.py</span>
<span class="token keyword">class</span> <span class="token class-name">TestQueue</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">newQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplementedError

    <span class="token keyword">def</span> <span class="token function">testinit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> self<span class="token punctuation">.</span>newQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testaddandremoveoneitem</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> self<span class="token punctuation">.</span>newQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testalternatingaddremove</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> self<span class="token punctuation">.</span>newQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testmanyoperations</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> self<span class="token punctuation">.</span>newQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span>q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">testlength</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        q <span class="token operator">=</span> self<span class="token punctuation">.</span>newQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            q<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>assertEqual<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>q<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The new class looks almost exactly the same as our old <code>TestListQueue</code> class exactly for a couple small changes.
Instead of creating a new <code>ListQueue</code> object in each test, we call a method called <code>newQueue</code>.
In this class, that method is <em>not implemented</em> and you can see it will raise an error telling you so if you were to try to call it.
This method will be overwritten in the extending class to provide the right kind of Queue object.
There is another <em>important difference</em> between the <code>TestQueue</code> class and our old <code>TestListQueue</code> class---the <code>TestQueue</code> class does not extend <code>unittest.TestCase</code>.
It just defines some methods that will be <strong>mixed into</strong> <code>TestListQueue</code> and <code>TestLinkedQueue</code>.
Here are our new test files.</p>
<div class="code-chunk" data-id="code-chunk-id-70" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=69, cmd}" class="language-python"><span class="token comment"># testlistqueue.py</span>
<span class="token keyword">import</span> unittest
<span class="token keyword">from</span> testqueue <span class="token keyword">import</span> TestQueue
<span class="token keyword">from</span> listqueue <span class="token keyword">import</span> ListQueue

<span class="token keyword">class</span> <span class="token class-name">TestListQueue</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">,</span> TestQueue<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">newQueue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> ListQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">.....
----------------------------------------------------------------------
Ran 5 tests in 0.006s

OK
</pre></div></div><div class="code-chunk" data-id="code-chunk-id-71" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=70, cmd}" class="language-python"><span class="token comment"># testlinkedqueue.py</span>
<span class="token keyword">import</span> unittest
<span class="token keyword">from</span> testqueue <span class="token keyword">import</span> TestQueue
<span class="token keyword">from</span> linkedqueue <span class="token keyword">import</span> LinkedQueue

<span class="token keyword">class</span> <span class="token class-name">TestListQueue</span><span class="token punctuation">(</span>unittest<span class="token punctuation">.</span>TestCase<span class="token punctuation">,</span> TestQueue<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">newQueue</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> LinkedQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&apos;__main__&apos;</span><span class="token punctuation">:</span>
    unittest<span class="token punctuation">.</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">.....
----------------------------------------------------------------------
Ran 5 tests in 0.011s

OK
</pre></div></div><p>The classes, <code>TestListQueue</code> and <code>TestLinkedQueue</code>, extend both <code>unittest.TestCase</code> <em>and</em> <code>TestQueue</code>.
This is called <strong>multiple inheritance</strong>.
In other languages like C++ that support multiple inheritance, it is considered a bad design decision.
However, in python, it is appropriate to use it for this kind of <strong>mix in</strong>.
The only thing to remember is that the golden rule of inheritance should still be observed: <strong>inheritance mean &apos;is a&apos;</strong>.</p>
<h2 class="mume-header" id="the-main-lessons">The Main Lessons:</h2>

<ul>
<li>Use the public interface as described in an ADT to <strong>test</strong> your class.</li>
<li>You can use <strong>inheritance</strong> to share functionality between classes.</li>
<li>Inheritance means <strong>&apos;is a&apos;</strong>.</li>
</ul>
<h2 class="mume-header" id="design-patterns-the-wrapper-pattern">Design Patterns:  The Wrapper Pattern</h2>

<p>In the last two chapters, we saw several different implementations of the Queue ADT.
The main ones, <code>LinkedQueue</code> and <code>ListQueue</code> were very simple.
In both cases, we used <strong>composition</strong>, the class stored an object of another class, and then <strong>delegates</strong> most of the operations to the other class.
These are examples of something called the <strong>Wrapper Pattern</strong>.
The Queue in both cases is a wrapper around another data structure.</p>
<p><strong>Design patterns</strong> also known as <strong>object-oriented design patterns</strong> or simply <strong>patterns</strong> are ways of organizing classes in to solve common programming problems.
In the case of the Wrapper Pattern, we have a class that already &quot;sort of&quot; does what we want, but it has different names for the operations and it possibly has many other operations that we don&apos;t want to support.
So, we create a new class that <strong>has an</strong> instance of another class (a <code>list</code> or <code>LinkedList</code> in our example) and then provide methods that operate on that object.
From outside the class, we don&apos;t have to know anything about the wrapped class.
Sometimes, this separation is called a <strong>layer of abstraction</strong>.
The user of our class does not have to know anything about our implementation in order to use the class.</p>
<h2 class="mume-header" id="the-main-lessons-1">The Main Lessons:</h2>

<ul>
<li>Use design patterns where appropriate to organize your code and improve readability.</li>
<li>The Wrapper Pattern gives a way to provide an alternative interface to (a subset of) the methods in another class.</li>
<li>Composition means <strong>&apos;has a&apos;</strong>.</li>
</ul>
<p style="page-break-after:always;"></p>
    <a name="chapter_07" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 7
    </p>
    <hr>
<h1 class="mume-header" id="doubly-linked-lists">Doubly-Linked Lists</h1>

<p>Previously, we introduced the Deque ADT and we gave two implementations, one using a list and one using a linked list.
In our linked list implementation, all of the basic operations ran in constant time except <code>removelast</code>.
In this chapter, we&apos;re going to introduce a new data structure that allows us to do all the Deque operations in constant time.
The key idea will be to store two links in each node, one forwards and one backwards so that we can traverse the list in either direction.
In this <strong>doubly-linked list</strong>, removing from the end will be symmetric to removing from the beginning, with the roles of head and tail reversed.</p>
<p>When we create a new <code>ListNode</code>, we can specify the nodes before and after so that the appropriate links can be established.
We want it to always be true that <code>b == a.link</code> if and only if <code>a = b.prev</code> for any two nodes <code>a</code> and <code>b</code>.
To help ensure this invariant, we set <code>self.prev.link = self</code> and <code>self.link.prev = self</code> unless <code>prev</code> or <code>link</code> respectively are <code>None</code>.</p>
<div class="code-chunk" data-id="_doublylinkedlist_00" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=71, cmd id=&quot;_doublylinkedlist_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListNode</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> data<span class="token punctuation">,</span> prev <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> link <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> data
        self<span class="token punctuation">.</span>prev <span class="token operator">=</span> prev
        self<span class="token punctuation">.</span>link <span class="token operator">=</span> link
        <span class="token keyword">if</span> prev <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>prev<span class="token punctuation">.</span>link <span class="token operator">=</span> self
        <span class="token keyword">if</span> link <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>link<span class="token punctuation">.</span>prev <span class="token operator">=</span> self
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>First, we&apos;ll look at adding items a <code>DoublyLinkedList</code>.
These operations are very similar to the <code>addfirst</code> operation on a <code>LinkedList</code>.
One has to do a little more work to update the <code>prev</code> node that was not present in our <code>LinkedList</code>.</p>
<div class="code-chunk" data-id="_doublylinkedlist_01" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=72, cmd continue=&quot;_doublylinkedlist_00&quot; id=&quot;_doublylinkedlist_01&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">DoublyLinkedList</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_head <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">addfirst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_head <span class="token operator">=</span> self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            newnode <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>prev <span class="token operator">=</span> newnode
            self<span class="token punctuation">.</span>_head <span class="token operator">=</span> newnode
        self<span class="token punctuation">.</span>_length <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">addlast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_head <span class="token operator">=</span> self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            newnode <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link <span class="token operator">=</span> newnode
            self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> newnode
        self<span class="token punctuation">.</span>_length <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_length
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The code above is begging for refactoring.
It&apos;s clear that there is a lot of shared logic between the two methods.
We should use this as an opportunity to simplify the code.
In this case, we might consider the more general problem of adding a node between two other nodes.
We will just need to consider those cases where the nodes <code>before</code> or <code>after</code> or both are <code>None</code>.</p>
<div class="code-chunk" data-id="_doublylinkedlist_02" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=73, cmd continue=&quot;_doublylinkedlist_01&quot;, id=&quot;_doublylinkedlist_02&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">_addbetween</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> before<span class="token punctuation">,</span> after<span class="token punctuation">)</span><span class="token punctuation">:</span>
        node <span class="token operator">=</span> ListNode<span class="token punctuation">(</span>item<span class="token punctuation">,</span> before<span class="token punctuation">,</span> after<span class="token punctuation">)</span>
        <span class="token keyword">if</span> after <span class="token keyword">is</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_head <span class="token operator">=</span> node
        <span class="token keyword">if</span> before <span class="token keyword">is</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> node
        self<span class="token punctuation">.</span>_length <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">addfirst</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_addbetween<span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addlast</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_addbetween<span class="token punctuation">(</span>item<span class="token punctuation">,</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Symmetry is also apparent in the code to remove an item from either end.
As with the <code>add</code> methods, we factor out a (private) method that both use to remove a node and return its data.
It includes a little logic to detect if the head or tail or both change with the removal.</p>
<div class="code-chunk" data-id="_doublylinkedlist_03" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=74, cmd continue=&quot;_doublylinkedlist_02&quot;, id=&quot;_doublylinkedlist_03&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">_remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> node<span class="token punctuation">)</span><span class="token punctuation">:</span>
        before<span class="token punctuation">,</span> after <span class="token operator">=</span> node<span class="token punctuation">.</span>prev<span class="token punctuation">,</span> node<span class="token punctuation">.</span>link
        <span class="token keyword">if</span> node <span class="token keyword">is</span> self<span class="token punctuation">.</span>_head<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_head <span class="token operator">=</span> after
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            before<span class="token punctuation">.</span>link <span class="token operator">=</span> after
        <span class="token keyword">if</span> node <span class="token keyword">is</span> self<span class="token punctuation">.</span>_tail<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> before
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            after<span class="token punctuation">.</span>prev <span class="token operator">=</span> before
        self<span class="token punctuation">.</span>_length <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> node<span class="token punctuation">.</span>data

    <span class="token keyword">def</span> <span class="token function">removefirst</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_head<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">removelast</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_tail<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="concatenating-doubly-linked-lists">Concatenating Doubly Linked Lists</h2>

<p>There are several operations that are very fast on doubly linked lists compared to other lists.
One of the most useful is the ability to concatenate two lists.
Recall that the plus sign can be used to concatenate two <code>list</code> objects.</p>
<div class="code-chunk" data-id="j44w4tnd" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=75, cmd id=&quot;j44w4tnd&quot;}" class="language-python">A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span>
C <span class="token operator">=</span> A <span class="token operator">+</span> B
<span class="token keyword">print</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>C<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">[1, 2, 3]
[4, 5, 6]
[1, 2, 3, 4, 5, 6]
</pre></div></div><p>For lists, concatenation creates a new list.
It takes time proportional to the length of the newly created list <code>C</code> and it doesn&apos;t modify the lists <code>A</code> or <code>B</code>.
For doubly linked lists, we could achieve the same asymptotic running time by incrementally building up a new list.
However, if we are allowed to modify the lists, the concatenation can be accomplished by pointing the tail of the first list at the head of the second.</p>
<div class="code-chunk" data-id="_doublylinkedlist_04" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=76, cmd continue=&quot;_doublylinkedlist_03&quot;, id=&quot;_doublylinkedlist_04&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">__iadd__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> other<span class="token punctuation">.</span>_head <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">return</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_head <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_head <span class="token operator">=</span> other<span class="token punctuation">.</span>_head
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_tail<span class="token punctuation">.</span>link <span class="token operator">=</span> other<span class="token punctuation">.</span>_head
            other<span class="token punctuation">.</span>_head<span class="token punctuation">.</span>prev <span class="token operator">=</span> self<span class="token punctuation">.</span>_tail
        self<span class="token punctuation">.</span>_tail <span class="token operator">=</span> other<span class="token punctuation">.</span>_tail
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> self<span class="token punctuation">.</span>_length <span class="token operator">+</span> other<span class="token punctuation">.</span>_length

        <span class="token comment"># Clean up the other list.</span>
        other<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-78" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=77, cmd continue=&quot;_doublylinkedlist_04&quot;}" class="language-python">L <span class="token operator">=</span> DoublyLinkedList<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>L<span class="token punctuation">.</span>addlast<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
B <span class="token operator">=</span> DoublyLinkedList<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>B<span class="token punctuation">.</span>addlast<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

L <span class="token operator">+=</span> B

n <span class="token operator">=</span> L<span class="token punctuation">.</span>_head
<span class="token keyword">while</span> n <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>data<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token string">&apos; &apos;</span><span class="token punctuation">)</span>
    n <span class="token operator">=</span> n<span class="token punctuation">.</span>link
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 </pre></div></div><p>We have to be a bit careful about the differences between this concatenation operation and concatenation of regular lists.  With the doubly-linked list, concatenation empties the other list.  It does this so that we don&#x2019;t have multiple doubly-linked lists with the same <code>ListNode</code>s.    That would be a problem if we tried to edit just one of the lists, because the changes would be reflected in the other list as well, possibly with disastrous consequences.</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_08" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 8
    </p>
    <hr>
<h1 class="mume-header" id="recursion">Recursion</h1>

<p>Recursion is an important idea across computer science.
For us, in learning data structures and basic algorithms, there are several ways to both think about and use recursion.
At its simplest, one can think of <strong>recursion</strong> as: <em>when a function calls itself</em>.</p>
<p>Although true, this definition doesn&apos;t really tell us how or why to use it, and what to do with it when we find it in the wild.
Our objectives for this chapter are three-fold:</p>
<ol>
<li>
<p>Understand how recursion is implemented in a computer and translate this into a model for how to think about recursive functions.</p>
</li>
<li>
<p>Use recursion as a problem solving technique, recognizing the role of &quot;subproblems&quot; as a primary motivation for recursion.</p>
</li>
<li>
<p>Be able to analyze the running time of recursive functions.</p>
</li>
</ol>
<p>Here is an example of a recursive function.</p>
<div class="code-chunk" data-id="j32gqq5q" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd, id=&quot;j32gqq5q&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> k <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> f<span class="token punctuation">(</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> k
    <span class="token keyword">return</span> <span class="token number">0</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">15
</pre></div></div><p>This is actually just our familiar <code>sumk</code> function in disguise.
How does it work?
To find the sum of numbers from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>, it just finds the sum of the numbers from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> and then adds <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>.
Yes, we know there is a better way to compute this sum, but there is something satisfying about this approach.
We were asked to solve a problem given some input <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> and we pretended we already had a solution for smaller numbers (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>&#x2212;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> in this case).
Then, we used that solution to construct a solution for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>.
The magic comes from the fact that the &quot;pretended&quot; solution was actually the same function.
I call this the <em>pretend someone else wrote it</em> approach to recursion.
It&apos;s very handy for both writing and analyzing recursive functions.</p>
<h2 class="mume-header" id="recursion-and-induction">Recursion and Induction</h2>

<p>The function <code>f</code> above does the same thing as our <code>sumk</code> function that we saw earlier.
You can check it using something called induction.
In fact, this checking process is exactly what it means to &quot;do a proof by induction&quot;.
There, you prove a fact, by checking that it is true in the base case.
Then, you prove that it&apos;s true for <code>k</code> assuming it&apos;s true for <code>k-1</code>.
In the special case of checking that our function <code>f</code> is identical to the <code>sumk</code> function that simply returns <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi>k</mi><mo>(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{k(k+1)}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.355em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span><span class="mopen mtight">(</span><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>, it looks as follows.
First, check that indeed</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mn>0</mn><mo>)</mo><mo>=</mo><mn>0</mn><mo>=</mo><mfrac><mrow><mn>0</mn><mo>&#x2217;</mo><mo>(</mo><mn>0</mn><mo>+</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">f(0) = 0 = \frac{0 * (0 + 1)}{2}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord">0</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2217;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord">0</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></span></p>
<p>Then observe that
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>f</mi><mo>(</mo><mi>k</mi><mo>)</mo><mo>=</mo><mi>f</mi><mo>(</mo><mi>k</mi><mo>&#x2212;</mo><mn>1</mn><mo>)</mo><mo>+</mo><mi>k</mi><mo>=</mo><mfrac><mrow><mo>(</mo><mi>k</mi><mo>&#x2212;</mo><mn>1</mn><mo>)</mo><mo>(</mo><mi>k</mi><mo>&#x2212;</mo><mn>1</mn><mo>+</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac><mo>+</mo><mi>k</mi><mo>=</mo><mfrac><mrow><mo>(</mo><mi>k</mi><mo>&#x2212;</mo><mn>1</mn><mo>)</mo><mi>k</mi><mo>+</mo><mn>2</mn><mi>k</mi></mrow><mn>2</mn></mfrac><mo>=</mo><mfrac><mrow><mi>k</mi><mo>(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo>)</mo></mrow><mn>2</mn></mfrac><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">f(k) = f(k-1) + k = \frac{(k-1)(k-1 + 1)}{2} + k = \frac{(k-1)k + 2k}{2} = \frac{k(k+1)}{2}.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">2</span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.113em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">2</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">.</span></span></span></span></span></p>
<p>We won&apos;t get many opportunities to do such proofs in this class, but it&apos;s worth remembering that there is a strong connection between recursion and induction and working through this connection can enrich your understanding of both concepts.</p>
<h2 class="mume-header" id="some-basics">Some Basics</h2>

<p>Here are some basic rules that you should try to follow to make sure your recursive algorithms terminate.</p>
<ol>
<li>Have a base case.  If every function call makes another recursive call, you will never terminate.</li>
<li>Recursive calls should move towards the base case.  This usually means that the recursive calls are made on &quot;smaller&quot; subproblems.  Here, &quot;smaller&quot; can mean different things.</li>
</ol>
<p>It&apos;s not hard to write a recursive function that never stops <em>in theory</em>.
However, in practice, so-called infinite recursion is pretty quickly discovered with a <code>RecursionError</code>.
Python has a limit on the recursion depth.
This limit is usually around 1000.</p>
<h2 class="mume-header" id="the-function-call-stack">The Function Call Stack</h2>

<p>To think clearly about recursion, it helps to have an idea of how recursion works on a real computer.
It is easiest to first understand how all function calls work and then it should be clear that there is no technical difference in making a recursive function call compared to any other function call.</p>
<div class="code-chunk" data-id="j32h294n" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=78, cmd id=&quot;j32h294n&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    var <span class="token operator">=</span> k <span class="token operator">**</span> <span class="token number">2</span>
    <span class="token keyword">return</span> g<span class="token punctuation">(</span>k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> var

<span class="token keyword">def</span> <span class="token function">g</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    var <span class="token operator">=</span> k <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">return</span> var <span class="token operator">+</span> <span class="token number">1</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">15
</pre></div></div><p>The following code gives a <code>RecursionError</code> even though none of the functions call themselves directly.
The error is really just signaling that the call stack reached its limit.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">a</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">return</span> b<span class="token punctuation">(</span>k<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">b</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> c<span class="token punctuation">(</span>k<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">c</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> a<span class="token punctuation">(</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

a<span class="token punctuation">(</span><span class="token number">340</span><span class="token punctuation">)</span>
</pre><p>An interesting recursive example con be constructed by creating two lists, each one containing the other.</p>
<div class="code-chunk" data-id="code-chunk-id-81" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=79, cmd}" class="language-python">A <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
B <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
A<span class="token punctuation">.</span>append<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
B<span class="token punctuation">.</span>append<span class="token punctuation">(</span>B<span class="token punctuation">)</span>
A <span class="token operator">==</span> B
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Traceback (most recent call last):
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/9h38v853y_code_chunk.py&quot;, line 5, in <module>
    A == B
RecursionError: maximum recursion depth exceeded in comparison
</module></pre></div></div><p>In this case, the recursive function is <code>list.__eq__</code>, the method that compares two lists when you use <code>==</code>.  It compares the list by checking if the elements are equal.  The lists <code>A</code> and <code>B</code> each have length 2.  The first elements match.  The second element of each list is another list.  To compare them, there is another call to <code>list.__eq__</code>.  This is a repeat of the first call and the process repeats until the recursion limit is reached.</p>
<h2 class="mume-header" id="the-fibonacci-sequence">The Fibonacci Sequence</h2>

<p>Here is a classic example of a recursively defined function.
It was originally named for Leonardo Fibonacci who studied it in the context of predicting the growth of rabbit populations.</p>
<div class="code-chunk" data-id="j32h6rso" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=80, cmd id=&quot;j32h6rso&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> k <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">return</span> k
    <span class="token keyword">return</span> fib<span class="token punctuation">(</span>k<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> fib<span class="token punctuation">(</span>k<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">[</span>fib<span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">[0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377]
</pre></div></div><p>This works, but it starts to get really slow, even for small values of <code>k</code>.
For example, I tried to run it for <code>k = 40</code> and gave up on it.</p>
<p>This is a case that we will encounter many times in this course.
Once we embrace recursion as a way to think about breaking problems into smaller pieces, we may find very short recursive algorithms, but for one reason or another, we may want to rewrite them without recursion.
Here&apos;s a version that uses a loop instead.</p>
<div class="code-chunk" data-id="j32hgrm1" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=81, cmd id=&quot;j32hgrm1&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">fib</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a <span class="token operator">+</span> b
    <span class="token keyword">return</span> a

<span class="token keyword">print</span><span class="token punctuation">(</span>fib<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">176023680645013966468226945392411250770384383304492191886725992896575345044216019675
</pre></div></div><p>This is much better!
At first look, it might seem like the only difference in the total work is just in the extra overhead of making function calls rather than updating local variables.
This is wrong.
Let&apos;s work out in more detail exactly what function calls are made in the recursive implementation.
Let&apos;s say we called <code>fib(6)</code>.
This makes calls to <code>fib(5)</code> and <code>fib(4)</code>.
This, in turn makes calls to <code>fib(4)</code> and <code>fib(3)</code> as well as <code>fib(3)</code> and <code>fib(2)</code>.
Each of these four function calls will make two more function calls each.
We can draw them out in a tree.
Notice, that already, we have multiple calls to <code>fib(4)</code> as well as to <code>fib(3)</code>.
We might as well ask, how many times will we call the same function with the same value?
If we compute <code>fib(k)</code>, the answer, interestingly enough is related to the Fibonacci numbers themselves.
Let <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>(</mo><mi>k</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">T(k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span> denote the number of calls to <code>fib</code> when computing <code>fib(k)</code>.
It&apos;s easy to see that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>(</mo><mi>k</mi><mo>)</mo><mo>=</mo><mi>T</mi><mo>(</mo><mi>k</mi><mo>&#x2212;</mo><mn>1</mn><mo>)</mo><mo>+</mo><mi>T</mi><mo>(</mo><mi>k</mi><mo>&#x2212;</mo><mn>2</mn><mo>)</mo><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">T(k) = T(k-1) + T(k-2) + 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>.
In this case, the result is nearly exactly the Fibonacci numbers (<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>(</mo><mn>1</mn><mo>)</mo><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">T(1) = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>(</mo><mn>2</mn><mo>)</mo><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">T(2) = 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>(</mo><mn>3</mn><mo>)</mo><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">T(3) = 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span>, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>(</mo><mn>4</mn><mo>)</mo><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">T(4) = 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">7</span></span></span></span>, ...).  In each case, the value of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span> is one less than a Fibonacci number.  Thus, the running time of <code>fib</code> will grow like the Fibonacci numbers, or equivalently, it will grow like ideal rabbit families, exponentially.  The <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>th Fibonacci number is about <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>&#x3D5;</mi><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">\phi^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.043548em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathit">&#x3D5;</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>&#x3D5;</mi><mo>=</mo><mfrac><mrow><mn>1</mn><mo>+</mo><msqrt><mn>5</mn></msqrt></mrow><mn>2</mn></mfrac><mo>&#x223C;</mo><mn>1.618</mn></mrow><annotation encoding="application/x-tex">\phi = \frac{1+\sqrt{5}}{2}\sim1.618</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit">&#x3D5;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.3829999999999998em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0379999999999998em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.3990085em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mbin mtight">+</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.912845em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight">5</span></span></span><span style="top:-2.872845em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,
-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,
-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,
35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,
-221c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467
s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422
s-65,47,-65,47z M834 80H400000v40H845z"/></svg></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.12715500000000002em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x223C;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">.</span><span class="mord">6</span><span class="mord">1</span><span class="mord">8</span></span></span></span> is known as the Golden Ratio.</p>
<h2 class="mume-header" id="euclids-algorithm">Euclid&apos;s Algorithm</h2>

<p>Euclid&apos;s algorithm is a classic in every sense of the word.
The input is a pair of integers <code>a, b</code> and the output is the greatest common divisor, i.e., the largest integer that divides both <code>a</code> and <code>b</code> evenly.
It is a very simple recursive algorithm.
We&apos;ll look at the code first and then try to figure out what its doing, why it works, and how we can improve it.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">==</span> b<span class="token punctuation">:</span>
        <span class="token keyword">return</span> a
    <span class="token keyword">if</span> a <span class="token operator">&gt;</span> b<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a
    <span class="token keyword">return</span> gcd<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token operator">-</span> a<span class="token punctuation">)</span>
</pre><p>Like all recursive algorithms, there is a base case.
Here, if <code>a == b</code>, then <code>a</code> (or equivalently, <code>b</code>) is the answer and we return it.
Otherwise, we arrange it so <code>a &lt; b</code> and make a recursive call: <code>gcd(a, b - a)</code>.</p>
<p>When we walk through some examples, by hand, it seems like the algorithm makes many recursive calls when <code>b</code> is much bigger than <code>a</code>.
In fact, it&apos;s not hard to see that we&apos;ll need at least <code>a // b</code> recursive calls before we swap <code>a</code> and <code>b</code>.
These calls are just repeatedly subtracting the same number until it gets sufficiently small.
This is known to elementary school students as division.
This is actually a deep idea that&apos;s worth pondering.  Division is iterated subtraction the same way that multiplication is iterated addition, exponentiation is iterated multiplication, and logarithms are iterated division.
Theoretical computer scientists even have a use for iterated logarithms (we call it <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>log</mi><mo>&#x2061;</mo><mo>&#x22C6;</mo></msup></mrow><annotation encoding="application/x-tex">\log^\star</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.967476em;vertical-align:-0.19444em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.773036em;"><span style="top:-3.1473400000000002em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">&#x22C6;</span></span></span></span></span></span></span></span></span></span></span>, pronounced &quot;log star&quot;).</p>
<p>We can just do the division directly rather than repeatedly subtracting the smaller from the bigger.
The result is a slight change to the base case and replacing the subtraction with the modulus operation.
Here is the revised code.</p>
<div class="code-chunk" data-id="j32hniri" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=82, cmd id=&quot;j32hniri&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">gcd</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> a <span class="token operator">&gt;</span> b<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span> b <span class="token operator">=</span> b<span class="token punctuation">,</span> a
    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> b
    <span class="token keyword">return</span> gcd<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b <span class="token operator">%</span> a<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;GCD of 12 and 513 is&quot;</span><span class="token punctuation">,</span> gcd<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">513</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;GCD of 19 and 513 is&quot;</span><span class="token punctuation">,</span> gcd<span class="token punctuation">(</span><span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">513</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;GCD of 19 and 515 is&quot;</span><span class="token punctuation">,</span> gcd<span class="token punctuation">(</span><span class="token number">515</span> <span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">GCD of 12 and 513 is 3
GCD of 19 and 513 is 19
GCD of 19 and 515 is 1
</pre></div></div><p>Incidentally, if <code>a</code> and <code>b</code> are allowed to be arbitrary numbers, you might try find examples where the gcd algorithm gets caught in an infinite recursion.  In this way, you might discover the irrational numbers.  If <code>a</code> and <code>b</code> are rational, then the algorithm is also guaranteed to terminate.</p>
<p>If you wanted to find an example that was as bad as possible, you might try to find a pair <code>(a,b)</code> such that after one iteration, you get the pair <code>(b-a, a)</code> where the ratio of the numbers is the same.  Then, you can check that this will continue and therefore, you&apos;ll never get closer to that base case.  But is that possible?  Is there a pair of numbers with this property?  The answer is yes.  One could use <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">a = 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">a</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>b</mi><mo>=</mo><mi>&#x3D5;</mi></mrow><annotation encoding="application/x-tex">b = \phi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit">b</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathit">&#x3D5;</span></span></span></span>, the Golden Ratio.</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_09" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 9
    </p>
    <hr>
<h1 class="mume-header" id="dynamic-programming">Dynamic Programming</h1>

<p>The term <strong>dynamic programming</strong> refers to an approach to writing algorithms in which a problem is solved using solutions to the same problem on smaller instances.
Recall that this was the same intuition behind recursive algorithms.
Indeed, there are many instances in which you might arrive at a dynamic programming algorithm by starting with a recursive algorithm that is inefficient because it repeatedly makes recursive calls to a function with the exact same parameters, wasting time.</p>
<p>We start with the problem of giving change using the fewest coins.  Imagine that you have a list of coin amounts [1, 5, 10, 25] and an amount of change that you want to produce.
A first attempt at such a solution might be to assign the change in a <strong>greedy</strong> way.
In that approach, you would simply try to add the largest coin you can until you are done.
Here is an implementation.  <em>(Notice the relationship to Euclid&apos;s GCD algorithm)</em></p>
<h2 class="mume-header" id="a-greedy-algorithm">A Greedy Algorithm</h2>

<div class="code-chunk" data-id="j32act34" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=83, cmd id=&quot;j32act34&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">greedyMC</span><span class="token punctuation">(</span>coinvalueList<span class="token punctuation">,</span> change<span class="token punctuation">)</span><span class="token punctuation">:</span>
    coinvalueList<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coinvalueList<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>
    numcoins <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> c <span class="token keyword">in</span> coinvalueList<span class="token punctuation">:</span>
        <span class="token comment"># Add in as many coins as possible of the next largest value.</span>
        numcoins <span class="token operator">+=</span> change <span class="token operator">//</span> c
        <span class="token comment"># Update the amount of change left to return.</span>
        change <span class="token operator">=</span> change <span class="token operator">%</span> c
    <span class="token keyword">return</span> numcoins

<span class="token keyword">print</span><span class="token punctuation">(</span>greedyMC<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>greedyMC<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>greedyMC<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">6
15
7
</pre></div></div><p>Clearly, this does not work.
The second example returns 15 and the third returns 7.
In both cases, the right answer should have been 3 as can be achieved by returning three 21 cent coins.
The problem is not a bug in the code, but an incorrect algorithm.
The greedy solution does not work here.
Let&apos;s try recursion instead.</p>
<h2 class="mume-header" id="a-recursive-algorithm">A Recursive Algorithm</h2>

<div class="code-chunk" data-id="j32ad4km" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=84, cmd id=&quot;j32ad4km&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">recMC</span><span class="token punctuation">(</span>coinValueList<span class="token punctuation">,</span> change<span class="token punctuation">)</span><span class="token punctuation">:</span>
   minCoins <span class="token operator">=</span> change
   <span class="token keyword">if</span> change <span class="token keyword">in</span> coinValueList<span class="token punctuation">:</span>
     <span class="token keyword">return</span> <span class="token number">1</span>
   <span class="token keyword">else</span><span class="token punctuation">:</span>
      <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> coinValueList <span class="token keyword">if</span> c <span class="token operator">&lt;=</span> change<span class="token punctuation">]</span><span class="token punctuation">:</span>
         numCoins <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> recMC<span class="token punctuation">(</span>coinValueList<span class="token punctuation">,</span>change<span class="token operator">-</span>i<span class="token punctuation">)</span>
         <span class="token keyword">if</span> numCoins <span class="token operator">&lt;</span> minCoins<span class="token punctuation">:</span>
            minCoins <span class="token operator">=</span> numCoins
   <span class="token keyword">return</span> minCoins

<span class="token comment"># print(recMC([1,5,10,25],63)) # Seriously don&apos;t even try to run this</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>recMC<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>recMC<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">3
3
</pre></div></div><p>This works, but it&apos;s very slow.  A natural thing to try here is to <strong>memoize</strong> solutions from previous recursive calls.
This way, we don&apos;t repeat work by computing the number of coins for a specific amount of change more than one time.
Don&apos;t forget to pass along the dictionary of known results when making recursive calls.</p>
<h2 class="mume-header" id="a-memoized-version">A Memoized Version</h2>

<div class="code-chunk" data-id="j32adxkx" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=85, cmd id=&quot;j32adxkx&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">memoMC</span><span class="token punctuation">(</span>coinValueList<span class="token punctuation">,</span> change<span class="token punctuation">,</span> knownResults<span class="token punctuation">)</span><span class="token punctuation">:</span>
    minCoins <span class="token operator">=</span> change
    <span class="token keyword">if</span> change <span class="token keyword">in</span> coinValueList<span class="token punctuation">:</span>
        knownResults<span class="token punctuation">[</span>change<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> change <span class="token keyword">in</span> knownResults<span class="token punctuation">:</span>
        <span class="token keyword">return</span> knownResults<span class="token punctuation">[</span>change<span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> coinValueList <span class="token keyword">if</span> c <span class="token operator">&lt;=</span> change<span class="token punctuation">]</span><span class="token punctuation">:</span>
            numCoins <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> memoMC<span class="token punctuation">(</span>coinValueList<span class="token punctuation">,</span> change<span class="token operator">-</span>i<span class="token punctuation">,</span> knownResults<span class="token punctuation">)</span>
            <span class="token keyword">if</span> numCoins <span class="token operator">&lt;</span> minCoins<span class="token punctuation">:</span>
                minCoins <span class="token operator">=</span> numCoins
                knownResults<span class="token punctuation">[</span>change<span class="token punctuation">]</span> <span class="token operator">=</span> minCoins
    <span class="token keyword">return</span> minCoins

<span class="token keyword">print</span><span class="token punctuation">(</span>memoMC<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

knownresults <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>memoMC<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> knownresults<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>knownresults<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">6
3
{1: 1, 5: 1, 6: 2, 7: 3, 8: 4, 9: 5, 10: 1, 11: 2, 12: 3, 13: 4, 14: 5, 15: 2, 16: 3, 17: 4, 18: 5, 19: 6, 20: 2, 21: 1, 22: 2, 23: 3, 24: 4, 25: 1, 26: 2, 27: 3, 28: 4, 29: 5, 30: 2, 31: 2, 32: 3, 33: 4, 34: 5, 35: 2, 36: 3, 37: 4, 38: 5, 39: 6, 40: 3, 41: 3, 42: 2, 43: 3, 44: 4, 45: 3, 46: 2, 47: 3, 48: 4, 49: 5, 50: 2, 51: 3, 52: 3, 53: 4, 54: 5, 55: 3, 56: 3, 57: 4, 58: 5, 59: 6, 60: 3, 61: 4, 62: 4, 63: 3}
</pre></div></div><p>This is much faster and now can work with much larger instances.
It was slightly awkward that we had to pass in an empty dictionary to get things started, but that&apos;s not a big deal.
Let&apos;s look at the dictionary <code>knownresults</code> that gets populated by the algorithm.
It contains all but a few of the values from 1 to 63.
Maybe instead of recursive calls, starting with the full amount of change and working our way down, we could build up the dictionary of values starting with the small values and working our way up.
This is the essence of dynamic programming.</p>
<p>It happens that a list makes sense here because we want to access the items by their integer indices starting from 1.
In each step, the next best answer can be found by trying each coin, subtracting its value from the current value, and checking the list to find how many coins are needed to make up the rest of the change if that coin is used.</p>
<h2 class="mume-header" id="a-dynamic-programming-algorithm">A Dynamic Programming Algorithm</h2>

<p>Finally, we can repackage this into a dynamic programming algorithm.
The idea is to explicitly fill in the table of all values, using previously computed values to compute new values.</p>
<div class="code-chunk" data-id="j32akg27" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=86, cmd id=&quot;j32akg27&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">dpMakeChange</span><span class="token punctuation">(</span>coinValueList<span class="token punctuation">,</span> change<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Create a list to store the answers to the subproblems</span>
    minCoins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">(</span>change <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment"># For each value from 0 to change, compute the min number of coins needed.</span>
    <span class="token keyword">for</span> cents <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>change<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Assume at first that all 1&apos;s are used.</span>
        minCoins<span class="token punctuation">[</span>cents<span class="token punctuation">]</span> <span class="token operator">=</span> cents
        <span class="token comment"># Check if any coin leads to a better solution to our current best.</span>
        <span class="token keyword">for</span> c <span class="token keyword">in</span> coinValueList<span class="token punctuation">:</span>
            <span class="token keyword">if</span> cents <span class="token operator">&gt;=</span> c<span class="token punctuation">:</span>
                minCoins<span class="token punctuation">[</span>cents<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>minCoins<span class="token punctuation">[</span>cents<span class="token punctuation">]</span><span class="token punctuation">,</span> minCoins<span class="token punctuation">[</span>cents <span class="token operator">-</span> c<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment"># Return just the element in the table corresponding to the desired value.</span>
    <span class="token keyword">return</span> minCoins<span class="token punctuation">[</span>change<span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>dpMakeChange<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dpMakeChange<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">3
4
</pre></div></div><p>A major difference between the dynamic programming approach and the memoized recursion approach is that the dynamic program builds the results <em>from the bottom up</em>, while the recursive version works top down, starting work on the largest problem first and working down to the smaller problems as needed.
<em>Do either of these approaches correspond to the way that you solve programming problems?</em></p>
<h2 class="mume-header" id="another-example">Another example</h2>

<p>In order to see dynamic programming as a general approach to solving problems, we need to see another example.
As with recursion, the key is to look for smaller problems to solve.
This is really a theme throughout this course.
All problems must be broken into smaller problems.
If those smaller problems are instances of the same problem we started with then maybe recursion or dynamic programming are appropriate.</p>
<p>The next problem we&apos;ll solve with dynamic programming is called the longest common subsequence (LCS) problem.
A <strong>subsequence</strong> of a string <code>s</code> is string <code>t</code> such that the characters of <code>t</code> all appear in <code>s</code> in the same order.
For example <code>&apos;abc&apos;</code> is a subsequence of <code>&apos;xxxxxaxxxbxxxcxxxx&apos;</code></p>
<p>The input to the LCS problem is a pair of strings, we&apos;ll call them <code>X</code> and <code>Y</code>.
The output is the longest string that is a subsequence of both <code>X</code> and <code>Y</code>.</p>
<p>One view of this problem is that we want to find the smallest set of characters to remove from <code>X</code> and <code>Y</code> so that the results will be equal.
However, we don&apos;t want to try all possible subsequences.
There are <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span></span></span></span></span></span></span></span> subsequences of a string of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.
That&apos;s too many!
Our code would never finish for even <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">n = 100</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord">0</span><span class="mord">0</span></span></span></span>.</p>
<p>Here is the trick that cracks open this problem.
If <code>X</code> and <code>Y</code> end in the same character, then that character is the last character in the longest common substring.
That is, if <code>X[-1] == Y[-1]</code> then the <code>LCS(X,Y)</code> is <code>LCS(X[:-1], Y[:-1]) + X[-1]</code>.
On the other hand, if <code>X[-1] != Y[-1]</code>, then at least one of <code>X[-1]</code> or <code>Y[-1]</code> is <em>not</em> in the LCS.
In that case, <code>LCS(X,Y)</code> is the longer of <code>LCS(X[:-1],Y)</code> and <code>LCS(X,Y[:-1])</code>.
We could turn this into a very tidy recursive algorithm.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">reclcs</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> X <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token operator">or</span> Y <span class="token operator">==</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">if</span> X<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> Y<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> reclcs<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> X<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span>reclcs<span class="token punctuation">(</span>X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">,</span> reclcs<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">)</span>
</pre><p>However, when we run this on moderately size inputs, it seems to run forever.
It&apos;s not hard to see that if we had two long strings that didn&apos;t match any characters, then the tree of recursive calls would be a complete binary tree of depth <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.
That&apos;s <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span></span></span></span></span></span></span></span> recursive calls.
However, there aren&apos;t that many distinct recursive calls.
Each such call is of the form <code>reclcs(X[:i], Y[:j])</code>, i.e. it takes the first <code>i</code> characters of <code>X</code> and the first <code>j</code> characters of <code>Y</code> for some <code>i</code> and <code>j</code>.
This means that there should only be <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> <em>distinct</em> recursive calls.  As <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>n</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">n^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span> is much smaller than <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">n</span></span></span></span></span></span></span></span></span></span></span>, many recursive calls are being repeated.
That&apos;s wasted work that we can avoid.
We could add memoization as before, but really, what we want is dynamic programming.
We&apos;ll store solutions to subproblems in a dictionary <code>t</code> so that <code>t[(i,j)] == LCS(X[:i], Y[:j])</code>.
We initialize the table with <code>&quot;&quot;</code> for subproblems with <code>i = 0</code> or <code>j = 0</code> (the base case).
Here is the code.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">lcs</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    t <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> t<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> t<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>

    <span class="token keyword">for</span> i<span class="token punctuation">,</span> x <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> x <span class="token operator">==</span> y<span class="token punctuation">:</span>
                t<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">+</span> x
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                t<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span>t<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">[</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> t<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</pre><p>The initialization takes linear time and the main pair of loops iterate <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> times.
The inner loop takes time proportional to the LCS in the worst case, because we will concatenate strings of that length.
The total running time is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>k</mi><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(kn^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> is the length of the output.</p>
<p>Can you think of a way to get the running time down to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>?
This would require a different way to store solutions to subproblems.</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_10" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 10
    </p>
    <hr>
<h1 class="mume-header" id="binary-search">Binary Search</h1>

<p>Binary search is a classic algorithm.
It is particularly nice to think about as a recursive algorithm.
If you are looking for an item in a sorted list, you break the list in half and repeat the search on whichever side could contain the missing element, which can be found by comparing with the median element.
Then, repeating on the smaller list is just a single recursive call.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">bs</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span>
    median <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    <span class="token keyword">if</span> item <span class="token operator">==</span> L<span class="token punctuation">[</span>median<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    <span class="token keyword">elif</span> item <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>median<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> bs<span class="token punctuation">(</span>L<span class="token punctuation">[</span><span class="token punctuation">:</span>median<span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> bs<span class="token punctuation">(</span>L<span class="token punctuation">[</span>median <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>
</pre><p>This code, although correct, is not nearly as efficient as it could be.
To analyze it, we use the same technique as we will use for all recursive algorithms in this course.
We will count up <em>all</em> the operations that will be performed by the function except the recursive calls.
Then we will draw the tree of all recursive calls and add up the cost of each call.</p>
<p>In this case, the worst-case running time of <code>bs</code> on a list of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">n/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">2</span></span></span></span> plus a constant.
So, the first call costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">n/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">2</span></span></span></span>.
The second costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">n/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">4</span></span></span></span>.
The third costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>8</mn></mrow><annotation encoding="application/x-tex">n/8</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">8</span></span></span></span>.
Adding them up gives a number close to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.
So, we are taking linear time to test membership.
We would be faster to just iterate one time through the list by using the <code>in</code> function (i.e. <code>list.__contains__</code>).</p>
<p>If we&apos;re going to do faster, we have to avoid all that slicing.
Let&apos;s only pretend to slice the list and instead pass the indices defining the range of the list we want to search.
Here is a first attempt.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">bs</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> item<span class="token punctuation">,</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> right <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> right <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">if</span> right <span class="token operator">-</span> left <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">if</span> right <span class="token operator">-</span> left <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> L<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">==</span> item
    median <span class="token operator">=</span> <span class="token punctuation">(</span>right <span class="token operator">+</span> left<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    <span class="token keyword">if</span> item <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>median<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> bs<span class="token punctuation">(</span>L<span class="token punctuation">,</span> item<span class="token punctuation">,</span> left<span class="token punctuation">,</span> median<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> bs<span class="token punctuation">(</span>L<span class="token punctuation">,</span> item<span class="token punctuation">,</span> median<span class="token punctuation">,</span> right<span class="token punctuation">)</span>
</pre><p>Note that we had to do a little work with default parameters so that we can still call this function as <code>bs(mylist, myitem)</code>.
This involves a check to see if <code>right is None</code> and sets it to be the length of the list if necessary.</p>
<p>When we analyze this recursive algorithm just as before, we see that all the operations take constant time, so the total running time will be proportional to the total number of recursive calls.
The tree of function calls is a single chain of length at most <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.
<em>(Why <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>&#x2061;</mo><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\log(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>?  This is the number of times you can cut <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> in half before it gets down to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>.)</em>
So, we see that the asymptotic running time is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.</p>
<p>In the analysis, we observed that the tree of function calls is a single chain.
This is called <strong>linear recursion</strong>.
Here, we have a special case in which the function directly returns the result of the recursive function call.
That is called <strong>tail recursion</strong>.</p>
<p>In general, tail recursion can always be replaced by a loop.
The idea is to simply update the parameter variables and loop rather than making a recursive call.
Here is the idea in action.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">bs</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
    left<span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">while</span> right <span class="token operator">-</span> left <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        median <span class="token operator">=</span> <span class="token punctuation">(</span>right <span class="token operator">+</span> left<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        <span class="token keyword">if</span> item <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>median<span class="token punctuation">]</span><span class="token punctuation">:</span>
            right <span class="token operator">=</span> median
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            left <span class="token operator">=</span> median
    <span class="token keyword">return</span> right <span class="token operator">&gt;</span> left <span class="token operator">and</span> L<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">==</span> item
</pre><p>Note that this solution is simpler to write than our original, and is also probably slightly faster.
It does require a little more thought to see why it&apos;s correct and why it runs in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.</p>
<h2 class="mume-header" id="the-sorted-list-adt">The Sorted List ADT</h2>

<ul>
<li><code>add(item)</code> - adds <code>item</code> to the sorted list.</li>
<li><code>remove(item)</code> - removes the first occurrence of <code>item</code> from the sorted list. Raise a <code>ValueError</code> if the <code>item</code> is not present.</li>
<li><code>__getitem__(index)</code> - returns the item with the given <code>index</code> in the sorted list.   This is also known as <strong>selection</strong>.</li>
<li><code>__contains__(item)</code> - returns true if there is an item of the sorted list equal to <code>item</code>.</li>
<li><code>__iter__</code> - returns an iterator over the sorted list that yields the items in sorted order.</li>
<li><code>__len__</code> - returns the length of the sorted list.</li>
</ul>
<p>Here is a very simple implementation of the sorted list ADT.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">SimpleSortedList</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span>index<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__contains__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> item <span class="token keyword">in</span> self<span class="token punctuation">.</span>_L

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span>
</pre><p>This is a classic example of the Wrapper pattern.
The <code>list</code> storing the items is kept private so we can enforce that it stays ordered.
It looks a bit like a cheat to implement <code>add</code> in this way, but we&apos;ll see later as we cover sorting algorithms that this might be an efficient approach after all.</p>
<p>The one algorithm in this mix that seems most relevant to improve is the <code>__contains__</code> method.
Even though, we are just calling out to python&apos;s built-in method for checking membership in a list, we have some hoping of improving the efficiency because we know that the list is sorted.</p>
<p>Let&apos;s replace it with binary search as we implemented it above.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">BSSortedList</span><span class="token punctuation">(</span>SimpleSortedList<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__contains__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">:</span>
        left<span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">)</span>
        <span class="token keyword">while</span> right <span class="token operator">-</span> left <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
            median <span class="token operator">=</span> <span class="token punctuation">(</span>right <span class="token operator">+</span> left<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
            <span class="token keyword">if</span> item <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span>median<span class="token punctuation">]</span><span class="token punctuation">:</span>
                right <span class="token operator">=</span> median
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                left <span class="token operator">=</span> median
        <span class="token keyword">return</span> right <span class="token operator">&gt;</span> left <span class="token operator">and</span> self<span class="token punctuation">.</span>_L<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">==</span> item
</pre><p>We might also try to use binary search to find the index at which we want to insert a new node in order to speed up <code>add</code>.
Unfortunately, after finding the index, we still need to spend linear time in the worst-case to insert an item into a list at a particular index.</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_11" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 11
    </p>
    <hr>
<h1 class="mume-header" id="sorting">Sorting</h1>

<h2 class="mume-header" id="the-quadratic-time-sorting-algorithms">The Quadratic-Time Sorting Algorithms</h2>

<p>Before we dive into particular sorting algorithms, let&apos;s first ask an easier question:</p>
<blockquote>
<p><strong>Given a list <code>L</code>, determine if <code>L</code> is sorted or not.</strong></p>
</blockquote>
<p>After a little, thought, you will probably come up with some code that looks like the following.</p>
<div class="code-chunk" data-id="j2uqamrd" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=87, cmd id=&quot;j2uqamrd&quot;}" class="language-python"><span class="token keyword">def</span> <span class="token function">is_sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>is_sorted<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>is_sorted<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">True
False
</pre></div></div><p>This is much better than the following, more explicit code.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">is_sorted_slow</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
              <span class="token keyword">return</span> <span class="token boolean">False</span>
    <span class="token keyword">return</span> <span class="token boolean">True</span>
</pre><p>The latter code checks that every pair of elements is in the right order.
The former code is more clever in that it only checks adjacent elements.
If the list is not sorted, then there will be two adjacent elements that will be out of order.
This is true because ordering relations are <strong>transitive</strong>, that is, if <code>a &lt; b</code> and <code>b &lt; c</code>, then <code>a &lt; c</code>.
It&apos;s important to realize that we are using this assumption, because later, we will define our own ways of ordering items, and we will need to make sure this is true so that sorting even makes sense (if <code>a &lt; b &lt; c &lt; a</code>, then what is the correct sorted order?).</p>
<p>Let&apos;s use the <code>is_sorted</code> method to write a sorting algorithm.
Instead of returning False when we find two elements out of order, we&apos;ll just fix them and move on.  Let&apos;s call this (for reasons to become clear) <code>dumberSort</code>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">dumberSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
</pre><p>The main problem with this code is that <em>it doesn&apos;t sort the list</em>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
dumberSort<span class="token punctuation">(</span>L<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>[4, 3, 2, 1, 5]
</code></pre><p>We should probably do it twice <em>or more</em>.  We could even repeat the algorithm until it works.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">dumbSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">not</span> isSorted<span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dumberSort<span class="token punctuation">(</span>L<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="python" class="language-python">L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
dumbSort<span class="token punctuation">(</span>L<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>[1, 2, 3, 4, 5]
</code></pre><p>Will it ever get the list sorted?</p>
<p>How many times will we <code>dumberSort</code> the list?</p>
<p>After some thinking, you will notice that if <code>n = len(L)</code>, then looping <code>n-1</code> times is enough.  There are several different ways to see that this is correct.  You may see that every element in the list moves at least one place closer to its final location with each iteration.</p>
<p>Another way to see that this works is to check that after calling <code>dumberSort(L)</code> one time, the largest element will move all the way to the end of the list and stay there through all subsequent calls.  Calling <code>dumberSort(L)</code> a second time will cause the second largest element to <em>bubble</em> up to the second to last to last place in the list.  We are uncovering what is called an <strong>invariant</strong>, something that is true every time we reach a certain point in the algorithm.  For this algorithm, the invariant is that after <code>i</code> calls to <code>dumberSort(L)</code>, the last <code>i</code> items are in their final (sorted) locations in the list.  The nice thing about this invariant is that if it holds for <code>i = n</code>, then the whole list is sorted, and we can conclude the algorithm is correct.</p>
<p>At this point, we would test the code and think about refactoring.  Remember the DRY (<strong>D</strong> on&apos;t <strong>R</strong> epeat <strong>Y</strong> ourself) principle.  Because we know how many times to loop, we could just use a <code>for</code> loop.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> iteration <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

alist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">26</span><span class="token punctuation">,</span><span class="token number">93</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">77</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span>
bubbleSort<span class="token punctuation">(</span>alist<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>alist<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>[0, 17, 20, 26, 31, 44, 54, 55, 77, 93, 100000]
</code></pre><p>At this point, we have a correct algorithm and it&apos;s quite easy to bound its running time.  It&apos;s <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>, a quadratic time algorithm.</p>
<p>We lost something compared to <code>dumbSort</code>, namely, we no longer stop early if the list is already sorted.  Let&apos;s bring that back.  We&apos;ll use a flag to check if any swaps were made.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    keepgoing <span class="token operator">=</span> <span class="token boolean">True</span>
    <span class="token keyword">while</span> keepgoing<span class="token punctuation">:</span>
        keepgoing <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">&gt;</span>L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                keepgoing <span class="token operator">=</span> <span class="token boolean">True</span>
</pre><p>Now, that we know an invariant that leads to a correct sorting algorithm, maybe we could work backwards from the invariant to an algorithm.  Recall, the invariant was that after <code>i</code> iterations of a loop, the <code>i</code> largest elements are in their final positions.  We can write an algorithm that just makes sure to achieve this, by selecting the largest among the first n-i elements and moving that element into place.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">selectionSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        max_index<span class="token operator">=</span><span class="token number">0</span>        
        <span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">&gt;</span> L<span class="token punctuation">[</span>max_index<span class="token punctuation">]</span><span class="token punctuation">:</span>
                max_index <span class="token operator">=</span> index
        L<span class="token punctuation">[</span>n<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>max_index<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>max_index<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>n<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
</pre><p>There is another invariant that we have implicitly considered previously when working with sorted lists.  Recall there, we assumed that we had a sorted list and one new element was added that had to moved into the correct position.  We saw several different variations of this.  We can turn this invariant into yet another sorting algorithm.  To keep it as close to possible as the previous attempts, we will say that the invariant is that after <code>i</code> iterations, the last <code>i</code> elements in the list are in sorted order.</p>
<p>Do you see the difference between this and our previous invariant?</p>
<p>There are many ways we could enforce this invariant.  We&apos;ll do it by &quot;bubbling&quot; element <code>n-i</code> into position in the <code>i</code>th step.  Note this is not the final position, but rather the position that satisfies the invariant.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span>L<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
</pre><p>As before, we can make this algorithm go faster if the list is already sorted (or almost already sorted).  We stop the inner loop as soon as the element is in the right place</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        j <span class="token operator">=</span> n <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span>
        <span class="token keyword">while</span> j <span class="token operator">&lt;</span> n <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">and</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span>L<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            j<span class="token operator">+=</span><span class="token number">1</span>
</pre><p>There is an important point to remember in the code above.  If <code>j == n-1</code>, then evaluating <code>L[j] &lt; L[j+1]</code> would cause an error.  However, this code does not cause an error, because the expression <code>j &lt; n - 1 and L[j]&gt;L[j+1]</code> evaluates the first part first.  As soon as <code>j &lt; n-1</code> evaluates to False, it doesn&apos;t need to evaluate the other clause of the <code>and</code>.  It skips it.</p>
<p>You often see <code>insertionSort</code> written in a way that keeps the sorted part of the list in the front rather than the end of the list.</p>
<p>Could you write such an insertion sort?  Try it.</p>
<h2 class="mume-header" id="sorting-in-python">Sorting in Python</h2>

<p>Python has two main functions to sort a list.  They are called <code>sort()</code> and <code>sorted()</code>.  The difference is that the former sorts the list and the latter returns a new list that is sorted.  Consider the following simple demonstration.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">X <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
Y <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span>

X<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>[3, 1, 5] [1, 3, 5]
[1, 3, 5]
</code></pre><p>When working with your own classes, you may want to sort elements.  To do so, you only need to be able to compare elements.</p>
<p>In the following example, the elements are sorted by decreasing value of <code>b</code>.  Then, the list is sorted again, but the key function is supplied give a different comparator.  Notice that the parameter is the function itself and not the evaluation of the function.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">from</span> random <span class="token keyword">import</span> randrange

<span class="token keyword">class</span> <span class="token class-name">Foo</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>a <span class="token operator">=</span> a
        self<span class="token punctuation">.</span>b <span class="token operator">=</span> b
        self<span class="token punctuation">.</span>c <span class="token operator">=</span> c

    <span class="token keyword">def</span> <span class="token function">__lt__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> other<span class="token punctuation">.</span>b <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>b

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;(%d, %d, %d)&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>a<span class="token punctuation">,</span> self<span class="token punctuation">.</span> b<span class="token punctuation">,</span> self<span class="token punctuation">.</span> c<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">geta</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>a

L <span class="token operator">=</span> <span class="token punctuation">[</span>Foo<span class="token punctuation">(</span>randrange<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>randrange<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> randrange<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
L<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> foo <span class="token keyword">in</span> L<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;--------&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> foo <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key <span class="token operator">=</span> Foo<span class="token punctuation">.</span>geta<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>

</pre><pre data-role="codeBlock" data-info="" class="language-"><code>(28, 89, 84)
(65, 51, 96)
(55, 44, 60)
(89, 36, 25)
(57, 35, 84)
(2, 5, 93)
--------
(2, 5, 93)
(28, 89, 84)
(55, 44, 60)
(57, 35, 84)
(65, 51, 96)
(89, 36, 25)
</code></pre><p>If the key function returns a tuple, it will sort by the first element and break ties with subsequent elements.  This kind of sorting is called lexicographic because it is how you would sort words in alphabetical order.</p>
<p>Here is an example of sorting strings by their length (longest to shortest) using the alphabetical order (ignoring case) to break ties.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">strings <span class="token operator">=</span> <span class="token string">&quot;here are Some sample strings to be sorted&quot;</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">mykey</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">sorted</span><span class="token punctuation">(</span>strings<span class="token punctuation">,</span> key<span class="token operator">=</span>mykey<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><pre data-role="codeBlock" data-info="" class="language-"><code>[&apos;strings&apos;, &apos;sample&apos;, &apos;sorted&apos;, &apos;here&apos;, &apos;Some&apos;, &apos;are&apos;, &apos;be&apos;, &apos;to&apos;]
</code></pre><p style="page-break-after:always;"></p>
    <a name="chapter_12" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 12
    </p>
    <hr>
<h1 class="mume-header" id="sorting-with-divide-and-conquer">Sorting with Divide and Conquer</h1>

<p>Previously, we saw some simple quadratic algorithms for sorting.
We saw <code>bubbleSort</code>, <code>selectionSort</code>, and <code>insertionSort</code>.
We considered all these algorithms from the perspective of correctness.
We wanted to have ways to argue that the result was indeed a sorted list, and only afterwards applied some optimizations (such as stopping early).
We used the idea of an <strong>invariant</strong>.
Specifically, it was a <strong>loop invariant</strong>, something that is true on each iteration of the loop.
We started with the invariant that after <code>i</code> iterations, the last <code>i</code> elements are in sorted order.</p>
<p>Invariants help us to reason about our code the same way we do with recursive algorithms.
Once the code is written, we assume the algorithm works on small examples in the same way we assume a loop invariant holds from a previous iteration of the loop.</p>
<p>Now, our goal is to write a faster sorting algorithm.</p>
<p><strong>Divide and Conquer</strong> is a paradigm for algorithm design.
It usually consists of 3 (plus one) parts.
The first part is to <strong>divide</strong> the problem into 2 or more pieces.
The second part is the <strong>conquer</strong> step, where one solves the problem on the pieces.
The third part is the <strong>combine</strong> step where one combines the solutions on the parts into a solution on the whole.</p>
<p>The description of these parts leads pretty directly to recursive algorithms, i.e. using recursion for the conquer part.
The other part that appears in many such algorithms is a <strong>base case</strong>, as one might expect in a recursive algorithm.
This is where you deal with inputs so small that they cannot be divided.</p>
<h2 class="mume-header" id="mergesort">Mergesort</h2>

<p>The most direct application of the Divide and Conquer paradigm to the sorting problem is the <strong>mergesort</strong> algorithm.
In this algorithm, all the difficult work is in the merge step.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Base Case!</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span>

    <span class="token comment"># Divide!</span>
    mid <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
    A <span class="token operator">=</span> L<span class="token punctuation">[</span><span class="token punctuation">:</span>mid<span class="token punctuation">]</span>
    B <span class="token operator">=</span> L<span class="token punctuation">[</span>mid<span class="token operator">=</span><span class="token punctuation">]</span>

    <span class="token comment"># Conquer!</span>
    mergeSort<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
    mergeSort<span class="token punctuation">(</span>B<span class="token punctuation">)</span>

    <span class="token comment"># Combine!</span>
    merge<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> L<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> L<span class="token punctuation">)</span><span class="token punctuation">:</span>   
    i <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># index into A</span>
    j <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment"># index into B</span>
    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">and</span> j <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token comment"># Add any remaining elements once one list is empty</span>
      L<span class="token punctuation">[</span>i<span class="token operator">+</span>j<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> B<span class="token punctuation">[</span>j<span class="token punctuation">:</span><span class="token punctuation">]</span>
</pre><p>That last line might look a little strange.
The right side of the assignment is concatenating the remaining elements from the two lists (of which one should be empty).
Then, this list is assigned into a slice.
In its wonderfulness, python allows you to assign into a slice the same way you would assign into an index.</p>
<p>We could also use some more logic in the loop to avoid this last step, though I have found students disagree as to which approach is simpler.</p>
<div class="code-chunk" data-id="code-chunk-id-90" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=88, cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">,</span> L<span class="token punctuation">)</span><span class="token punctuation">:</span>   
    i<span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span>
    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">or</span> j <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>B<span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span> <span class="token operator">and</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> A<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> B<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            j <span class="token operator">=</span> j <span class="token operator">+</span> <span class="token number">1</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The complex <code>if</code> statement above relies heavily on something called <strong>short-circuited</strong> evaluation of boolean expressions.
If we have a boolean operation like <code>or</code>, and the first operand is <code>True</code>, then we don&apos;t have to evaluate the second operand to find out that the overall result will be <code>True</code>.
Using this fact, python will not even evaluate the second operand.
Similarly, if we have an <code>and</code> expression and the first operand is <code>False</code>, then the second operand is never evaluated.
The key to remember is that the order does matter here.
The expression <code>(i &lt; len(A) and A[i] &lt; B[j]) or j == len(B)</code> is logically equivalent, but if we use this  expression instead, it will raise an IndexError when <code>j == len(B)</code>.</p>
<p>Short-circuit evaluation is <em>not</em> part of python magic, it&apos;s a standard feature in most programming languages.</p>
<h3 class="mume-header" id="an-analysis">An Analysis</h3>

<p>The analysis of <code>mergesort</code> will proceed in the usual way for recursive algorithms.
We will count the basic operations in the methods, not counting recursive calls.
Then, we will draw the tree of recursive calls and write down the cost of each function call in the tree.
Because the input size will change from call to call, the cost will also change.
Then, we add them all up to get the total running time.</p>
<p>The <code>merge</code> function for two lists whole length add up to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.
This is because we only need to do a comparison and some assignment for each item that gets added to the final list (of which there are <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>).</p>
<p>In the tree of recursive calls, the top (or root) costs <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.
The next level has two calls on lists of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">n/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">2</span></span></span></span>.
The second level down has four calls of lists of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">n/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">4</span></span></span></span>.
On down the tree, each level <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathit">i</span></span></span></span> has <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.824664em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span></span></span></span></span></span></span></span> calls, each on lists of length <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">n/2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0746639999999998em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span></span></span></span></span></span></span></span>.
A nice trick to add these costs up, is to observe that the costs of all nodes on any given level sum to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.
There are about <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mn>2</mn></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">\log_2 n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.93858em;vertical-align:-0.24414em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span></span></span></span> levels. (How many times can you divide <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> by <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span> until you get down to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>?)</p>
<p>So, we have <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>&#x2061;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\log n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span></span></span></span> levels, each costing <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>, and thus, the total cost is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.</p>
<h3 class="mume-header" id="merging-iterators">Merging Iterators</h3>

<p>The merge operation is another example of using some structure on our data (that two lists are themselves sorted) to perform some operation quickly (find the minimum overall element in constant time).
However, after you&apos;ve written enough python, you might start to feel like you are doing something wrong if you are messing around with a lot of indices.
When possible, it is much nicer to use iterators.
We&apos;ll use this problem as an example to motivate some deeper study into iterators.</p>
<p>Recall that an object is an <strong>Iterable</strong> in python if it has a method called <code>__iter__</code> that returns an iterator,
and an <strong>Iterator</strong> is a object that has an <code>__iter__</code> method and a <code>__next__</code> method.
These magic methods are called <em>from the outside</em> as <code>iter(my_iterable)</code> and <code>next(my_iterator)</code>.
They are most commonly used by the <code>for</code> keyword either in for loops or in <strong>generator expressions</strong> as in comprehensions.</p>
<div class="code-chunk" data-id="code-chunk-id-91" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=89, cmd}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">SimpleIterator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_count <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_count <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_count <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_count
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> StopIteration

iterator1 <span class="token operator">=</span> SimpleIterator<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x <span class="token keyword">in</span> iterator1<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

iterator2 <span class="token operator">=</span> SimpleIterator<span class="token punctuation">(</span><span class="token punctuation">)</span>
L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> x <span class="token keyword">for</span> x <span class="token keyword">in</span> iterator2<span class="token punctuation">]</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">1
2
3
4
5
6
7
8
9
10
</pre></div></div><p>Iterators are a fundamental pattern in object-oriented programming and they appear in other programming languages with slightly different methods.
For example, some programming languages have iterators that support a <code>hasnext</code> method that can tell in advance whether there is another item to iterate over.
In a standard python iterator, you simply try to get the next item and it will raise <code>StopIteration</code> if there isn&apos;t one.
This is an example of python&apos;s <em>easier to ask forgiveness than permission (EAFP)</em> approach.
Checking in advance is like asking for permission.
However, such a method can be handy.
With it, one might also want a method called <code>peek</code> that will return the next item without advancing past it.</p>
<p>Here is how one might implement these methods in python.
The <code>BufferedIterator</code> class below is built from any iterator.
It stays one step of the iteration ahead of the user and stores the next item in a buffer.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">BufferedIterator</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_i <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_hasnext <span class="token operator">=</span> <span class="token boolean">True</span>
        self<span class="token punctuation">.</span>_buffer <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_advance<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">peek</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_buffer

    <span class="token keyword">def</span> <span class="token function">hasnext</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_hasnext

    <span class="token keyword">def</span> <span class="token function">_advance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_buffer <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_i<span class="token punctuation">)</span>
        <span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_buffer <span class="token operator">=</span> <span class="token boolean">None</span>
            self<span class="token punctuation">.</span>_hasnext <span class="token operator">=</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__next__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>hasnext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            output <span class="token operator">=</span> self<span class="token punctuation">.</span>peek<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_advance<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> output
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> StopIteration
</pre><p>We can use this <code>BufferedIterator</code> to implement another iterator that takes two iterators and merges them as in the <code>merge</code> operation of <code>mergesort</code>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> BufferedIterator<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
    b <span class="token operator">=</span> BufferedIterator<span class="token punctuation">(</span>B<span class="token punctuation">)</span>
    <span class="token keyword">while</span> a<span class="token punctuation">.</span>hasnext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">or</span> b<span class="token punctuation">.</span>hasnext<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> a<span class="token punctuation">.</span>hasnext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>hasnext<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">and</span> b<span class="token punctuation">.</span>peek<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> a<span class="token punctuation">.</span>peek<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token builtin">next</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token builtin">next</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
</pre><p>This iterator looks very different from our previous one.
First of all, it&apos;s not a class, but appears to just be a method.
This is a slick python way of defining a simple iterator.
The &quot;method&quot; here has <code>yield</code> statements instead of <code>return</code> statements.
Python recognizes this and creates a <strong>generator</strong> object.
Calling <code>merge</code> will return an object of type <code>generator</code>.
A <code>generator</code> is an iterator.
The easiest way to think of it is as a method that pauses every time it reaches <code>yield</code> and resumes when asked for the next item.
The magic here is explained by understanding that this really is packaged into an iterator object that is returned.</p>
<p>We can use this new <code>merge</code> iterator to write a new version of <code>mergesort</code>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">mergesort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>
        A<span class="token punctuation">,</span> B <span class="token operator">=</span> L<span class="token punctuation">[</span><span class="token punctuation">:</span>m<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>m<span class="token punctuation">:</span><span class="token punctuation">]</span>
        mergesort<span class="token punctuation">(</span>A<span class="token punctuation">)</span>
        mergesort<span class="token punctuation">(</span>B<span class="token punctuation">)</span>
        L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> merge<span class="token punctuation">(</span>A<span class="token punctuation">,</span> B<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="quicksort">Quicksort</h2>

<p>The <code>mergesort</code> code does a lot of slicing.
Recall that this creates a copy.
Eventually, we will try to get to a version that doesn&apos;t do this.
A sorting algorithm, that just rearranges the elements in a single list is called an <strong>in-place</strong> sorting algorithm.
Before we get there, let&apos;s see the easiest version of <code>quicksort</code>.  One way to think about the motivation for <code>quicksort</code> is that we want to do divide and conquer, but we want the combine step to be as easy as possible.  Recall that in <code>mergesort</code>, most of our cleverness was devoted to doing the combining.
In <code>quicksort</code>, the harder step is the dividing.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">quickSorted</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#base case</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> L<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

    <span class="token comment"># Divide!</span>
    pivot <span class="token operator">=</span> L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    LT <span class="token operator">=</span> <span class="token punctuation">[</span>e <span class="token keyword">for</span> e <span class="token keyword">in</span> L <span class="token keyword">if</span> e <span class="token operator">&lt;</span> pivot<span class="token punctuation">]</span>
    ET <span class="token operator">=</span> <span class="token punctuation">[</span>e <span class="token keyword">for</span> e <span class="token keyword">in</span> L <span class="token keyword">if</span> e <span class="token operator">==</span> pivot<span class="token punctuation">]</span>
    GT <span class="token operator">=</span> <span class="token punctuation">[</span>e <span class="token keyword">for</span> e <span class="token keyword">in</span> L <span class="token keyword">if</span> e <span class="token operator">&gt;</span> pivot<span class="token punctuation">]</span>

    <span class="token comment"># Conquer</span>
    A <span class="token operator">=</span> quickSorted<span class="token punctuation">(</span>LT<span class="token punctuation">)</span>
    B <span class="token operator">=</span> quickSorted<span class="token punctuation">(</span>GT<span class="token punctuation">)</span>

    <span class="token comment"># Combine</span>
    <span class="token keyword">return</span> A <span class="token operator">+</span> ET <span class="token operator">+</span> B
</pre><p>Let&apos;s do an in-place version.  For this, we want to avoid creating new lists and concatenating them at the end.</p>
<div class="code-chunk" data-id="code-chunk-id-92" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=90, cmd}" class="language-python"><span class="token keyword">def</span> <span class="token function">quicksort</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> right <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        right <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>

    <span class="token keyword">if</span> right <span class="token operator">-</span> left <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>    
        <span class="token comment"># Divide!</span>
        mid <span class="token operator">=</span> partition<span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>

        <span class="token comment"># Conquer!</span>
        quicksort<span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">)</span>
        quicksort<span class="token punctuation">(</span>L<span class="token punctuation">,</span> mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span>

        <span class="token comment"># Combine!</span>
        <span class="token comment"># Nothing to do!</span>

<span class="token keyword">def</span> <span class="token function">partition</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pivot <span class="token operator">=</span> right <span class="token operator">-</span> <span class="token number">1</span>
    i <span class="token operator">=</span> left        <span class="token comment"># index in left half</span>
    j <span class="token operator">=</span> pivot <span class="token operator">-</span> <span class="token number">1</span>   <span class="token comment"># index in right half</span>

    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">:</span>
        <span class="token comment"># Move i to point to an element &gt;= L[pivot]</span>
        <span class="token keyword">while</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">:</span>
            i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>

        <span class="token comment"># Move j to point to an element &lt; L[pivot]</span>
        <span class="token keyword">while</span> i <span class="token operator">&lt;</span> j <span class="token operator">and</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">:</span>
            j <span class="token operator">=</span> j <span class="token operator">-</span> <span class="token number">1</span>

        <span class="token comment"># Swap elements i and j if i &lt; j</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token comment"># Put the pivot in place.</span>
    <span class="token keyword">if</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
        L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span>
        pivot <span class="token operator">=</span> i

    <span class="token comment"># Return the index of the pivot.</span>
    <span class="token keyword">return</span> pivot

<span class="token comment"># Simple test to see if it works.</span>
L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
quicksort<span class="token punctuation">(</span>L<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">[1, 2, 3, 4, 5]
</pre></div></div><p>Here is a version without all the comments.
It uses a helper function rather than using default parameters to handle the initial call.
It&apos;s helpful to look at at two different implementations of the same function and compare the different choices that were made between the two.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">quicksort</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    _quicksort<span class="token punctuation">(</span>L<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">_quicksort</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> right <span class="token operator">-</span> left <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>    
        mid <span class="token operator">=</span> partition<span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>
        _quicksort<span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> mid<span class="token punctuation">)</span>
        _quicksort<span class="token punctuation">(</span>L<span class="token punctuation">,</span> mid<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">partition</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> pivot <span class="token operator">=</span> left<span class="token punctuation">,</span> right <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> right <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">:</span>
        <span class="token keyword">while</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">:</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">while</span> i <span class="token operator">&lt;</span> j <span class="token operator">and</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">:</span>
            j <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span>    
    <span class="token keyword">return</span> i
</pre><p style="page-break-after:always;"></p>
    <a name="chapter_13" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 13
    </p>
    <hr>
<h1 class="mume-header" id="selection">Selection</h1>

<p>Consider the following problem.</p>
<blockquote>
<p>Given a list of numbers, find the median element.</p>
</blockquote>
<p>Recall that the median element is the one that would be in the middle if we sorted the list.
So, the following could would be correct.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">median</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    L<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> L<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">]</span>
</pre><p>The code does rearrange the list and we&apos;d have to decide if that was okay for our given list.
If we use a fast sorting algorithm, we can expect this algorithm to run in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.</p>
<p>Can we do better?
How about a linear time algorithm?</p>
<p>Let&apos;s consider a related problem, first.
If our goal is to find the second largest item in a list, we could do this in linear time as follows.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">secondsmallest</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> L<span class="token punctuation">:</span>
        <span class="token keyword">if</span> a <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token operator">or</span> item <span class="token operator">&lt;=</span> b<span class="token punctuation">:</span>
            a<span class="token punctuation">,</span> b <span class="token operator">=</span> item<span class="token punctuation">,</span> a
        <span class="token keyword">elif</span> b <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token operator">or</span> item <span class="token operator">&lt;=</span> a<span class="token punctuation">:</span>
            b <span class="token operator">=</span> item
    <span class="token keyword">return</span> b
</pre><p>We just stored a variable for each of the two largest we&apos;ve seen so far and update them as we look at new items.
You could probably make this work for the third largest or more, but it would start to get cumbersome and slow, especially if you wanted to extract the median.</p>
<p>Some other approach will be necessary to compute the median in linear time.
Let&apos;s try divide and conquer.
To make this work, we&apos;re going to take an approach that often appears when dealing with recursion:</p>
<blockquote>
<p><strong>To solve a problem with recursion, sometimes it&apos;s easier to solve a harder problem.</strong></p>
</blockquote>
<p>So, rather than solving <strong>the median problem</strong> directly, we will solve <strong>the selection problem</strong> defined as follows.</p>
<blockquote>
<p><strong>The Selection Problem:</strong> Given a list of numbers and a number <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>, find the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span>th smallest number in the list.</p>
</blockquote>
<h2 class="mume-header" id="the-quickselect-algorithm">The <code>quickselect</code> algorithm</h2>

<p>We can use a divide and conquer approach derived from <code>quicksort</code> to do selection.
The idea is to partition the list and then recursive do the selection on one part or the other.
Unlike <code>quicksort</code>, we only have to do a recursive search on one half of the list (as in binary search).
(Note that the smallest element will be returned for <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>, <em>not</em> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, so there are several cases where we add one to the pivot index.)</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">quickselect</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> _quickselect<span class="token punctuation">(</span>L<span class="token punctuation">,</span> k<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">_quickselect</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> k<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pivot <span class="token operator">=</span> partition<span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>
    <span class="token keyword">if</span> k <span class="token operator">&lt;=</span> pivot<span class="token punctuation">:</span>
        <span class="token keyword">return</span> _quickselect<span class="token punctuation">(</span>L<span class="token punctuation">,</span> k<span class="token punctuation">,</span> left<span class="token punctuation">,</span> pivot<span class="token punctuation">)</span>
    <span class="token keyword">elif</span> k <span class="token operator">==</span> pivot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> _quickselect<span class="token punctuation">(</span>L<span class="token punctuation">,</span> k<span class="token punctuation">,</span> pivot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">partition</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pivot <span class="token operator">=</span> randrange<span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>
    L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>right <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>right <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span>
    i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> pivot <span class="token operator">=</span> left<span class="token punctuation">,</span> right <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">,</span> right <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">:</span>
        <span class="token keyword">while</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">:</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">while</span> i <span class="token operator">&lt;</span> j <span class="token operator">and</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">:</span>
            j <span class="token operator">-=</span> <span class="token number">1</span>
        <span class="token keyword">if</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span>    
    <span class="token keyword">return</span> i
</pre><p>Just as with <code>quicksort</code>, we use a randomized pivot so that we can expect to eliminate a constant fraction of the list with each new step.  Unlike <code>quicksort</code>, we will not make a recursive call on both sides.  As a result, we&apos;ll see that the average running time is only <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.  That means we can do selection faster than we can sort, which makes sense, but it is <em>not obvious</em> how to do it.
We&apos;ll make the analysis formal below.</p>
<h2 class="mume-header" id="analysis">Analysis</h2>

<p>The <code>quickselect</code> algorithm is a <strong>randomized algorithm</strong>.<br>
The worst-case running time is bad.  If we are trying to select the largest element and the pivots all land on the smallest elements, then the running time will be quadratic.</p>
<p>Instead, we&apos;ll analyze the <strong>expected running time</strong>. The word <strong>expected</strong> comes from probability and refers to the <em>average</em> over all random choices the algorithm makes.</p>
<p>Given a list of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> numbers, the partition function will pick a random element to serve as the <em>pivot</em>.
We say a pivot is <em>good</em> if it lands in the range of indices from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">n/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">4</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><mi>n</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">3n/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">4</span></span></span></span>.
So, choosing randomly, there is a 50% chance of picking a good pivot.</p>
<p>With each recursive call, we get a smaller list.  Let&apos;s say that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> is the size of the list on the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathit">i</span></span></span></span>th recursive call, so <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>=</mo><msub><mi>n</mi><mn>0</mn></msub><mo>&gt;</mo><msub><mi>n</mi><mn>1</mn></msub><mo>&gt;</mo><mo>&#x22EF;</mo><mo>&gt;</mo><msub><mi>n</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">n = n_0 &gt; n_1 &gt; \cdots &gt; n_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="minner">&#x22EF;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span></span></span></span> is the (unknown) number of recursive calls.  There is a <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">1/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mord">/</span><span class="mord">2</span></span></span></span> probability of a good pivot at any step, so the expected value of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> can be bounded as follows.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>[</mo><msub><mi>n</mi><mi>i</mi></msub><mo>]</mo><mo>&#x2264;</mo><mo>(</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn><mo>)</mo><mrow><mo fence="true">(</mo><mfrac><mrow><mn>3</mn><mi>E</mi><mo>[</mo><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>]</mo></mrow><mn>4</mn></mfrac><mo fence="true">)</mo></mrow><mo>+</mo><mo>(</mo><mn>1</mn><mi mathvariant="normal">/</mi><mn>2</mn><mo>)</mo><mo>(</mo><mi>E</mi><mo>[</mo><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>]</mo><mo>)</mo><mo>=</mo><mrow><mo fence="true">(</mo><mfrac><mn>7</mn><mn>8</mn></mfrac><mo fence="true">)</mo></mrow><mi>E</mi><mo>[</mo><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>]</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">E[n_i] \le (1/2)\left(\frac{3E[n_{i-1}]}{4}\right) + (1/2)(E[n_{i-1}]) = \left(\frac{7}{8}\right)E[n_{i-1}].</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">/</span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">4</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">3</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">/</span><span class="mord">2</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mord">.</span></span></span></span></span></p>
<p>This bound combines two bounds, each that holds at least half the time, first the good pivot case where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub><mo>&#x2264;</mo><mn>3</mn><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">n_i \le 3n_{i-1}/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord">4</span></span></span></span> and second, the bad pivot case, where at least <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub><mo>&#x2264;</mo><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">n_i \le n_{i-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7859700000000001em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.638891em;vertical-align:-0.208331em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span></span></span></span>.
The actual expectation will be smaller, but this upper bound suffices.</p>
<p>Repeating this fact by plugging it into itself (recursively) for smaller values gives the next bound in terms of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>[</mo><msub><mi>n</mi><mi>i</mi></msub><mo>]</mo><mo>&#x2264;</mo><mrow><mo fence="true">(</mo><mfrac><mn>7</mn><mn>8</mn></mfrac><mo fence="true">)</mo></mrow><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo>&#x2264;</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>7</mn><mn>8</mn></mfrac><mo fence="true">)</mo></mrow><mn>2</mn></msup><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>2</mn></mrow></msub><mo>&#x2264;</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>7</mn><mn>8</mn></mfrac><mo fence="true">)</mo></mrow><mn>3</mn></msup><msub><mi>n</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>3</mn></mrow></msub><mo>&#x2264;</mo><mo>&#x22EF;</mo><mo>&#x2264;</mo><msup><mrow><mo fence="true">(</mo><mfrac><mn>7</mn><mn>8</mn></mfrac><mo fence="true">)</mo></mrow><mi>i</mi></msup><mi>n</mi><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">E[n_i] \le \left(\frac{7}{8}\right) n_{i-1}
\le \left(\frac{7}{8}\right)^2 n_{i-2}
\le \left(\frac{7}{8}\right)^3 n_{i-3}
\le \cdots \le
\left(\frac{7}{8}\right)^i n.</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.604038em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.604038em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.6540080000000001em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="minner">&#x22EF;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.614594em;vertical-align:-0.95003em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.664564em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mord">.</span></span></span></span></span></p>
<p>Each recursive call takes linear time, so the total running time will be</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>=</mo><munderover><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>k</mi></munderover><mi>O</mi><mo>(</mo><msub><mi>n</mi><mi>i</mi></msub><mo>)</mo><mo>=</mo><mi>O</mi><mo>(</mo><munderover><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>k</mi></munderover><msub><mi>n</mi><mi>i</mi></msub><mo>)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">T(n) = \sum_{i = 0}^k O(n_i) = O(\sum_{i=0}^k n_i).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.1137820000000005em;vertical-align:-1.277669em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">&#x2211;</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.1137820000000005em;vertical-align:-1.277669em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">&#x2211;</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
<p>So, we need to bound the sum of the <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>n</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">n_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>s, but we only need to bound the expected (average) sum.  The most important fact in all of probability is the <strong>linearity of expectations</strong>.  It says that the sum of two expected values is the expected value of the sum.  We use it here to finish our analysis.</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi><mo>[</mo><mi>T</mi><mo>(</mo><mi>n</mi><mo>)</mo><mo>]</mo><mo>=</mo><mi>O</mi><mrow><mo fence="true">(</mo><munderover><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>k</mi></munderover><mi>E</mi><mo>[</mo><msub><mi>n</mi><mi>i</mi></msub><mo>]</mo><mo fence="true">)</mo></mrow><mo>&#x2264;</mo><mi>O</mi><mrow><mo fence="true">(</mo><munderover><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mi>k</mi></munderover><msup><mrow><mo fence="true">(</mo><mfrac><mn>7</mn><mn>8</mn></mfrac><mo fence="true">)</mo></mrow><mi>i</mi></msup><mi>n</mi><mo fence="true">)</mo></mrow><mo>=</mo><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo><mi mathvariant="normal">.</mi></mrow><annotation encoding="application/x-tex">E[T(n)] = O\left(\sum_{i=0}^k E[n_i]\right) \le
O\left(\sum_{i=0}^k \left(\frac{7}{8}\right)^i n\right) = O(n).</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord mathit" style="margin-right:0.13889em;">T</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.1137820000000005em;vertical-align:-1.277669em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">&#x2211;</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mopen">[</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2264;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:3.1137820000000005em;vertical-align:-1.277669em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size4">(</span></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8361130000000003em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">&#x2211;</span></span></span><span style="top:-4.3000050000000005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.32144em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">8</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">7</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.664564em;"><span style="top:-3.9029000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size4">)</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span><span class="mord">.</span></span></span></span></span></p>
<p>The last step follows by the well-known equation for geometric series.  You should have seen it in a math class by now, but don&apos;t hesitate to look it up if you forgot it.</p>
<h2 class="mume-header" id="one-last-time-without-recursion">One last time without recursion</h2>

<p>The <code>quickselect</code> algorithm is an example of linear recursion.  Each function call makes just one more function call.  It&apos;s also <strong>tail recursive</strong> because that single recursive call is the last operation prior to returning.  So, as we&apos;ve seen several times before, it&apos;s possible to eliminate the recursion and replace it with a single loop.  The code is below, but you might want to try to write this yourself to see if you understand both the algorithm and the process of tail recursion elimination.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">quickselect</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">:</span>
    left<span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
    <span class="token keyword">while</span> left <span class="token operator">&lt;</span> right<span class="token punctuation">:</span>
        pivot <span class="token operator">=</span> partition<span class="token punctuation">(</span>L<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>
        <span class="token keyword">if</span> k <span class="token operator">&lt;=</span> pivot<span class="token punctuation">:</span>
            right <span class="token operator">=</span> pivot
        <span class="token keyword">elif</span> k <span class="token operator">==</span> pivot <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> L<span class="token punctuation">[</span>pivot<span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            left <span class="token operator">=</span> pivot <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">return</span> L<span class="token punctuation">[</span>left<span class="token punctuation">]</span>
</pre><p>As long as the difference between left and right shrinks by a constant factor every couple of pivots, we can be sure to <em>prune</em> enough of the search to get a linear time algorithm.</p>
<h2 class="mume-header" id="divide-and-conquer-recap">Divide-and-Conquer Recap</h2>

<p>There are three main classes of divide-and-conquer algorithms and analyses that we&apos;ve seen for lists.</p>
<p>The first,and perhaps simplest, were those like binary search, where each recursive step takes constant time and makes a single recursive call on a list that is a constant times smaller.  The total running time in those cases is proportional to the depth of the recursion, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.</p>
<p>The second class of recursive, divide-and-conquer algorithms we saw were binary recursion associated with sorting.  In those, the running time is linear plus the time to make recursive calls on shorter lists whose total length is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.  In those cases, as long as the depth of the recursion is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>, the total running time is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.</p>
<p>Now, we have a third class of divide-and-conquer algorithms, those like <code>quickselect</code>.  Here, like in the sorting algorithms, the running time is linear plus the cost of recursive calls.  However, like in binary search, there is only one recursive call.  In these cases, as long as the subproblems shrink by a constant factor at each step, the running time will be <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>.</p>
<h2 class="mume-header" id="a-note-on-derandomization">A Note on Derandomization</h2>

<p>An algorithm that does not use randomness is called <strong>deterministic</strong>.  So far, all the algorithms we have covered are deterministic so we didn&apos;t need to make the distinction.  In the case of the selection problem, it&apos;s possible to solve it in linear time in the worst-case, without randomness.</p>
<p>If you recall the <code>quickselect</code> algorithm depends on getting an approximate median in order to reduce the length of the list by a constant fraction.
So, if you had an algorithm for finding the median in linear time, you could use it to choose the pivots in <code>quickselect</code> in order to get a linear-time algorithm.</p>
<p>That should sound a little wrong.
We started this whole section with the idea that we can solve the median problem using an algorithm for selection.
Now, we want to solve the selection problem using an algorithm for median.
Will we be stuck with a chicken and egg situation?</p>
<p>The algorithm is sometimes called the <em>median of medians</em> algorithm.  You can find more info about it online.</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_14" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 14
    </p>
    <hr>
<h1 class="mume-header" id="mappings-and-hash-tables">Mappings and Hash Tables</h1>

<p>A <strong>mapping</strong> is an association between two sets of things.  It associates a value to a key.  We  refer to these associated pairs as <strong>key-value pairs</strong>.
Keys must be unique, so that there can only be one value associated with a given key.</p>
<p>The standard built-in data type in python for mappings is the dictionary (<code>dict</code>).
This kind of mapping is used by python itself to associate names of variables (strings) with objects.
In the notation for dictionaries, we would write <code>d[some_key] = some_value</code>.
This either creates a new key-value pair if <code>some_key</code> was not already in the dictionary, or it overwrites the existing pair with key <code>some_key</code>.</p>
<p>Not all programming languages come with a built-in data type for mappings.
We&apos;re going to pretend for a short time that we don&apos;t have a python dictionary available to us and go through the process of implementing one ourselves.  This will allow us to resolve one of the major unsolved mysteries from earlier in the course:</p>
<blockquote>
<p>Why does accessing or assigning a value in a dictionary take only constant time?</p>
</blockquote>
<h2 class="mume-header" id="the-mapping-adt">The Mapping ADT</h2>

<p>A <strong>mapping</strong> is a collection of key-value pairs such that the keys are unique (i.e. no two pairs have the same key).
It supports the following methods.</p>
<ul>
<li>
<p><strong><code>get(k)</code></strong> - return the value associate to the key <code>k</code>.  Usually an error (<code>KeyError</code>) is raised if the given key is not present.</p>
</li>
<li>
<p><strong><code>put(k, v)</code></strong> - Add the key-value pair <code>(k,v)</code> to the mapping.</p>
</li>
</ul>
<p>These are the two main operations.  They are what make a mapping, and are generally implemented as <code>__getitem__</code> and <code>__setitem__</code> in python in order to support the familiar square bracket notation.  We will put off anything more elaborate for now.  When we get into some implementations, we will put some other conditions on the keys.</p>
<h2 class="mume-header" id="a-minimal-implementation">A minimal implementation</h2>

<p>Here is a very lightweight method for using a <code>list</code> as a mapping.  We start with a little class to store key-value pairs, then give two methods to implement get and put.</p>
<div class="code-chunk" data-id="_trivialmapping" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=91, cmd id=&quot;_trivialmapping&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>key <span class="token operator">=</span> key
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; : &quot;</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">mapput</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> e <span class="token keyword">in</span> L<span class="token punctuation">:</span>
        <span class="token keyword">if</span> e<span class="token punctuation">.</span>key <span class="token operator">==</span> key<span class="token punctuation">:</span>
            e<span class="token punctuation">.</span>value <span class="token operator">=</span> value
            <span class="token keyword">return</span>
    L<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">mapget</span><span class="token punctuation">(</span>L<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> e <span class="token keyword">in</span> L<span class="token punctuation">:</span>
        <span class="token keyword">if</span> e<span class="token punctuation">.</span>key <span class="token operator">==</span> key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> e<span class="token punctuation">.</span>value
    <span class="token keyword">raise</span> KeyError
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-94" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=92, cmd continue=&quot;trivialmapping&quot;}" class="language-python">m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
mapput<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&apos;five&apos;</span><span class="token punctuation">)</span>
mapput<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&apos;one&apos;</span><span class="token punctuation">)</span>
mapput<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token string">&apos;thirteen&apos;</span><span class="token punctuation">)</span>
mapput<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&apos;four&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>mapget<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&apos;one&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>mapget<span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&apos;four&apos;</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">Traceback (most recent call last):
  File &quot;/Users/don/Dropbox/work/research/books/datastructures/docs/x1ggn1xta_code_chunk.py&quot;, line 2, in <module>
    mapput(m, 4, &apos;five&apos;)
NameError: name &apos;mapput&apos; is not defined
</module></pre></div></div><p>At this point, it seems that the only advantage of the <code>dict</code> structure is that it provides some useful syntax for adding and getting entries.  There are some other advantages, but we&apos;ll only reveal them by trying to build a map ourselves.</p>
<p>First, let&apos;s put our new data structure in a class.  This will allow us to encapsulate the underlying list so that users don&apos;t accidentally mess it up, for example, by appending to it rather than using <code>put</code>.  We&apos;d like to protect users from themselves, especially when there are properties of the structure we want to maintain.  In this case, we want to make sure keys stay unique.</p>
<div class="code-chunk" data-id="_listmappingsimple" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=93, cmd id=&quot;_listmappingsimple&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListMappingSimple</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> e<span class="token punctuation">.</span>key <span class="token operator">==</span> key<span class="token punctuation">:</span>
                e<span class="token punctuation">.</span>value <span class="token operator">=</span> value
                <span class="token keyword">return</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> e<span class="token punctuation">.</span>key <span class="token operator">==</span> key<span class="token punctuation">:</span>
                <span class="token keyword">return</span> e<span class="token punctuation">.</span>value
        <span class="token keyword">raise</span> KeyError
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>This is an okay start.  It supports <code>get</code> and <code>put</code> and that&apos;s enough to be a mapping, but we&apos;d like several more interesting methods to really put such a structure to use.  Let&apos;s extend the ADT with more features.</p>
<h2 class="mume-header" id="the-extended-mapping-adt">The extended Mapping ADT</h2>

<p>As with any collection, we might want some other methods such as <code>__len__</code>, <code>__contains__</code>, or various iterators.</p>
<p>The standard behavior for iterators in dictionaries is to iterate over the keys.  Alternative iterators are provided to iterate over the values or to iterate over the key-value pairs as tuples.  For a <code>dict</code> object this is done as follows.</p>
<div class="code-chunk" data-id="code-chunk-id-96" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=94, cmd}" class="language-python">d <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&apos;key1&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;value1&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;key2&apos;</span><span class="token punctuation">:</span> <span class="token string">&apos;value2&apos;</span><span class="token punctuation">}</span>

<span class="token keyword">for</span> k <span class="token keyword">in</span> d<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>

<span class="token keyword">for</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>

<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> d<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">key2
key1
value2
value1
key2 value2
key1 value1
</pre></div></div><p>We&apos;ll add the same kind of functionality to our Mapping ADT.  So, the <strong>extended Mapping ADT</strong> includes the following methods (with get and put renamed for python magic).</p>
<ul>
<li>
<p><code>__getitem__(k)</code>** - return the value associate to the key <code>k</code>.  Usually an error (<code>KeyError</code>) is raised if the given key is not present.</p>
</li>
<li>
<p><code>__setitem__(k, v)</code> - Add the key-value pair <code>(k,v)</code> to the mapping.</p>
</li>
<li>
<p><code>__len__</code> - return the number of keys in the dictionary.</p>
</li>
<li>
<p><code>__contains__(k)</code> - return true if the mapping contains a pair with key <code>k</code>.</p>
</li>
<li>
<p><code>__iter__</code> - return an iterator over the keys in the dictionary.</p>
</li>
<li>
<p><code>values</code> - return an iterator over the values in the dictionary.</p>
</li>
<li>
<p><code>items</code> - return an iterator over the key-value pairs (as tuples).</p>
</li>
</ul>
<p>It is very important to recall from the very beginning of the course that the <code>dict</code> class is a <strong>non-sequential collection</strong>.  That is, there is no significance to the ordering of the items and furthermore, you should never assume to know anything about the ordering of the pairs.  You should not even assume that the ordering will be consistent between two iterations of the same <code>dict</code>.  This same warning goes for the mappings we will implement and we&apos;ll see that the ability to rearrange the order of how they are stored is the secret behind the mysteriously fast running times.  However, this first implementation will have the items in a fixed order because we are using a <code>list</code> to store them.</p>
<div class="code-chunk" data-id="_listmapping_notDRY" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=95, cmd id=&quot;_listmapping_notDRY&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">ListMapping</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> self<span class="token punctuation">.</span>_entry<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> e <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            e<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> self<span class="token punctuation">.</span>_entry<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> e <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> e<span class="token punctuation">.</span>value
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> KeyError

    <span class="token keyword">def</span> <span class="token function">_entry</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> e<span class="token punctuation">.</span>key <span class="token operator">==</span> key<span class="token punctuation">:</span>
                <span class="token keyword">return</span> e
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__contains__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>    
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_entry<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">values</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>value <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">items</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Note that I took the opportunity to factor out some duplication in the <code>get</code> and <code>put</code> methods.</p>
<h2 class="mume-header" id="its-too-slow">It&apos;s Too Slow!</h2>

<p>Our goal is to to get the same kind of constant-time operations as in the <code>dict</code> class.  Right now, we are very far from that.  Currently, we need linear time to get put, and check membership.  To do better, we&apos;re going to need a new idea.  The <code>ListMapping</code> takes linear time because it has to iterate through the list.  We could make this faster if we had many short lists instead of one large list.  Then, we just need to have a quick way of knowing which short list to search or update.</p>
<p>We&apos;re going to store a list of <code>ListMappings</code>.
For any key <code>k</code>,  we want to compute the index of the <em>right</em> <code>ListMapping</code> for <code>k</code>.  We often call these <code>ListMapping</code>s <em>buckets</em>.  This term goes back to the idea that you can quickly group items into buckets.  Then, when looking for something in a bucket, you can check all the items in there assuming there aren&#x2019;t too many.</p>
<p>This means, we want an integer, i.e. the index into our list of buckets.  A <strong>hash function</strong> takes a key and returns an integer.  Most classes in python implement a method called <code>__hash__</code> that does just this.  We can use it to implement a simple mapping scheme that improves on the <code>ListMapping</code>.</p>
<div class="code-chunk" data-id="_hashmappingsimple" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=96, cmd id=&quot;_hashmappingsimple&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">HashMappingSimple</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_size <span class="token operator">=</span> <span class="token number">100</span>
        self<span class="token punctuation">.</span>_buckets <span class="token operator">=</span> <span class="token punctuation">[</span>ListMapping<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> self<span class="token punctuation">.</span>_bucket<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        m<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> self<span class="token punctuation">.</span>_bucket<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> m<span class="token punctuation">[</span>key<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_bucket</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_buckets<span class="token punctuation">[</span><span class="token builtin">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>_size<span class="token punctuation">]</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Let&apos;s look more closely at this code.  It seems quite simple, but it hides some mysteries.</p>
<p>First, the initializer creates a list of 100 ListMaps.  These are called the buckets. If the keys get spread evenly between the buckets then this will be about 100 times faster!  If two keys are placed in the same bucket, this is called a <strong>collision</strong>.</p>
<p>The <code>__getitem__</code> and <code>__setitem__</code> methods call the <code>_bucket</code> method to get one of these buckets for the given key and then just use that ListMap&apos;s get and put methods.  So, the idea is just to have several list maps instead of one and then you just need a quick way to decide which to use.  The <code>hash</code> function returns an integer based on the value of the given key.  The collisions will depend on the hash function.</p>
<h3 class="mume-header" id="how-many-buckets-should-we-use">How many buckets should we use?</h3>

<p>The number 100 is pretty arbitrary.  If there are many many entries, then one might get 100-fold speedup over ListMap, but not more.  It makes sense to use more buckets as the size increases.  To do this, we will keep track of the number of entries in the map.  This will allow us to implement <code>__len__</code> and also grow the number of buckets as needed.  As the number of entries grows, we can periodically increase the number of buckets.  Here is the code.</p>
<div class="code-chunk" data-id="_hashmapping_notDRY" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=97, cmd id=&quot;_hashmapping_notDRY&quot;}" class="language-python"><span class="token keyword">from</span> listmapping <span class="token keyword">import</span> ListMapping

<span class="token keyword">class</span> <span class="token class-name">HashMapping</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_size <span class="token operator">=</span> size
        self<span class="token punctuation">.</span>_buckets <span class="token operator">=</span> <span class="token punctuation">[</span>ListMapping<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> self<span class="token punctuation">.</span>_bucket<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token operator">not</span> <span class="token keyword">in</span> m<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_length <span class="token operator">+=</span> <span class="token number">1</span>
        m<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value

        <span class="token comment"># Check if we need more buckets.</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_length <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>_size<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_double<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        m <span class="token operator">=</span> self<span class="token punctuation">.</span>_bucket<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> m<span class="token punctuation">[</span>key<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_bucket</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_buckets<span class="token punctuation">[</span><span class="token builtin">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>_size<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_double</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Save a reference to the old buckets.</span>
        oldbuckets <span class="token operator">=</span> self<span class="token punctuation">.</span>_buckets
        <span class="token comment"># Double the size.</span>
        self<span class="token punctuation">.</span>_size <span class="token operator">*=</span> <span class="token number">2</span>
        <span class="token comment"># Create new buckets</span>
        self<span class="token punctuation">.</span>_buckets <span class="token operator">=</span> <span class="token punctuation">[</span>ListMapping<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token comment"># Add in all the old entries.</span>
        <span class="token keyword">for</span> bucket <span class="token keyword">in</span> oldbuckets<span class="token punctuation">:</span>
            <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> bucket<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># Identify the new bucket.</span>
                m <span class="token operator">=</span> self<span class="token punctuation">.</span>_bucket<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
                m<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_length
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="rehashing">Rehashing</h3>

<p>The most interesting part of the code above is the <code>_double</code> method.  This is a method that increases the number of buckets.  It&apos;s not enough to just append more buckets to the list, because the <code>_bucket</code> method that we use to find the right bucket depends on the number of buckets.  When that number changes, we have to reinsert all the items in the mapping so that they can be found when we next <code>get</code> them.</p>
<h2 class="mume-header" id="factoring-out-a-superclass">Factoring Out A Superclass</h2>

<p>We have given two different implementations of the same ADT.  There are several methods that we implemented in the <code>ListMapping</code> that we will also want in the <code>HashMapping</code>.  It makes sense to avoid duplicating common parts of these two (concrete) data structures.  Inheritance provides a nice way to do this.</p>
<p>This is the most common way that inheritance appears in code.  Two classes want to share some code, so we <strong>factor out a superclass</strong> that both can inherit from and share the underlying code.</p>
<p>There are some methods that we expect to be implemented by the subclass.  We can enforce this by putting the methods in the subclass, but raising an error if they are called.   This way, the error will only be raised if the subclass does not override those methods.</p>
<p>Here is the code for the superclass.</p>
<div class="code-chunk" data-id="_mapping" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=98, cmd id=&quot;_mapping&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>key <span class="token operator">=</span> key
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;%d: %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>key<span class="token punctuation">,</span> self<span class="token punctuation">.</span>value<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Mapping</span><span class="token punctuation">:</span>

    <span class="token comment"># Child class needs to implement this!</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplemented

    <span class="token comment"># Child class needs to implement this!</span>
    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplemented

    <span class="token comment"># Child class needs to implement this!</span>
    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplemented

    <span class="token comment"># Child class needs to implement this!</span>
    <span class="token keyword">def</span> <span class="token function">_entryiter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> NotImplemented        

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>key <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entryiter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">values</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>value <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entryiter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">items</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>key<span class="token punctuation">,</span> e<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entryiter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__contains__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">except</span> KeyError<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__setitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">&quot;{%s}&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">&quot;, &quot;</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entryiter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>There is a lot here, but notice that there are really only four methods that a subclass has to implement: <code>get</code>, <code>put</code>, <code>__len__</code>, and a method called <code>_entryiter</code> that iterates through the entries.  This last method is private because the user of this class does not need to access <code>Entry</code> objects.  They have the Mapping ADT methods to provide access to the data.  This is why the <code>Entry</code> class is an inner class (defined inside the <code>Mapping</code> class).</p>
<p>Now, the <code>ListMapping</code> can be rewritten as follows.</p>
<div class="code-chunk" data-id="_listmapping" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=99, cmd id=&quot;_listmapping&quot;}" class="language-python"><span class="token keyword">from</span> mapping <span class="token keyword">import</span> Mapping<span class="token punctuation">,</span> Entry

<span class="token keyword">class</span> <span class="token class-name">ListMapping</span><span class="token punctuation">(</span>Mapping<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> self<span class="token punctuation">.</span>_entry<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> e <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            e<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> self<span class="token punctuation">.</span>_entry<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> e <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> e<span class="token punctuation">.</span>value
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> KeyError

    <span class="token keyword">def</span> <span class="token function">_entry</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> e <span class="token keyword">in</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">:</span>
            <span class="token keyword">if</span> e<span class="token punctuation">.</span>key <span class="token operator">==</span> key<span class="token punctuation">:</span>
                <span class="token keyword">return</span> e
        <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">_entryiter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>All the magic methods as well as the public iterators and string conversion are handled by the superclass.  The subclass only has the parts that are specific to this implementation.</p>
<p>The <code>HashMapping</code> class can also be rewritten as follows.</p>
<div class="code-chunk" data-id="_hashmapping" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=100, cmd id=&quot;_hashmapping&quot;}" class="language-python"><span class="token keyword">from</span> mapping <span class="token keyword">import</span> Mapping
<span class="token keyword">from</span> listmapping <span class="token keyword">import</span> ListMapping

<span class="token keyword">class</span> <span class="token class-name">HashMapping</span><span class="token punctuation">(</span>Mapping<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> size <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_size <span class="token operator">=</span> size
        self<span class="token punctuation">.</span>_buckets <span class="token operator">=</span> <span class="token punctuation">[</span>ListMapping<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_size<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">_entryiter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>e <span class="token keyword">for</span> bucket <span class="token keyword">in</span> self<span class="token punctuation">.</span>_buckets <span class="token keyword">for</span> e <span class="token keyword">in</span> bucket<span class="token punctuation">.</span>_entryiter<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        bucket <span class="token operator">=</span> self<span class="token punctuation">.</span>_bucket<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> bucket<span class="token punctuation">[</span>key<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        bucket <span class="token operator">=</span> self<span class="token punctuation">.</span>_bucket<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token operator">not</span> <span class="token keyword">in</span> bucket<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_length <span class="token operator">+=</span> <span class="token number">1</span>
        bucket<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value

        <span class="token comment"># Check if we need more buckets.</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_length <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>_size<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_double<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_length

    <span class="token keyword">def</span> <span class="token function">_bucket</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_buckets<span class="token punctuation">[</span><span class="token builtin">hash</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">%</span> self<span class="token punctuation">.</span>_size<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_double</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Save the old buckets</span>
        oldbuckets <span class="token operator">=</span> self<span class="token punctuation">.</span>_buckets
        <span class="token comment"># Reinitialize with more buckets.</span>
        self<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_size <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> bucket <span class="token keyword">in</span> oldbuckets<span class="token punctuation">:</span>
            <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> bucket<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p style="page-break-after:always;"></p>
    <a name="chapter_15" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 15
    </p>
    <hr>
<h1 class="mume-header" id="trees">Trees</h1>

<p><strong>Trees</strong> data types are ideal for representing hierarchical structure.
Trees are composed of <strong>nodes</strong> and nodes have <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> or more <strong>children</strong> or <strong>child nodes</strong>.
A node is called the <strong>parent</strong> of its children.
Each node has (at most) one parent.
If the children are ordered in some way, then we have an <strong>ordered tree</strong>.
We are concerned primarily with <strong>rooted trees</strong>, i.e. there is a single special node called the <strong>root</strong> of the tree.
The root is the only node that does not have a parent.
The nodes that do not have any children are called <strong>leaves</strong> or <strong>leaf nodes</strong>.</p>
<p>There are many many examples of hierarchical (tree-like) structures:</p>
<ul>
<li>Class Hierarchies (assuming single inheritance).  The subclass is the child and the superclasses is the parent.  The python class <code>object</code> is the root.</li>
<li>File folders or directories on a computer can be nested inside other directories.  The parent-child relationship encode containment.</li>
<li>The tree of recursive function calls in the execution of a divide-and-conquer algorithm.  The leaves are those calls where the base case executes.</li>
</ul>
<p>Even though we use the family metaphor for many of the naming conventions, a family tree is not actually a tree.  The reason is that these violate the one parent rule.</p>
<p>When we draw trees, we take an Australian convention of putting the root on the top and the children below.  Although this is backwards with respect to the trees we see in nature, it does correspond to how we generally think of most other hierarchies.</p>
<h2 class="mume-header" id="some-more-definitions">Some more definitions</h2>

<p>A <strong>path</strong> in a tree is a sequence of nodes in which each node is a child of the previous node.
We say it is a path from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">x</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> if the first node is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">x</span></span></span></span> and the last node is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>.
There exists a path from the root to every node in the tree.
The <strong>length of the path</strong> is the number of hops or edges which is one less than the number of nodes in the path.
The <strong>descendants</strong> of a node <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">x</span></span></span></span> are all those nodes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> for which there is a path from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">x</span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>.
If <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span> is a descendant of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">x</span></span></span></span>, then we say <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">x</span></span></span></span> is an <strong>ancestor</strong> of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.19444em;"></span><span class="mord mathit" style="margin-right:0.03588em;">y</span></span></span></span>.
Given a tree <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>T</mi></mrow><annotation encoding="application/x-tex">T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.13889em;">T</span></span></span></span> and a node <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> in that tree, the <strong>subtree rooted at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span></strong> is the tree whose root is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> that contains all descendants of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span>.</p>
<p>The <strong>depth</strong> of a node is the length of the path to the node from the root.
The <strong>height</strong> of a tree is the maximum depth of any node in the tree.</p>
<h2 class="mume-header" id="a-recursive-view-of-trees">A recursive view of trees</h2>

<p>A tree can be defined recursively as a root with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span> or more children, each of which is tree.
This will be convenient at first and will be important later on as we think about doing more elaborate algorithms on trees, many of which are easiest to describe recursively.
Be warned however, that our object-oriented instincts will later kick in as we separate the notions of trees and nodes.
Having two different kinds of things will lead us to use two different classes to represent them.</p>
<p>We can use lists to represent a hierarchical structure by making lists of lists.
To make this a little more useful, we will also store some data in each node of the tree.
We&apos;ll use the convention that a list is a tree in which the first item is the data and the remaining items are the children (each should be a list).</p>
<p>Here is a simple example.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token punctuation">[</span><span class="token string">&apos;a&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;p&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;n&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;t&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</pre><p>This is a tree with <code>&apos;a&apos;</code> stored in the root.
The root has 3 children storing respectively, <code>&apos;p&apos;</code>, <code>&apos;n&apos;</code>, and <code>&apos;t&apos;</code>.
Here is a slightly bigger example that contains the previous example as a subtree.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">T <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&apos;c&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;a&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;p&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;n&apos;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;t&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;o&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&apos;n&apos;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</pre><p>We can print all the nodes in such a tree with the following code.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">printtree</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>T<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> child <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        printtree<span class="token punctuation">(</span>T<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">)</span>

printtree<span class="token punctuation">(</span>T<span class="token punctuation">)</span>
</pre><p>Whenever I see code like that above, I want to replace it with something that can work with any iterable collection.
This would involve getting rid of all the indices and using an iterator.  Here&apos;s the equivalent code that uses an iterator.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">printtree</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token punctuation">:</span>
    iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> child <span class="token keyword">in</span> iterator<span class="token punctuation">:</span>
        printtree<span class="token punctuation">(</span>child<span class="token punctuation">)</span>
</pre><p>Here we use the iterator to extract the first list item, then loop through the rest of the children.</p>
<p>The information in the tree is all present in this <em>list of lists</em> structure.
However, it can be cumbersome to read, write, and work with.
Let&apos;s package this into a class that allows us to write code that is as close as possible to how we think about and talk about trees.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Tree</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> L<span class="token punctuation">)</span><span class="token punctuation">:</span>
        iterator <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span>Tree<span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> iterator<span class="token punctuation">]</span>
</pre><p>The initializer takes a <em>list of lists</em> representation of a tree as input.  A <code>Tree</code> object has two attributes, <code>data</code> stores data associated with a node and <code>children</code> stores a list of <code>Tree</code> objects.
The recursive aspect of this tree is clear from the way the children are generated as <code>Tree</code>&apos;s.</p>
<p>Let&apos;s add our print function to the class.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">printtree</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token keyword">for</span> child <span class="token keyword">in</span> self<span class="token punctuation">.</span>children<span class="token punctuation">:</span>
        child<span class="token punctuation">.</span>printtree<span class="token punctuation">(</span><span class="token punctuation">)</span>
</pre><p>This is the most common pattern for algorithms that operate on trees.
It has two parts; one part operates on the data and the other part applies the function recursively on the children.
Here is another example of the same pattern.
Let&apos;s check if two trees are equal in the sense of having the same shape and data.  We use the <code>__eq__</code> method so this method will be used when we use <code>==</code> to check equality between <code>Tree</code>&apos;s.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">__eq__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> self<span class="token punctuation">.</span>data <span class="token operator">==</span> other<span class="token punctuation">.</span>data <span class="token operator">and</span> self<span class="token punctuation">.</span>children <span class="token operator">==</span> other<span class="token punctuation">.</span>children
</pre><p>Here, it is less obvious that we are doing recursion, but we are because <code>self.children</code> and <code>other.children</code> are lists and list equality is determined by testing the equality of the items.  In this case, the items in the  lists are <code>Tree</code>&apos;s, so our <code>__eq__</code> method will be invoked for each one.</p>
<p>Here&apos;s another example.  Let&apos;s write a function that computes the height of the tree.  We can do this by computing the height of the subtrees and return one more than the max of those.  If there are no children, the height is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn></mrow><annotation encoding="application/x-tex">0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">height</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token builtin">max</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>height<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> child <span class="token keyword">in</span> self<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
</pre><p><em>Hopefully, you are getting the hang of these generator expressions.</em></p>
<h2 class="mume-header" id="tree-traversal">Tree Traversal</h2>

<p>Previously, all the collections we stored were either sequential (i.e., <code>list</code>, <code>tuple</code>, and <code>str</code>) or non-sequential (i.e., <code>dict</code> and <code>set</code>).  The tree structure seems to lie somewhere between the two.
There is some structure, but it&apos;s not linear.
We can give it a linear (sequential) structure by iterating through all the nodes in the tree, but there is not a unique way to do this.
For trees, the process of visiting all the nodes is called <strong>tree traversal</strong>.
For ordered trees, there are two standard traversals, called <strong>preorder</strong> and <strong>postorder</strong>, both are naturally defined recursively.</p>
<p>In a preorder traversal, we <em>visit</em> the node first followed by the traversal of its children.
In a postorder traversal, we traverse all the children and then visit the node itself.
The <em>visit</em> refers to whatever computation we want to do with the nodes.
The <code>printtree</code> method given previously is a classic example of a preorder traversal.
We could also print the nodes in a postorder traversal as follows.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">printpostorder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> child <span class="token keyword">in</span> self<span class="token punctuation">.</span>children<span class="token punctuation">:</span>
        child<span class="token punctuation">.</span>printpostoder<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
</pre><p>It is only a slight change in the code, but it results in a different output.</p>
<h2 class="mume-header" id="if-you-want-to-get-fancy">If you want to get fancy...</h2>

<p>It was considered a great achievement in python to be able to do this kind of traversal with a generator.  Recursive generators seem a little mysterious, especially at first.  However, if you break down this code and walk through it by hand, it will help you have a better understanding of how generators work.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">preorder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> self<span class="token punctuation">.</span>data
    <span class="token keyword">for</span> child <span class="token keyword">in</span> self<span class="token punctuation">.</span>children<span class="token punctuation">:</span>
        <span class="token keyword">for</span> data <span class="token keyword">in</span> child<span class="token punctuation">.</span>preorder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> data
</pre><p>You can also do this to iterate over the trees (i.e. nodes).  I have made this one private because the user of the tree likely does not want or need access to the nodes.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">_preorder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">yield</span> self
    <span class="token keyword">for</span> child <span class="token keyword">in</span> self<span class="token punctuation">.</span>children<span class="token punctuation">:</span>
        <span class="token keyword">for</span> descendant <span class="token keyword">in</span> child<span class="token punctuation">.</span>_preorder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">yield</span> descendant
</pre><h3 class="mume-header" id="theres-a-catch">There&apos;s a catch!</h3>

<p>This recursive generator does not run in linear time!
Recall that each call to the generator produces an object.
The object does not go away after yielding because it may need to yield more values.
If one calls this method on a tree, each value yielded is passed all the way from the node to the root.
Thus, the total running time is proportional to the sum of the depths of all the nodes in the tree.
For a degenerate tree (i.e. a single path), this is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><msup><mi>n</mi><mn>2</mn></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord"><span class="mord mathit">n</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> time.
For a perfectly balanced binary tree, this is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.</p>
<p>Using recursion and the call stack make the tree traversal code substantially simpler than if we had to keep track of everything manually.
It would not be enough to store just the stack of nodes in the path from your current node up to the root. You would also have to keep track of your place in the iteration of the children of each of those nodes.  Remember that it is the job of an iterator object to keep track of where it is in the iteration. Thus, we can just push the iterators for the children onto the stack too.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">_postorder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
	node<span class="token punctuation">,</span> childiter <span class="token operator">=</span> self<span class="token punctuation">,</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>children<span class="token punctuation">)</span>
	stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> childiter<span class="token punctuation">)</span><span class="token punctuation">]</span>
	<span class="token keyword">while</span> stack<span class="token punctuation">:</span>
		node<span class="token punctuation">,</span> childiter <span class="token operator">=</span> stack<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
		<span class="token keyword">try</span><span class="token punctuation">:</span>
			child <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>childiter<span class="token punctuation">)</span>
			stack<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>children<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">except</span> StopIteration<span class="token punctuation">:</span>
			<span class="token keyword">yield</span> node
			stack<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>					
</pre><p>In the above code, I don&#x2019;t love the fact that I am reassigning <code>node</code> and <code>childiter</code> at every iteration of the loop.  Can you fix that so that it still works?</p>
<p style="page-break-after:always;"></p>
    <a name="chapter_16" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 16
    </p>
    <hr>
<h1 class="mume-header" id="binary-search-trees">Binary Search Trees</h1>

<p>Let&apos;s start with an ADT.  A <strong>SortedMapping</strong> is a mapping data type for which the keys are comparable.
It should support all the same operations as any other mapping as well as some other operations similar to those in a <code>SortedList</code> such as predecessor search.</p>
<h2 class="mume-header" id="the-sorted-mapping-adt">The Sorted Mapping ADT</h2>

<p>A <strong>sorted mapping</strong> stores a collection of key-value pairs (<em>with comparable keys</em>) supporting the following operations.</p>
<ul>
<li>
<p><code>get(k)</code> - Return the value associate to the key <code>k</code>.  An error (<code>KeyError</code>) is raised if the given key is not present.</p>
</li>
<li>
<p><code>put(k, v)</code> - Add the key-value pair <code>(k,v)</code> to the mapping.</p>
</li>
<li>
<p><code>floor(k)</code> - Return a tuple <code>(k,v)</code> corresponding to the key-value pair in the mapping with the largest key that is less than or equal to <code>k</code>.</p>
</li>
<li>
<p><code>remove(k)</code> - Remove the key-value pair with key <code>k</code> from the sorted mapping.  An error (<code>KeyError</code>) is raised if the given key is not present.</p>
</li>
</ul>
<h2 class="mume-header" id="binary-search-tree-properties-and-definitions">Binary Search Tree Properties and Definitions</h2>

<p>A tree is called a <strong>binary tree</strong> if every node has at most two children.
We will continue to assume that we are working with ordered trees and so we call the children <code>left</code> and <code>right</code>.
We say that a binary tree is a <strong>binary search tree</strong> if for every node <code>x</code>, all the keys in the subtree <code>x.left</code> are less than the key at <code>x</code> and all the keys in the subtree <code>x.right</code> are greater than the key of <code>x</code>.  This ordering property, also known as <strong>the BST property</strong> is what makes a binary search tree different from any other kind of binary tree.</p>
<div class="code-chunk" data-id="code-chunk-id-103" data-cmd="python"><div class="input-div"><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><svg baseProfile="full" height="150" version="1.1" width="500" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xlink="http://www.w3.org/1999/xlink"><defs/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="160" x2="80" y1="20" y2="70"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="80" x2="40" y1="70" y2="120"/><circle cx="40" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="40" y="120">0</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="80" x2="120" y1="70" y2="120"/><circle cx="120" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="120" y="120">2</text><circle cx="80" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="80" y="70">1</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="160" x2="240" y1="20" y2="70"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="240" x2="200" y1="70" y2="120"/><circle cx="200" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="200" y="120">4</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="240" x2="280" y1="70" y2="120"/><circle cx="280" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="280" y="120">6</text><circle cx="240" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="240" y="70">5</text><circle cx="160" cy="20" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="160" y="20">3</text></svg>
</div></div><p>The BST property is related to a new kind of tree traversal, that was not possible with other trees.
Previously we saw <em>preorder</em> and <em>postorder</em> traversal of trees.
These traversals visit all the nodes of the tree.
The preorder traversal visits the root of each subtree before to visiting any of its descendants.
The postorder traversal visits all the descendants before visiting the root.
The new traversal we introduce here is called <strong>inorder traversal</strong> and it visits all the nodes in the left child prior to visiting the root and then visits all the nodes in the right child after visiting the root.
This order results in a traversal of the nodes <em>in sorted order according to the ordering of the keys</em>.</p>
<h2 class="mume-header" id="a-minimal-implementation-1">A Minimal implementation</h2>

<p>We&apos;re going to implement a sorted mapping using a binary search tree.
As we have already written an abstract class for packaging up a lot of the magic methods we expect from a mapping, we will inherit from that class to get started.</p>
<p>Also, unlike in the previous section, we&apos;re going to distinguish between a class for the tree (<code>BSTMapping</code>) and a class for the nodes (<code>BSTNode</code>).
We will maintain a convention that the operations on the <code>BSTNode</code> class will operate on and return other <code>BSTNode</code> objects when appropriate, whereas the <code>BSTMapping</code> class will abstract away the existence of the nodes for the user, only returning keys and values.</p>
<p>Here is just the minimum requirements to be a <code>Mapping</code>.
It&apos;s a top down implementation, so it delegates all the real work to the <code>BSTNode</code> class.</p>
<div class="code-chunk" data-id="_bstmapping_00" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=102, cmd id=&quot;_bstmapping_00&quot;}" class="language-python"><span class="token keyword">from</span> mapping <span class="token keyword">import</span> Mapping

<span class="token keyword">class</span> <span class="token class-name">BSTMapping</span><span class="token punctuation">(</span>Mapping<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_root <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>value
        <span class="token keyword">raise</span> KeyError

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>root <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_root <span class="token operator">=</span> BSTNode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_root<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root <span class="token keyword">else</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">_entryiter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>_root

    <span class="token keyword">def</span> <span class="token function">floor</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            floornode <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
            <span class="token keyword">return</span> floornode<span class="token punctuation">.</span>key<span class="token punctuation">,</span> floornode<span class="token punctuation">.</span>value
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_root <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> KeyError

    <span class="token keyword">def</span> <span class="token function">__delitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The code above gives us almost everything we need.  There are a couple of mysterious lines to pay attention to.  One is the line in the <code>put</code> method that updates the root.  We will use this convention extensively.  As methods may rearrange the tree structure, such methods return the node that ought to be the new root of the subtree.  The same pattern appears in the <code>remove</code> function.</p>
<p>One other construct we haven&apos;t seen before is the <code>yield from</code> operation in the iterator.  This takes an iterable and iterates over it, yielding each item.  So, <code>yield from self._root</code> is the same as <code>for item in iter(self._root): yield item</code>.  It implies that our <code>BSTNode</code> class will have to be iterable.</p>
<p>Let&apos;s see how these methods are implemented.  We start with the initializer and some handy other methods.</p>
<div class="code-chunk" data-id="_bstmapping_01" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python  {code_chunk_offset=103, cmd id=&quot;_bstmapping_01&quot; continue=&quot;_bstmapping_00&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">BSTNode</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>key <span class="token operator">=</span> key
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        self<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_length
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The <code>get</code> method uses binary search to find the desired key.</p>
<div class="code-chunk" data-id="_bstmapping_02" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python  {code_chunk_offset=104, cmd id=&quot;_bstmapping_02&quot; continue=&quot;_bstmapping_01&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> KeyError
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Notice that we are using <code>self.left</code> and <code>self.right</code> as booleans.
This works because <code>None</code> evaluates to <code>False</code> and <code>BSTNode</code>&apos;s always evaluate to <code>True</code>.
We could have implemented <code>__bool__</code> to make this work, but it suffices to implement <code>__len__</code>.  Objects that have a <code>__len__</code> method are <code>True</code> if and only if the length is greater than <code>0</code>.  This is the default way to check if a container is empty.  So, for example, it&apos;s fine to write <code>while L: L.pop()</code> and it will never try to pop from an empty list.  In our case, it will allow us to write <code>if self.left</code> to check if there is a left child rather than writing <code>if self.left is not None</code>.</p>
<p>Next, we implement <code>put</code>.  It will work by first doing a binary search in the tree.  If it finds the key already in the tree, it overwrites the value (keys in a mapping are unique).  Otherwise, when it gets to the bottom of the tree, it adds a new node.</p>
<div class="code-chunk" data-id="_bstmapping_03" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python  {code_chunk_offset=105, cmd id=&quot;_bstmapping_03&quot; continue=&quot;_bstmapping_02&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>left <span class="token operator">=</span> BSTNode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>right <span class="token operator">=</span> BSTNode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">_updatelength</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        len_left <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">else</span> <span class="token number">0</span>
        len_right <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">else</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> len_left <span class="token operator">+</span> len_right
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>The <code>put</code> method also keeps track of the length, i.e. the number of entries in each subtree.</p>
<h3 class="mume-header" id="the-floor-function">The <code>floor</code> function</h3>

<p>The <code>floor</code> function is just a slightly fancier version of <code>get</code>.
It also does a binary search, but it has different behavior when the key is not found, depending on whether the last search was to the left or to the right.  Starting from any node, if we search to the right and the result is <code>None</code>, then we return the the node itself.
If we search to the left and the result is <code>None</code>, we also return <code>None</code>.</p>
<div class="code-chunk" data-id="_bstmapping_04" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python  {code_chunk_offset=106, cmd id=&quot;_bstmapping_04&quot; continue=&quot;_bstmapping_03&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">floor</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">else</span> <span class="token boolean">None</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">or</span> self<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">else</span> self
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>To parse the expressions above, it&apos;s helpful to remember that boolean operations on objects can evaluate to objects.  In particular <code>False or myobject</code> evaluates to <code>myobject</code>.  Use the python interactive shell to try out some other examples and to see how <code>and</code> behaves.</p>
<h3 class="mume-header" id="iteration">Iteration</h3>

<p>As mentioned above, binary search trees support inorder traversal.  The result of an inorder traversal is that the nodes are yielded <em>in the order of their keys</em>.</p>
<p>Here is an inorder iterator for a binary search tree implemented using recursive generators.  This will be fine in most cases.</p>
<div class="code-chunk" data-id="_bstmapping_05" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python  {code_chunk_offset=107, cmd id=&quot;_bstmapping_05&quot; continue=&quot;_bstmapping_04&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>left
        <span class="token keyword">yield</span> self
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>right
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h2 class="mume-header" id="removal">Removal</h2>

<p>To implement removal in a binary search tree, we&apos;ll use a standard algorithmic problem solving approach.
We&apos;ll start by thinking about how to handle the easiest possible cases.
Then, we&apos;ll see how to turn every case into an easy case.</p>
<p>The start of a removal is to find the node to be removed using binary search in the tree.
Then, if the node is a leaf, we can remove it without any difficulty.
It&apos;s also easy to remove a node with only one child because we can remove the node and bring its child up without violating the BST property.</p>
<p>The harder case come when the node to be removed has both a left and a right child.
In that case, we find the node with the largest key in its left subtree (i.e. the rightmost node).
We swap that node with our node to be removed and call <code>remove</code> again on the left subtree.
The next time we reach that node, we know it will have at most one child, because the node we swapped it with had no right child (otherwise it wasn&apos;t the rightmost before the swap).</p>
<p>A note of caution.
Swapping two node in a BST will cause the BST property to be violated.
However, the only violation is the node to be removed will have a key greater than the node that we swapped it with.
So, the removal will restore the BST property.</p>
<p>Here is the code to do the swapping and a simple recursive method to find the rightmost node in a subtree.</p>
<div class="code-chunk" data-id="_bstmapping_06" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=108, cmd id=&quot;_bstmapping_06&quot; continue=&quot;_bstmapping_05&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">_swapwith</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>key<span class="token punctuation">,</span> other<span class="token punctuation">.</span>key <span class="token operator">=</span> other<span class="token punctuation">.</span>key<span class="token punctuation">,</span> self<span class="token punctuation">.</span>key
        self<span class="token punctuation">.</span>value<span class="token punctuation">,</span> other<span class="token punctuation">.</span>value <span class="token operator">=</span> other<span class="token punctuation">.</span>value<span class="token punctuation">,</span> self<span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">maxnode</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>maxnode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">else</span> self
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Now, we are ready to implement <code>remove</code>.
As mentioned above, it does a recursive binary search to find the node.
When it finds the desired key, it swaps it into place and makes another recursive call.
This swapping step will happen only once and the total running time is linear in the height of the tree.</p>
<div class="code-chunk" data-id="_bstmapping_07" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python cmd id=&quot;_bstmapping_07&quot; continue=&quot;_bstmapping_06&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>right
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>left
            self<span class="token punctuation">.</span>_swapwith<span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>maxnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> KeyError
        self<span class="token punctuation">.</span>_updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="removal_example1" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=110, cmd id=&quot;removal_example1&quot;}" class="language-python"><span class="token keyword">from</span> drawtrees <span class="token keyword">import</span> draw
<span class="token keyword">from</span> bstmapping <span class="token keyword">import</span> BSTMapping

T <span class="token operator">=</span> BSTMapping<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    T<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">None</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-113" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=111, cmd continue=&quot;removal_example1&quot; output=&quot;html&quot;}" class="language-python">draw<span class="token punctuation">(</span>T<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><svg baseProfile="full" height="200" version="1.1" width="500" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xlink="http://www.w3.org/1999/xlink"><defs/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="120" x2="80" y1="20" y2="70"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="80" x2="40" y1="70" y2="120"/><circle cx="40" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="40" y="120">1</text><circle cx="80" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="80" y="70">2</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="120" x2="240" y1="20" y2="70"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="240" x2="160" y1="70" y2="120"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="160" x2="200" y1="120" y2="170"/><circle cx="200" cy="170" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="200" y="170">5</text><circle cx="160" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="160" y="120">4</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="240" x2="320" y1="70" y2="120"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="320" x2="280" y1="120" y2="170"/><circle cx="280" cy="170" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="280" y="170">8</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="320" x2="360" y1="120" y2="170"/><circle cx="360" cy="170" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="360" y="170">10</text><circle cx="320" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="320" y="120">9</text><circle cx="240" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="240" y="70">6</text><circle cx="120" cy="20" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="120" y="20">3</text></svg>
</div></div><div class="code-chunk" data-id="removal_example2" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=112, cmd id=&quot;removal_example2&quot; continue=&quot;removal_example1&quot; output=&quot;html&quot;}" class="language-python">T<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-115" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=113, cmd continue=&quot;removal_example2&quot; output=&quot;html&quot;}" class="language-python">draw<span class="token punctuation">(</span>T<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><svg baseProfile="full" height="200" version="1.1" width="500" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xlink="http://www.w3.org/1999/xlink"><defs/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="120" x2="80" y1="20" y2="70"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="80" x2="40" y1="70" y2="120"/><circle cx="40" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="40" y="120">1</text><circle cx="80" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="80" y="70">2</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="120" x2="200" y1="20" y2="70"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="200" x2="160" y1="70" y2="120"/><circle cx="160" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="160" y="120">4</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="200" x2="280" y1="70" y2="120"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="280" x2="240" y1="120" y2="170"/><circle cx="240" cy="170" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="240" y="170">8</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="280" x2="320" y1="120" y2="170"/><circle cx="320" cy="170" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="320" y="170">10</text><circle cx="280" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="280" y="120">9</text><circle cx="200" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="200" y="70">5</text><circle cx="120" cy="20" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="120" y="20">3</text></svg>
</div></div><div class="code-chunk" data-id="removal_example3" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=114, cmd id=&quot;removal_example3&quot; continue=&quot;removal_example2&quot; output=&quot;html&quot;}" class="language-python">T<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-117" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=115, cmd continue=&quot;removal_example3&quot; output=&quot;html&quot;}" class="language-python">draw<span class="token punctuation">(</span>T<span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><svg baseProfile="full" height="200" version="1.1" width="500" xmlns="http://www.w3.org/2000/svg" xmlns:ev="http://www.w3.org/2001/xml-events" xlink="http://www.w3.org/1999/xlink"><defs/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="80" x2="40" y1="20" y2="70"/><circle cx="40" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="40" y="70">1</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="80" x2="160" y1="20" y2="70"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="160" x2="120" y1="70" y2="120"/><circle cx="120" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="120" y="120">4</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="160" x2="240" y1="70" y2="120"/><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="240" x2="200" y1="120" y2="170"/><circle cx="200" cy="170" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="200" y="170">8</text><line fill="white" fill-opacity="1" font-size="36pt" stroke="black" stroke-width="3" x1="240" x2="280" y1="120" y2="170"/><circle cx="280" cy="170" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="280" y="170">10</text><circle cx="240" cy="120" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="240" y="120">9</text><circle cx="160" cy="70" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="160" y="70">5</text><circle cx="80" cy="20" fill="white" fill-opacity="1" font-size="36pt" r="18" stroke="black" stroke-width="3"/><text dominant-baseline="central" fill="black" fill-opacity="1" font-size="20pt" stroke="black" stroke-width="0" text-anchor="middle" x="80" y="20">2</text></svg>
</div></div><p style="page-break-after:always;"></p>
    <a name="chapter_17" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 17
    </p>
    <hr>
<h1 class="mume-header" id="balanced-binary-search-trees">Balanced Binary Search Trees</h1>

<p>In the previous chapter, we saw how to implement a Mapping using a BST.
However, in the analysis of the main operations, it was clear that the running time of all the basic operations depended on the height of the tree.</p>
<p>A BST with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> nodes can have height <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>.
It&apos;s easy to get such a tree, just insert the keys in sorted order.
On the other hand, there always exists a BST with height <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> for any set of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> keys.
This is achieved by inserting the median first, followed by the medians of each half and so on recursively.
So, we have a big gap between the best case and the worst case.
Our goal will be to get as close as possible to the best case while keeping the running times of all operations proportional to the height of the tree.</p>
<p>We will say that a BST with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> nodes is <strong>balanced</strong> if the height of the tree is at most some constant times <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>&#x2061;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\log n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span></span></span></span>.
To balance our BSTs, we want to avoid rebuilding the whole tree.
Instead, we&apos;d like to make a minimal change to the tree that will preserve the BST property.</p>
<p>The most basic such operation is called a <strong>tree rotation</strong>.
It comes in two forms, <code>rotateright</code> and <code>rotateleft</code>.
Rotating a node to the right will move it to be the right child of its left child and will update the children of these nodes appropriately.
Here it is in code.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">rotateright</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>left
    self<span class="token punctuation">.</span>left <span class="token operator">=</span> newroot<span class="token punctuation">.</span>right
    newroot<span class="token punctuation">.</span>right <span class="token operator">=</span> self
    <span class="token keyword">return</span> newroot
</pre><p>Notice that <code>rotateright</code> returns the new root (of the subtree).
This is a very useful convention when working with BSTs and rotations.
Every method that can change the structure of the tree will return the new root of the resulting subtree.
Thus, calling such methods will always be combined with an assignment.
For example, if we want to rotate the left child of a node <code>parent</code> to the right, we would write <code>parent.left = parent.left.rotateright()</code>.</p>
<h2 class="mume-header" id="a-bstmapping-implementation">A <code>BSTMapping</code> implementation</h2>

<p>Here is the code for the <code>BSTMapping</code> that implements rotations.
We make sure to also update the lengths after each rotation.
The main difference with our previous code is that now, all methods that can change the tree structure are combined with assignments.
It is assumed that only <code>put</code> and <code>remove</code> will rearrange the tree, and so <code>get</code> and <code>floor</code> will keep the tree structure as is.</p>
<div class="code-chunk" data-id="code-chunk-id-118" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=116, cmd}" class="language-python"><span class="token keyword">from</span> mapping <span class="token keyword">import</span> Mapping<span class="token punctuation">,</span> Entry


<span class="token keyword">class</span> <span class="token class-name">BSTNode</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>key <span class="token operator">=</span> key
        self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        self<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token boolean">None</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">newnode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> BSTNode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> KeyError

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>value <span class="token operator">=</span> value
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>newnode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>newnode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">updatelength</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        len_left <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">else</span> <span class="token number">0</span>
        len_right <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">else</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>_length <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> len_left <span class="token operator">+</span> len_right

    <span class="token keyword">def</span> <span class="token function">floor</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">else</span> <span class="token boolean">None</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">or</span> self<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">else</span> self

    <span class="token keyword">def</span> <span class="token function">rotateright</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>left
        self<span class="token punctuation">.</span>left <span class="token operator">=</span> newroot<span class="token punctuation">.</span>right
        newroot<span class="token punctuation">.</span>right <span class="token operator">=</span> self
        self<span class="token punctuation">.</span>updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        newroot<span class="token punctuation">.</span>updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot

    <span class="token keyword">def</span> <span class="token function">rotateleft</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>right
        self<span class="token punctuation">.</span>right <span class="token operator">=</span> newroot<span class="token punctuation">.</span>left
        newroot<span class="token punctuation">.</span>left <span class="token operator">=</span> self
        self<span class="token punctuation">.</span>updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        newroot<span class="token punctuation">.</span>updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot

    <span class="token keyword">def</span> <span class="token function">maxnode</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>maxnode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">else</span> self

    <span class="token keyword">def</span> <span class="token function">_swapwith</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">&quot;&quot;&quot;
        Swaps the key and value of a node.
        This operation has the potential to break the BST property.
        Use with caution!
        &quot;&quot;&quot;</span>
        self<span class="token punctuation">.</span>key<span class="token punctuation">,</span> other<span class="token punctuation">.</span>key <span class="token operator">=</span> other<span class="token punctuation">.</span>key<span class="token punctuation">,</span> self<span class="token punctuation">.</span>key
        self<span class="token punctuation">.</span>value<span class="token punctuation">,</span> other<span class="token punctuation">.</span>value <span class="token operator">=</span> other<span class="token punctuation">.</span>value<span class="token punctuation">,</span> self<span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>left <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>right
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>right <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">return</span> self<span class="token punctuation">.</span>left
            self<span class="token punctuation">.</span>_swapwith<span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>maxnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> KeyError
        self<span class="token punctuation">.</span>updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self

    <span class="token keyword">def</span> <span class="token function">__iter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>left
        <span class="token keyword">yield</span> Entry<span class="token punctuation">(</span>self<span class="token punctuation">.</span>key<span class="token punctuation">,</span> self<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>right

    <span class="token keyword">def</span> <span class="token function">preorder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> self<span class="token punctuation">.</span>key
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>preorder<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span> <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>preorder<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_length

<span class="token keyword">class</span> <span class="token class-name">BSTMapping</span><span class="token punctuation">(</span>Mapping<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Node <span class="token operator">=</span> BSTNode

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_root <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> KeyError
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_root <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>put<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_root <span class="token operator">=</span> self<span class="token punctuation">.</span>Node<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">floor</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            floornode <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
            <span class="token keyword">if</span> floornode <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> floornode<span class="token punctuation">.</span>key<span class="token punctuation">,</span> floornode<span class="token punctuation">.</span>value
        <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> KeyError
        self<span class="token punctuation">.</span>_root <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_entryiter</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>_root

    <span class="token keyword">def</span> <span class="token function">preorder</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">:</span>
            <span class="token keyword">yield</span> <span class="token keyword">from</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>preorder<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_root<span class="token punctuation">)</span> <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root <span class="token keyword">else</span> <span class="token number">0</span>

    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>preorder<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><h3 class="mume-header" id="forward-compatibility-of-factories">Forward Compatibility of Factories</h3>

<p>We are looking into the future a little with this code.
In particular, we want this class to be easily extendable.
To do this, we don&apos;t create new instances of the nodes directly.
In the <code>BSTMapping</code> class, we have the assignment <code>Node = BSTNode</code> and create new nodes by writing <code>self.Node(key, value)</code> rather than <code>BSTNode(key, value)</code>.
This way, when we extend this class (as we will several times), we can use a different value for <code>Node</code> in order to produce different types of nodes without having to rewrite all the methods from <code>BSTMapping</code>.
Similarly, we use a <code>newnode</code> method in the <code>BSTNode</code> class.
A method that generates new instances of a class is sometimes called a <strong>factory</strong>.</p>
<p>With regards to <em>forward compatibility</em>, it&apos;s a challenge to walk the fine line between, good design and premature optimization.
In our case, the use of a factory to generate nodes only came about after the need was clear from writing subclasses.
This should be a general warning to students when reading code in textbooks.
One often only sees how the code ended up, but not how it started.
It&apos;s helpful to ask, &quot;Why is the code written this way or that way?&quot;, but the answer might be that it will make later code easier to write.</p>
<h2 class="mume-header" id="weight-balanced-trees">Weight Balanced Trees</h2>

<p>Now, we&apos;re ready to balance our trees.
One way to be sure the tree is balanced is to have the key at each node <code>x</code> be the median of all the keys in the subtree at <code>x</code>.
Then, the situation would be analogous to binary search in a sorted <code>list</code>.
Moving down the tree, every node would have have as many nodes in its subtree than its parent.
Thus, after <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>log</mi><mo>&#x2061;</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">\log n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span></span></span></span> steps, we reach a leaf and so the BST would be balanced.</p>
<p>Having medians in every node a nice ideal to have, but it is both too difficult to achieve and too strong an invariant for balancing BSTs.
Recall that in our analysis of <code>quicksort</code> and <code>quickselect</code>, we considered <em>good pivots</em> to be those that lay in the middle half of the list (i.e. those with rank between <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">n/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">4</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>3</mn><mi>n</mi><mi mathvariant="normal">/</mi><mn>4</mn></mrow><annotation encoding="application/x-tex">3n/4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">3</span><span class="mord mathit">n</span><span class="mord">/</span><span class="mord">4</span></span></span></span>).
If the key in each node is a good pivot among the keys in its subtree, then we can also guarantee an overall height of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mrow><mn>4</mn><mi mathvariant="normal">/</mi><mn>3</mn></mrow></msub><mi>n</mi></mrow><annotation encoding="application/x-tex">\log_{4/3} n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1135799999999998em;vertical-align:-0.41913999999999996em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.28086em;"><span style="top:-2.45586em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">4</span><span class="mord mtight">/</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.41913999999999996em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span></span></span></span>.</p>
<p>We&apos;ll say a node <code>x</code> is <strong>weight-balanced</strong> if</p>
<p><code>len(x) + 1 &lt; 4 * (min(len(x.left),len(x.right)) + 1)</code>.</p>
<p>It&apos;s easy enough to check this condition with our <code>BSTMapping</code> implementation because it keeps track of the length at each node.
If some change causes a node to no longer be weight balanced, we will recover the weight balance by rotations.
In the easiest case, a single rotation suffices.
If one is rotation is not enough, then two rotations will be enough.
We&apos;ll have to see some examples and do some simple algebra to see why.</p>
<p>The <code>rebalance</code> method will check for the balance condition and do the appropriate rotations.
We&apos;ll call this method after every change to the tree, so we can assume that the unbalanced node <code>x</code> is only just barely imbalanced.
Without loss of generality, let&apos;s assume <code>x</code> has too few nodes in its left subtree.
Then, when we call <code>x.rotateleft()</code>, we have to check that both <code>x</code> becomes weight balanced and also that its new parent <code>y</code> (the former right child of <code>x</code>) is weight balanced.
Clearly, <code>len(x) == len(x.rotateleft())</code> as both contain the same nodes.
So, there is an imbalance at <code>y</code> after the rotation only if its right child is too light.
In that case, we rotate <code>y</code> right before rotating <code>x</code> left.
This will guarantee that all the nodes in the subtree are weight balanced.</p>
<p>This description is not enough to be convincing that the algorithm is correct, but it is enough to write code.
Let&apos;s look at the code first and see the rebalance method in action.
Then, we&apos;ll go back and do the algebra to prove it is correct.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">from</span> bstmapping <span class="token keyword">import</span> BSTMapping<span class="token punctuation">,</span> BSTNode


<span class="token keyword">class</span> <span class="token class-name">WBTreeNode</span><span class="token punctuation">(</span>BSTNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">newnode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> WBTreeNode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">toolight</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        otherlength <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span> <span class="token keyword">if</span> other <span class="token keyword">else</span> <span class="token number">0</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&gt;=</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token punctuation">(</span>otherlength <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">rebalance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>toolight<span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>toolight<span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
            newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>toolight<span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>toolight<span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
            newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self
        <span class="token keyword">return</span> newroot

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> BSTNode<span class="token punctuation">.</span>put<span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot<span class="token punctuation">.</span>rebalance<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> BSTNode<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot<span class="token punctuation">.</span>rebalance<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> newroot <span class="token keyword">else</span> <span class="token boolean">None</span>

<span class="token keyword">class</span> <span class="token class-name">WBTreeMapping</span><span class="token punctuation">(</span>BSTMapping<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Node <span class="token operator">=</span> WBTreeNode
</pre><p>The <code>toolight</code> method is for checking if a subtree has enough nodes to be a child of a weight balanced node.
We use it both to check if the current node is weight balanced and also to check if one rotation or two will be required.</p>
<p>The <code>put</code> and <code>remove</code> methods call the corresponding methods from the superclass <code>BSTNode</code> and then rebalance before returning.
We tried to reuse as much as possible our existing implementation.</p>
<h2 class="mume-header" id="height-balanced-trees-avl-trees">Height-Balanced Trees (AVL Trees)</h2>

<p>The motivation for balancing our BSTs was to keep the height small.
Rather than balancing by weight, we could also try to keep the heights of the left and right subtrees close.
In fact, we can require that these heights differ by at most one.
Similar to weight balanced trees, we&apos;ll see if the height balanced property is violated and if so, fix it with one or two rotations.</p>
<p>Such height balanced trees are often called AVL trees.
In our implementation, we&apos;ll maintain the height of each subtree and use these to check for balance.
Often, AVL trees only keep the balance at each node rather than the exact height, but computing heights is relatively painless.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">from</span> bstmapping <span class="token keyword">import</span> BSTMapping<span class="token punctuation">,</span> BSTNode

<span class="token keyword">def</span> <span class="token function">height</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> node<span class="token punctuation">.</span>height <span class="token keyword">if</span> node <span class="token keyword">else</span> <span class="token operator">-</span><span class="token number">1</span>

<span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> node<span class="token punctuation">:</span>
        node<span class="token punctuation">.</span>updatelength<span class="token punctuation">(</span><span class="token punctuation">)</span>
        node<span class="token punctuation">.</span>updateheight<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">AVLTreeNode</span><span class="token punctuation">(</span>BSTNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        BSTNode<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>updateheight<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">newnode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> AVLTreeNode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">updateheight</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token builtin">max</span><span class="token punctuation">(</span>height<span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">,</span> height<span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">balance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> height<span class="token punctuation">(</span>self<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token operator">-</span> height<span class="token punctuation">(</span>self<span class="token punctuation">.</span>left<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">rebalance</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        bal <span class="token operator">=</span> self<span class="token punctuation">.</span>balance<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> bal <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>balance<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
            newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> bal <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>balance<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
            newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self
        update<span class="token punctuation">(</span>newroot<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
        update<span class="token punctuation">(</span>newroot<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
        update<span class="token punctuation">(</span>newroot<span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> BSTNode<span class="token punctuation">.</span>put<span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        update<span class="token punctuation">(</span>newroot<span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot<span class="token punctuation">.</span>rebalance<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">remove</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> BSTNode<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        update<span class="token punctuation">(</span>newroot<span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot<span class="token punctuation">.</span>rebalance<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> newroot <span class="token keyword">else</span> <span class="token boolean">None</span>

<span class="token keyword">class</span> <span class="token class-name">AVLTreeMapping</span><span class="token punctuation">(</span>BSTMapping<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Node <span class="token operator">=</span> AVLTreeNode

</pre><h2 class="mume-header" id="splay-trees">Splay Trees</h2>

<p>Let&apos;s add in one more balanced BST for good measure.
In this case, we won&apos;t actually get a guarantee that the resulting tree is balanced, but we will get some other nice properties.</p>
<p>In a <strong>splay tree</strong>, every time we get or put an entry, its node will get rotated all the way to the root.
However, instead of rotating it directly, we consider two steps at a time.
The <code>splayup</code> method looks two levels down the tree for the desired key.
If its not exactly two levels down, it does nothing.
Otherwise, it rotates it up twice.
If the rotations are in the same direction, the bottom one is done first.
If the rotations are in opposite directions, it does the top one first.</p>
<p>At the very top level, we may do only a single rotation to get the node all the way to the root.
This is handled by the <code>splayup</code> method in the <code>SplayTreeMapping</code> class.</p>
<p>A major difference from our previous implementations is that now, we will modify the tree on calls to <code>get</code>.
As a result, we will have to rewrite <code>get</code> rather than inheriting it.
Previously, get would return the desired value.
However, we want to return the new root on every operation that might change the tree.
So, which should we return?
Clearly, we need that value to return, and we also need to not break the tree.
Thankfully, there is a simple solution.
The splaying operation conveniently rotates the found node all the way to the root.
So, the <code>SplayTreeNode.get</code> method will return the new root of the subtree, and the <code>SplayTreeMapping.get</code> returns the value at the root.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">from</span> bstmapping <span class="token keyword">import</span> BSTMapping<span class="token punctuation">,</span> BSTNode

<span class="token keyword">class</span> <span class="token class-name">SplayTreeNode</span><span class="token punctuation">(</span>BSTNode<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">newnode</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> SplayTreeNode<span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">splayup</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> self
        <span class="token keyword">if</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
                newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
                newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">if</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
                newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
                newroot <span class="token operator">=</span> self<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        newroot <span class="token operator">=</span> BSTNode<span class="token punctuation">.</span>put<span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token keyword">return</span> newroot<span class="token punctuation">.</span>splayup<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> self<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            <span class="token keyword">return</span> self
        <span class="token keyword">elif</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>left<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>left <span class="token operator">=</span> self<span class="token punctuation">.</span>left<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>key <span class="token operator">and</span> self<span class="token punctuation">.</span>right<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>right <span class="token operator">=</span> self<span class="token punctuation">.</span>right<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> KeyError
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>splayup<span class="token punctuation">(</span>key<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">SplayTreeMapping</span><span class="token punctuation">(</span>BSTMapping<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Node <span class="token operator">=</span> SplayTreeNode

    <span class="token keyword">def</span> <span class="token function">splayup</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> key <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_root <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>rotateright<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token operator">&gt;</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>key<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_root <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>rotateleft<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>_root <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span> <span class="token keyword">raise</span> KeyError
        self<span class="token punctuation">.</span>_root <span class="token operator">=</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>splayup<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_root<span class="token punctuation">.</span>value

    <span class="token keyword">def</span> <span class="token function">put</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        BSTMapping<span class="token punctuation">.</span>put<span class="token punctuation">(</span>self<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>splayup<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
</pre><p style="page-break-after:always;"></p>
    <a name="chapter_18" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 18
    </p>
    <hr>
<h1 class="mume-header" id="priority-queues">Priority Queues</h1>

<p>We&apos;re going to discuss a versatile and  fundamental data structure called a <strong>priority queue</strong>.  It will resemble a queue except that items all have a priority and will come out ordered by their priority rather than their order of insertion.</p>
<p>By this point, we know enough about different data structures that we will be able to implement this data structure in several different ways.  Eventually, we will introduce a data structure called a <strong>heap</strong> that will give good performance in many respects, but it won&apos;t be</p>
<h2 class="mume-header" id="the-priority-queue-adt">The Priority Queue ADT</h2>

<p>The <strong>Priority Queue ADT</strong> is a data type that stores a collection of items with priorities (not necessarily unique) that supports the following operations.</p>
<ul>
<li>
<p><code>insert(item, priority)</code> - Add <code>item</code> with the given <code>priority</code>.</p>
</li>
<li>
<p><code>findmin()</code> - Return the item with the minimum priority.  If there are multiple items with the minimum priority, ties may be broken arbitrarily.</p>
</li>
<li>
<p><code>removemin()</code> - Remove and return the item with the minimum priority.  Ties are broken arbitrarily.</p>
</li>
</ul>
<h2 class="mume-header" id="using-a-list">Using a list</h2>

<p>As with every ADT presented in this book, there is a simple, though not necessarily efficient, implementation using a list. Let&apos;s start with a list and put all the entries in the list. To find the min, we can iterate through the list.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">SimpleListPQ</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">findmin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">min</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">removemin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        item<span class="token punctuation">,</span> priority <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_L<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_L<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
</pre><p>Although this code will work, there are a couple design decisions that are not great. First, there is something we might call <em>magical indices</em>.
As the data are stored as tuples, we have to use an index to pull out the priority or the item as needed.  This is an undocumented convention.  Someone reading the code would have to read the insert code to understand the <code>findmin</code> code. Also, there is some duplication in the use of <code>min</code> with the same <code>key</code> lambda expression for both <code>removemin</code> and <code>findmin</code>. These shortcomings can be our motivation to go back and clean it up, i.e. <strong>refactor</strong> it.</p>
<p>We&apos;ll make a class that stores the entries, each will have an <code>item</code> and a <code>priority</code> as attributes. We&apos;ll make the entries comparable by implementing <code>__lt__</code> and thus the comparison of entries will always just compare their priorities.</p>
<div class="code-chunk" data-id="entry" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=117, cmd id=&quot;entry&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">Entry</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>priority <span class="token operator">=</span> priority
        self<span class="token punctuation">.</span>item <span class="token operator">=</span> item

    <span class="token keyword">def</span> <span class="token function">__lt__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> other<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>priority <span class="token operator">&lt;</span> other<span class="token punctuation">.</span>priority
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Now, we can rewrite the list version of the priority queue.  It&apos;s almost the same as before, except, that by using the <code>Entry</code> class, the code is more explicit about the types of objects, and hopefully, easier to read and understand.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">UnsortedListPQ</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">findmin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">min</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span><span class="token punctuation">.</span>item

    <span class="token keyword">def</span> <span class="token function">removemin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        entry <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>entry<span class="token punctuation">)</span>
        <span class="token keyword">return</span> entry<span class="token punctuation">.</span>item
</pre><p>Let&apos;s analyze the running time of the methods in this class.
The <code>insert</code> method will clearly only require constant time because it is a single list append.  Both <code>findmin</code> and <code>removemin</code> take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time for a priority queue with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> items, because the <code>min</code> function will iterate through the while list to find the smallest priority entry.</p>
<p>The <code>findmin</code> would be much faster if the list were sorted.  Then we could just return the first item in the list.  An even better approach would sort the list backwards.  Then <code>removemin</code> could also be constant time, using the constant-time <code>pop</code> function on a list.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">SortedListPQ</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>reverse <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">findmin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item

    <span class="token keyword">def</span> <span class="token function">removemin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>item
</pre><p>I used a nice feature of the python <code>sort</code> method, a named parameter called <code>reversed</code> which, as one might guess, reverses the sorting order.</p>
<p>The asymptotic running time of both <code>findmin</code> and <code>removemin</code> is reduced to constant-time.  The <code>insert</code> method no longer runs in constant time, because it sorts.  This means that the running time will depend on the time it takes to sort.  In this case, assuming no other methods rearrange the (private!) <code>_entries</code> attribute, there will be only one entry out of sorted order, the one we just appended.  In this case, a good implementation of insertion sort would run in linear time (it only has to insert one item before everything is sorted).  Although, for code brevity, we called out to python&apos;s <code>sort</code> method, (which could take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span>-time) this is really a linear-time operation).</p>
<p>What we have with our two list implementations of the priority queue ADT is <strong>tradeoff</strong> between two operations.  In one case, we have fast <code>insert</code> and slow <code>removemin</code> and in the other we have slow <code>insert</code> and fast <code>removemin</code>.  Our goal will be to get all of the operations pretty fast.  We may not achieve constant time for all, but logarithmic-time is achievable.</p>
<h2 class="mume-header" id="heaps">Heaps</h2>

<p>The data structure we&apos;ll use for an efficient priority queue is called a <strong>heap</strong>.  Heaps are almost always used to implement a priority queue so that as you look at other sources, you might not see a distinction between the two ideas.  As we are using it, the priority queue is the ADT, the heap is the data structure.</p>
<p>Matters are complicated by two other vocabulary issues.  First, there are many different kinds of heaps.  We&apos;ll study just one example, the so-called binary heap.  Second, the usual word used for the <em>priority</em> in a heap is &quot;key&quot;.  This can be confusing, because unlike <em>keys</em> in mapping data structures, there is no requirement that priorities be unique.  We will stick with the word &quot;priority&quot; despite the usual conventions in order to keep these ideas separate.</p>
<p>We can think of a binary heap as a binary tree that is arranged so that smaller priorities are above larger priorities.  The name is apt as any good heap of stuff should have the big things on the bottom and small things on the top.  For any tree with nodes that have priorities, we say that the <strong>tree is heap-ordered</strong> if for every node, the priority of its children are at least as large as the the priority of the node itself.  This naturally implies that the minimum priority is at the root.</p>
<h2 class="mume-header" id="storing-a-tree-in-a-list">Storing a tree in a list</h2>

<p>Previously, we stored trees as a <strong>linked data structure</strong>.  This means having a node class that stores references to other nodes, i.e. the children.  We&apos;ll use the heap as an opportunity to see a different way to represent a tree.  We&apos;ll put the heap entries in a list and let the list indices encode the parent-child relationships of the tree.</p>
<p>For a node at index <code>i</code>, its left child will be at index <code>2 * i + 1</code> and the right child will be at index <code>2 * i + 2</code>.  This means that the parent of the node at index <code>i</code> is at index <code>(i-1) // 2</code>.  This mapping of nodes to indices puts the root at index <code>0</code> and the rest of the nodes appear level by level from left-to-right, top-to-bottom.  Using this mapping, we say a <strong>list is heap-ordered</strong> if the corresponding binary tree is heap-ordered.  This is equivalent to saying that for all <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">i &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span>, the priority of the entry at index <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi></mrow><annotation encoding="application/x-tex">i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.65952em;vertical-align:0em;"></span><span class="mord mathit">i</span></span></span></span> is greater than or equal to the priority at index <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>i</mi><mo>&#x2212;</mo><mn>1</mn><mo>)</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">(i-1) // 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord">/</span><span class="mord">2</span></span></span></span>.</p>
<p>We will maintain the invariant that after each operation, the list of entries is heap-ordered.  To insert a new node, we append it to the list and then repeated swap it with its parent until it is heap-ordered.  This updating step will be called <code>_upheap</code> and is similar to the inner loop of an insertion sort.  However, unlike insertion sort, it only does at most <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> swap operations (each one reduces the index by half).</p>
<p>Similarly, there is a <code>_downheap</code> operation that will repeatedly swap an entry with its child until it&apos;s heap-ordered.  This operation is useful in the next section for building a heap from scratch.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">HeapPQ</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_upheap<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_parent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>

    <span class="token keyword">def</span> <span class="token function">_children</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        left <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span>
        right <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span>
        <span class="token keyword">return</span> <span class="token builtin">range</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span><span class="token punctuation">,</span> right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_upheap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        L <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries
        parent <span class="token operator">=</span> self<span class="token punctuation">.</span>_parent<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">and</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>parent<span class="token punctuation">]</span><span class="token punctuation">:</span>
            L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>parent<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>parent<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
            self<span class="token punctuation">.</span>_upheap<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">findmin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item

    <span class="token keyword">def</span> <span class="token function">removemin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        L <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries
        item <span class="token operator">=</span> L<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item
        L<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_downheap<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">_downheap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        L <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries
        children <span class="token operator">=</span> self<span class="token punctuation">.</span>_children<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> children<span class="token punctuation">:</span>
            child <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> L<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>child<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
                L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>child<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>child<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                self<span class="token punctuation">.</span>_downheap<span class="token punctuation">(</span>child<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="building-a-heap-from-scratch">Building a Heap from scratch</h2>

<p>Just using the public interface, one could easily construct a <code>HeapPQ</code> from a list of item-priority pairs.  For example, the following code would work just fine.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">pq <span class="token operator">=</span> HeapPQ<span class="token punctuation">(</span><span class="token punctuation">)</span>
pairs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> item<span class="token punctuation">,</span> priority <span class="token keyword">in</span> pairs<span class="token punctuation">:</span>
    pq<span class="token punctuation">.</span>insert<span class="token punctuation">(</span>item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span>
</pre><p>The <code>insert</code> method takes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time, so the total running time for this approach is <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.  <em>You should double check that you believe this claim despite the fact that for each insertion, there are fewer than <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">n</span></span></span></span> entries.</em></p>
<p>Perhaps surprisingly, we can construct the <code>HeapPQ</code> in linear time.  We call this <strong>heapifying a list</strong>.  We will exploit the <code>_downheap</code> method that we have already written.  The code is deceptively simple.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">_heapify</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_downheap<span class="token punctuation">(</span>n <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
</pre><p>Look at the difference between the <code>heapify</code> code above and the <code>_heapify_slower</code> code below.  The former works from the end and &quot;downheaps&quot; every entry and the latter starts at the beginning and &quot;upheaps&quot; every entry.  Both are correct, but one is faster.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">_heapify_slower</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_upheap<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
</pre><p>They may seem to be the same, but they are not.  To see why, we have to look a little closer at the running time of <code>_upheap</code> and <code>_downheap</code>.  Consider the tree perspective of the list.  For <code>_upheap</code>, the running time depends on the depth of the starting node.  For <code>_downheap</code>, the running time depends on the height of the subtree rooted at the starting node.  Looking at a complete binary tree, half of the nodes are leaves and so <code>_downheap</code> will take constant time and <code>_upheap</code> will take <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.  Thus, <code>_heapify_slower</code> will take at least <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mi>n</mi><mn>2</mn></mfrac><msub><mi>log</mi><mo>&#x2061;</mo><mn>2</mn></msub><mi>n</mi><mo>=</mo><mi>O</mi><mo>(</mo><mi>n</mi><mi>log</mi><mo>&#x2061;</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">\frac{n}{2}\log_2 n = O(n \log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.040392em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.695392em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.20696799999999996em;"><span style="top:-2.4558600000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.24414em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.</p>
<p>On the other hand, to analyze <code>_heapify</code>, we have to add up the heights of all the nodes in a complete binary tree.  Formally, this will be <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><msubsup><mo>&#x2211;</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mrow><msub><mi>log</mi><mo>&#x2061;</mo><mn>2</mn></msub><mi>n</mi></mrow></msubsup><mi>i</mi><mi mathvariant="normal">/</mi><msup><mn>2</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">n\sum_{i=1}^{\log_2 n}i/2^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.29388em;vertical-align:-0.27686399999999994em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">&#x2211;</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.017016em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2309080000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop mtight">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.19444571428571428em;"><span style="top:-2.2341314285714287em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.26586857142857145em;"><span></span></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.19516666666666668em;"></span><span class="mord mathit mtight">n</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">i</span><span class="mord">/</span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.824664em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span></span></span></span></span></span></span></span>.  There is a cute trick to bound this sum.  Simply observe that if from every node in the tree, we take a path that goes left on the first step and right for every step thereafter, no two paths will overlap.  This means that the the sum of the lengths of these paths (which is also to the sum of the heights) is at most the total number of edges, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>&#x2212;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathit">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">&#x2212;</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>.  Thus, <code>_heapify</code> runs in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>O</mi><mo>(</mo><mi>n</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">O(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathit" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathit">n</span><span class="mclose">)</span></span></span></span> time.</p>
<h2 class="mume-header" id="changing-priorities">Changing priorities</h2>

<p>There is another &quot;standard&quot; operation on priority queues.  It&apos;s called <code>reducepriority</code>.  It does what it says, reducing the priority of an entry.  This is very simple to implement in our current code if the index of the entry to change is known.  It would suffice to change the priority of the entry and call <code>_upheap</code> on that index.</p>
<p>However, the usual way to reduce the priority is to specify the item and its new priority.  This requires that we can find the index of an item.  We&apos;ll do this by storing a dictionary that maps items to indices.  We&apos;ll have to update this dictionary every time we rearrange the items.  To make sure this happens correctly, we will add a method for swapping entries and use this whenever we make a swap.</p>
<p>The full code including the <code>_heapify</code> method is given below.  This full version of the priority queue will be very useful for some graph algorithms that we will see soon.</p>
<div class="code-chunk" data-id="code-chunk-id-120" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=118, cmd continue=&quot;entry&quot;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">PriorityQueue</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> entries <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        entries <span class="token operator">=</span> entries <span class="token operator">or</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_entries <span class="token operator">=</span> <span class="token punctuation">[</span>Entry<span class="token punctuation">(</span>i<span class="token punctuation">,</span> p<span class="token punctuation">)</span> <span class="token keyword">for</span> i<span class="token punctuation">,</span> p <span class="token keyword">in</span> entries<span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>_itemmap <span class="token operator">=</span> <span class="token punctuation">{</span>i<span class="token punctuation">:</span> index <span class="token keyword">for</span> index<span class="token punctuation">,</span> <span class="token punctuation">(</span>i<span class="token punctuation">,</span>p<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>_heapify<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">insert</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        index <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_entries<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Entry<span class="token punctuation">(</span>item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_itemmap<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> index
        self<span class="token punctuation">.</span>_upheap<span class="token punctuation">(</span>index<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_parent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>

    <span class="token keyword">def</span> <span class="token function">_children</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        left<span class="token punctuation">,</span> right <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">2</span>
        <span class="token keyword">return</span> <span class="token builtin">range</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> <span class="token builtin">min</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span><span class="token punctuation">,</span> right <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_swap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
        L <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries
        va <span class="token operator">=</span> L<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span>item
        vb <span class="token operator">=</span> L<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">.</span>item
        self<span class="token punctuation">.</span>_itemmap<span class="token punctuation">[</span>va<span class="token punctuation">]</span> <span class="token operator">=</span> b
        self<span class="token punctuation">.</span>_itemmap<span class="token punctuation">[</span>vb<span class="token punctuation">]</span> <span class="token operator">=</span> a
        L<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> L<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">,</span> L<span class="token punctuation">[</span>a<span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">_upheap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        L <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries
        parent <span class="token operator">=</span> self<span class="token punctuation">.</span>_parent<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">and</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>parent<span class="token punctuation">]</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_swap<span class="token punctuation">(</span>i<span class="token punctuation">,</span>parent<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_upheap<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">reducepriority</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> priority<span class="token punctuation">)</span><span class="token punctuation">:</span>
        i <span class="token operator">=</span> self<span class="token punctuation">.</span>_itemmap<span class="token punctuation">[</span>item<span class="token punctuation">]</span>
        entry <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        entry<span class="token punctuation">.</span>priority <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>priority<span class="token punctuation">,</span> priority<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_upheap<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">findmin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_entries<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item

    <span class="token keyword">def</span> <span class="token function">removemin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        L <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries
        item <span class="token operator">=</span> L<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>item
        self<span class="token punctuation">.</span>_swap<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>L<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">del</span> self<span class="token punctuation">.</span>_itemmap<span class="token punctuation">[</span>item<span class="token punctuation">]</span>
        L<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_downheap<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item

    <span class="token keyword">def</span> <span class="token function">_downheap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        L <span class="token operator">=</span> self<span class="token punctuation">.</span>_entries
        children <span class="token operator">=</span> self<span class="token punctuation">.</span>_children<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> children<span class="token punctuation">:</span>
            child <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> L<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> L<span class="token punctuation">[</span>child<span class="token punctuation">]</span> <span class="token operator">&lt;</span> L<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>_swap<span class="token punctuation">(</span>i<span class="token punctuation">,</span> child<span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>_downheap<span class="token punctuation">(</span>child<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_heapify</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_entries<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_downheap<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p style="page-break-after:always;"></p>
    <a name="chapter_19" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 19
    </p>
    <hr>
<h1 class="mume-header" id="graphs">Graphs</h1>

<p>The <strong>graph</strong> is a fundamental mathematical object in computer science.  Graphs are used to abstract networks, maps, program control flow, probabilistic models, and even data structures among many other computer science concepts.</p>
<p>A good mental model to start with is a road map of a country.  There are cities and roads connecting those cities.  Graphs are ideal for describing such situations where there are items and connections between them.</p>
<p>Formally, a graph is a pair <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>V</mi><mo separator="true">,</mo><mi>E</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(V, E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span> is any set and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span> is a set of pairs of elements of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span>.  We call <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span> the <strong>vertex set</strong> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span> the <strong>edge set</strong>.  Just using the definition of a graph and the standard python collections, we could store a graph as follows.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">G <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</pre><p>The graph <code>G</code> has 4 vertices and 3 edges.  Such a graph is often depicted 4 labeled circles for vertices and lines between them depicting the edges.  Because tuples are ordered, we would add arrowheads.  This indicates a <strong>directed graph</strong> or <strong>digraph</strong>.  If the ordering of the vertices in an edge does not matter, we have an <strong>undirected graph</strong>.  There will be no major difference between an undirected graph and a digraph that has a matched pair <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>v</mi><mo separator="true">,</mo><mi>u</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(v,u)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit">u</span><span class="mclose">)</span></span></span></span> for every <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">(u,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span> in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span>.</p>
<p>Usually, we will disallow <strong>self-loops</strong>, edges that start and end at the same vertex, and <strong>multiple edges</strong> between the same pair of vertices.  Graphs without self-loops and multiple edges are called <strong>simple graphs</strong>.</p>
<p>If two vertices are connected by an edge, we say they are <strong>adjacent</strong>.
We all call such vertices <strong>neighbors</strong>.
For an edge <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>e</mi><mo>=</mo><mo>(</mo><mi>u</mi><mo separator="true">,</mo><mi>v</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">e = (u,v)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">e</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit">u</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="mclose">)</span></span></span></span>, we say that the vertices <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> are <strong>incident</strong> to the edge <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">e</span></span></span></span>.  The <strong>degree of a vertex</strong> is the number of neighbors it has.  For digraphs, we distinguish between <strong>in-degree</strong> and <strong>out-degree</strong>, the number of in-neighbors and out-neighbors respectively.</p>
<h2 class="mume-header" id="a-graph-adt">A Graph ADT</h2>

<p>First, let&apos;s establish the minimal ADT for a simple, directed graph.
We should be able to use any (hashable) type for the vertices.
We want to be able to create the graph from a collection of vertices and a collection of ordered pairs of vertices.</p>
<ul>
<li><code>__init__(V, E)</code> : Initialize a new graph with vertex set <code>V</code> and edge set <code>E</code>.</li>
<li><code>vertices()</code> : Return an iterable collection of the vertices.</li>
<li><code>edges()</code> : Return an iterable collection of the edges.</li>
<li><code>addvertex(v)</code> : Add a new vertex to the graph.  The new vertex is identified with the <code>v</code> object.</li>
<li><code>addedge(u, v)</code> : Add a new edge to the graph between the vertices with keys <code>u</code> and <code>v</code>.</li>
<li><code>nbrs(v)</code> : Return an iterable collection of the (out)neighbors of <code>v</code>, i.e. those vertices <code>w</code> such that <code>(v, w)</code> is an edge.  (For directed graphs, this is the collection of out-neighbors.)</li>
</ul>
<p>There are several error conditions to consider. For example, what happens if a vertex is added more than once?
What happens if an edge <code>(u,v)</code> is added, but <code>u</code> is not a vertex in the graph?
What if one calls <code>nbrs(v)</code> and <code>v</code> is not a vertex in the graph?
We will deal with these later.
For now, let&apos;s get something working.</p>
<h2 class="mume-header" id="the-edgesetgraph-implementation">The <code>EdgeSetGraph</code> Implementation</h2>

<p>Cleverness comes second.
First, let&apos;s write a Graph class that is as close as possible to the mathematical definition of a graph.
It will store a set for the vertices and a set of pairs (2-tuples) for the edges.
To get the neighbors of a vertex, it will iterate over all edges in the graph.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">EdgeSetGraph</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> V<span class="token punctuation">,</span> E<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_V <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_E <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> v <span class="token keyword">in</span> V<span class="token punctuation">:</span> self<span class="token punctuation">.</span>addvertex<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
        <span class="token keyword">for</span> u<span class="token punctuation">,</span>v <span class="token keyword">in</span> E<span class="token punctuation">:</span> self<span class="token punctuation">.</span>addedge<span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">vertices</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_V<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">edges</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_E<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addvertex</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_V<span class="token punctuation">.</span>add<span class="token punctuation">(</span>v<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addedge</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_E<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">nbrs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>w <span class="token keyword">for</span> u<span class="token punctuation">,</span>w <span class="token keyword">in</span> self<span class="token punctuation">.</span>_E <span class="token keyword">if</span> u <span class="token operator">==</span> v<span class="token punctuation">)</span>
</pre><p>To make an undirected version of this class, we can simply modify the <code>addedge</code> method to add an edge in each direction.
We also change the <code>nbrs</code> method to work with unordered pairs (sets).</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">class</span> <span class="token class-name">UndirectedEdgeSetGraph</span><span class="token punctuation">(</span>EdgeSetGraph<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">addedge</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_E<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_E<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span>u<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">edges</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        edgeset <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> u<span class="token punctuation">,</span>v <span class="token keyword">in</span> self<span class="token punctuation">.</span>_E<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">,</span>u<span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token keyword">in</span> edgeset<span class="token punctuation">:</span>
                edgeset<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>edgeset<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="the-adjacencysetgraph-implementation">The <code>AdjacencySetGraph</code> Implementation</h2>

<p>The major problem with previous implementation is that it&apos;s very slow to enumerate the neighbors of a vertex.
It should not be necessary to go through all the edges, just to find the ones incident to a given vertex.</p>
<p>An alternative approach is to store a set with each vertex and have this set contain all the neighbors of that vertex.  This allows for fast access to the neighbors.  In fact, it means that we don&apos;t have to store the edges explicitly at all.</p>
<div class="code-chunk" data-id="adjacencysetgraph" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {cmd, id=&apos;adjacencysetgraph&apos;}" class="language-python"><span class="token keyword">class</span> <span class="token class-name">AdjacencySetGraph</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> V<span class="token punctuation">,</span> E<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_V <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_nbrs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> v <span class="token keyword">in</span> V<span class="token punctuation">:</span> self<span class="token punctuation">.</span>addvertex<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
        <span class="token keyword">for</span> u<span class="token punctuation">,</span>v <span class="token keyword">in</span> E<span class="token punctuation">:</span> self<span class="token punctuation">.</span>addedge<span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">vertices</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_V<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">edges</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> u <span class="token keyword">in</span> self<span class="token punctuation">.</span>_V<span class="token punctuation">:</span>
            <span class="token keyword">for</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">yield</span> <span class="token punctuation">(</span>u<span class="token punctuation">,</span>v<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addvertex</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_V<span class="token punctuation">.</span>add<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>_nbrs<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">addedge</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>_nbrs<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">.</span>add<span class="token punctuation">(</span>v<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">nbrs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_nbrs<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><div class="code-chunk" data-id="code-chunk-id-122" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=119, cmd continue=&quot;adjacencysetgraph&quot;}" class="language-python">G <span class="token operator">=</span> AdjacencySetGraph<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;neighbors of 1:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>G<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;neighbors of 2:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>G<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;neighbors of 3:&quot;</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>G<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">neighbors of 1: [2, 3]
neighbors of 2: [1]
neighbors of 3: []
</pre></div></div><p>Let&apos;s do a very simple example to make sure it works as we expect it to.</p>
<p>One design decision that may seem rather strange is that we do not have a class for vertices or edges.
As of now, we are exploiting the <strong>polymorphism</strong> of python, which allows us to use any (hashable) type for the vertex set.
Recall that polymorphism (in this context) is the ability to call the same function on different types of objects.
This can be very convenient as it allows one to put a graph structure on top of any set.</p>
<p>As written, there is no clear reason to use a set for the neighbors rather than a list.
One case where the set is better is if we want to test if the graph contains a particular edge.  With the <code>AdjacencySetGraph</code> above, this method could be implemented as follows.</p>
<pre data-role="codeBlock" data-info="python" class="language-python">    <span class="token keyword">def</span> <span class="token function">hasedge</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> v <span class="token keyword">in</span> self<span class="token punctuation">.</span>_nbrs<span class="token punctuation">[</span>u<span class="token punctuation">]</span>
</pre><p>If <code>self._nbrs[u]</code> were a list, the method could take time linear in the degree of <code>u</code>.</p>
<h2 class="mume-header" id="paths-and-connectivity">Paths and Connectivity</h2>

<p>A <strong>path</strong> in a graph <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi><mo>=</mo><mo>(</mo><mi>V</mi><mo separator="true">,</mo><mi>E</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">G = (V,E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">G</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span> is a sequence of vertices connected by edges.
That is, a nonempty sequence of vertices <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><msub><mi>v</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>v</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>&#x2026;</mo><mo separator="true">,</mo><msub><mi>v</mi><mi>k</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">(v_0, v_1,\ldots, v_k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">&#x2026;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> is a path from <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">v_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>v</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">v_k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> as long as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><msub><mi>v</mi><mrow><mi>i</mi><mo>&#x2212;</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>v</mi><mi>i</mi></msub><mo>)</mo><mo>&#x2208;</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">(v_{i-1}, v_i)\in E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.311664em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mbin mtight">&#x2212;</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span></span><span class="vlist-s">&#x200B;</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2208;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span></span></span></span> for all <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>i</mi><mo>&#x2208;</mo><mo>{</mo><mn>1</mn><mo separator="true">,</mo><mo>&#x2026;</mo><mo separator="true">,</mo><mi>k</mi><mo>}</mo></mrow><annotation encoding="application/x-tex">i \in \{1,\ldots, k\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69862em;vertical-align:-0.0391em;"></span><span class="mord mathit">i</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">&#x2208;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="minner">&#x2026;</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.03148em;">k</span><span class="mclose">}</span></span></span></span>.
We say a <strong>path is simple</strong> if it does not repeat any vertices.
The <strong>length of a path</strong> is the number of edges.
A single vertex can be seen as a path of length zero.</p>
<p>A <strong>cycle</strong> is a path of length at least one that starts and ends at the same vertex.
The <strong>length of a cycle</strong> is the number of edges.
A <strong>cycle is simple</strong> if is is a cycle and removing the last edge results in a simple path, i.e., there are no repeated vertices until the last one.</p>
<p>To solidify these definitions, we could write a couple methods to check them.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">ispath</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">&quot;&quot;&quot;Return True if and only if the vertices V form a path in G.&quot;&quot;&quot;</span>
  <span class="token keyword">return</span> V <span class="token operator">and</span> <span class="token builtin">all</span><span class="token punctuation">(</span>G<span class="token punctuation">.</span>hasedge<span class="token punctuation">(</span>V<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> V<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">issimplepath</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">&quot;&quot;&quot;Return True if and only if the vertices V form a simple path in G.&quot;&quot;&quot;</span>
  <span class="token keyword">return</span> ispath<span class="token punctuation">(</span>G<span class="token punctuation">,</span> V<span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>V<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">iscycle</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Return True if and only if the vertices V form a cycle in G.&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> ispath<span class="token punctuation">(</span>G<span class="token punctuation">,</span> V<span class="token punctuation">)</span> <span class="token operator">and</span> V<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> V<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">issimplecycle</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">&quot;&quot;&quot;Return True if and only if the vertices V form a simple cycle in G.&quot;&quot;&quot;</span>
    <span class="token keyword">return</span> iscycle<span class="token punctuation">(</span>G<span class="token punctuation">,</span>V<span class="token punctuation">)</span> <span class="token operator">and</span> issimplepath<span class="token punctuation">(</span>G<span class="token punctuation">,</span> V<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</pre><p>We say that <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span> is <strong>connected</strong> to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> if there exists a path that starts at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span> and ends at <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span>.
For an undirected graph, if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span> is connected to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span>, then <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> is connected to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span>.
In such graphs, we can partition the vertices into subsets called <strong>connected components</strong> that are all pairwise connected.</p>
<p>For a directed graph, two vertices <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> are <strong>strongly connected</strong> if <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span> is connected to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> <em>and also</em> <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> is connected to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit">u</span></span></span></span>.</p>
<p>Let&apos;s consider a simple method to test of two vertices are connected.
We will add it to our <code>AdjacencySetGraph</code> class.  As a first exercise, we could try to work recursively.  The idea is simple: in the base case, see if you are trying to get from a vertex to itself.  Otherwise, it suffices to check if any of the neighbors of the first vertex are connected to the last vertex.</p>
<div class="code-chunk" data-id="connected1" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=120, cmd continue=&quot;adjacencysetgraph&quot;, id=&quot;connected1&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">connected</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> a <span class="token operator">==</span> b<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>connected<span class="token punctuation">(</span>nbr<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token keyword">for</span> nbr <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Can you guess what will go wrong?
Here&apos;s an example.</p>
<div class="code-chunk" data-id="code-chunk-id-124" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=121, cmd continue=&apos;connected1&apos;}" class="language-python">G <span class="token operator">=</span> AdjacencySetGraph<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>G<span class="token punctuation">.</span>connected<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>G<span class="token punctuation">.</span>connected<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token operator">not</span> G<span class="token punctuation">.</span>connected<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;First graph is okay.&quot;</span><span class="token punctuation">)</span>

H <span class="token operator">=</span> AdjacencySetGraph<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    H<span class="token punctuation">.</span>connected<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> RecursionError<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;There was too much recursion!&quot;</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">First graph is okay.
There was too much recursion!
</pre></div></div><p>It&apos;s clear that if the graph has any cycles, we can&apos;t check connectivity this way.  To deal with cycles, we can keep a set of visited vertices.  Recall that this is called memoization.</p>
<div class="code-chunk" data-id="connected2" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=122, cmd continue=&quot;adjacencysetgraph&quot;, id=&quot;connected2&quot;}" class="language-python">    <span class="token keyword">def</span> <span class="token function">connected</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>_connected<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_connected</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> visited<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> a <span class="token keyword">in</span> visited<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">if</span> a <span class="token operator">==</span> b<span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token boolean">True</span>
        visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">any</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>_connected<span class="token punctuation">(</span>nbr<span class="token punctuation">,</span> b<span class="token punctuation">,</span> visited<span class="token punctuation">)</span> <span class="token keyword">for</span> nbr <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"></div></div><p>Now, we can try again and see what happens.</p>
<div class="code-chunk" data-id="code-chunk-id-126" data-cmd="python"><div class="input-div"><pre data-role="codeBlock" data-info="python {code_chunk_offset=123, cmd continue=&apos;connected2&apos;}" class="language-python">H <span class="token operator">=</span> AdjacencySetGraph<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>H<span class="token punctuation">.</span>connected<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span>H<span class="token punctuation">.</span>connected<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> RecursionError<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;There was too much recursion!&apos;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&apos;It works now!&apos;</span><span class="token punctuation">)</span>
</pre><div class="btn-group"><div class="run-btn btn"><span>&#x25B6;&#xFE0E;</span></div><div class="run-all-btn btn">all</div></div><div class="status">running...</div></div><div class="output-div"><pre class="language-text">It works now!
</pre></div></div><p style="page-break-after:always;"></p>
    <a name="chapter_20" href=""></a>
    <p style="font-size:80pt;color:#d0d0d0;font-weight:bold">
    Chapter 20
    </p>
    <hr>
<h1 class="mume-header" id="graph-search">Graph Search</h1>

<p>Now that we have a vocabulary for dealing with graphs, we can revisit some previous topics.
For example, a tree can now be viewed as a graph with edges directed from parents to children.
Given a graph that represents a rooted tree, we could rewrite our preorder traversal using the Graph ADT.
Let&apos;s say we just want to print all the vertices.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">printall</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> G<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        printall<span class="token punctuation">(</span>G<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
</pre><p>This is fine for a tree, but it quickly gets very bad as soon as there is a cycle.
In that case, there is nothing in the code to keep us from going around and around the cycle.
We can take the same approach as Hansel and Gretel: we&apos;re going to leave bread crumbs to see where we&apos;ve been.
The easiest way to do this is to just keep around a set that stores the vertices that have been already visited in the search.
Thus, our <code>printall</code> method becomes the following.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">printall</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> v<span class="token punctuation">,</span> visited<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> G<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> n <span class="token operator">not</span> <span class="token keyword">in</span> visited<span class="token punctuation">:</span>
            visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
            printall<span class="token punctuation">(</span>G<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
</pre><p>This is the most direct generalization of a recursive tree traversal into something that also traverses the vertices of a graph.
Unlike with (rooted) trees, we have to specify the starting vertex, because there is no specially marked &quot;root&quot; vertex in a graph.
Also, this code will not necessarily print all the vertices in a graph.
In this case, it will only print those vertices that are connected to the starting vertex.
This pattern can be made to work more generally.</p>
<h2 class="mume-header" id="depth-first-search">Depth-First Search</h2>

<p>A <strong>depth-first search</strong> (or <strong>DFS</strong>) of a graph <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi></mrow><annotation encoding="application/x-tex">G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">G</span></span></span></span> starting from a vertex <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span> will visit all the vertices connected to <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.03588em;">v</span></span></span></span>.
It will always prioritize moving &quot;outward&quot; in the direction of new vertices, backtracking as little as possible.
The <code>printall</code> method above prints the vertices in a <strong>depth-first order</strong>.
Below is the general form of this algorithm.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    visited <span class="token operator">=</span> <span class="token punctuation">{</span>v<span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>_dfs<span class="token punctuation">(</span>v<span class="token punctuation">,</span> visited<span class="token punctuation">)</span>
    <span class="token keyword">return</span> visited

<span class="token keyword">def</span> <span class="token function">_dfs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">,</span> visited<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> n <span class="token operator">not</span> <span class="token keyword">in</span> visited<span class="token punctuation">:</span>
            visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span>n<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_dfs<span class="token punctuation">(</span>n<span class="token punctuation">,</span> visited<span class="token punctuation">)</span>
</pre><p>With this code, it will be easy to check if two vertices are connected.
For example, one could write the following.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">connected</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> v <span class="token keyword">in</span> G<span class="token punctuation">.</span>dfs<span class="token punctuation">(</span>u<span class="token punctuation">)</span>
</pre><p>It&apos;s possible to modify our <code>dfs</code> code to provide not only the set of connected vertices, but also the paths used in the search.
The idea is to store a dictionary that maps vertices to the previous vertex in the path from the starting vertex.
This is really encoding a tree as a dictionary that maps nodes to their parent.
The root is the starting vertex.</p>
<p>It differs from the trees we&apos;ve seen previously in that it naturally goes up the tree from the leaves to the root rather than the reverse.
The resulting tree is called the <strong>depth-first search tree</strong>.
It requires only a small change to generate it.
We use the convention that the starting vertex maps to <code>None</code>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tree <span class="token operator">=</span> <span class="token punctuation">{</span>v<span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span>
    self<span class="token punctuation">.</span>_dfs<span class="token punctuation">(</span>v<span class="token punctuation">,</span> tree<span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree

<span class="token keyword">def</span> <span class="token function">_dfs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">,</span> tree<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> n <span class="token operator">not</span> <span class="token keyword">in</span> tree<span class="token punctuation">:</span>
            tree<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> v
            self<span class="token punctuation">.</span>_dfs<span class="token punctuation">(</span>n<span class="token punctuation">,</span> tree<span class="token punctuation">)</span>
</pre><h2 class="mume-header" id="removing-the-recursion">Removing the Recursion</h2>

<p>The <code>dfs</code> code above uses recursion to keep track of previous vertices, so that we can backtrack (by <code>return</code>ing) when we reach a vertex from which we can&apos;t move forward.
To remove the recursion, we replace the function call stack with our own stack.</p>
<p>This is not just an academic exercise.
By removing the recursion, we will reveal the structure of the algorithm in a way that will allow us to generalize it to other algorithms.
Here&apos;s the code.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tree <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    tovisit <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">while</span> tovisit<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span>b <span class="token operator">=</span> tovisit<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> b <span class="token operator">not</span> <span class="token keyword">in</span> tree<span class="token punctuation">:</span>
            tree<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> a
            <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tovisit<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree
</pre><h2 class="mume-header" id="breadth-first-search">Breadth-First Search</h2>

<p>We get another important traversal by replacing the stack with a queue.
In this case, the search prioritizes breadth over depth, resulting in a <strong>breadth-first search</strong> of <strong>BFS</strong>.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">bfs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tree <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    tovisit <span class="token operator">=</span> Queue<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> tovisit<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span>b <span class="token operator">=</span> tovisit<span class="token punctuation">.</span>dequeue<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> b <span class="token operator">not</span> <span class="token keyword">in</span> tree<span class="token punctuation">:</span>
            tree<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> a
            <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tovisit<span class="token punctuation">.</span>enqueue<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree
</pre><p>A wonderful property of breadth-first search is that the paths encoded in the resulting <strong>breadth-first search tree</strong> are the shortest paths from each vertex to the starting vertex.
Thus, BFS can be used to find the shortest path connecting pairs of vertices in a graph.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">distance</span><span class="token punctuation">(</span>G<span class="token punctuation">,</span> u<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tree <span class="token operator">=</span> G<span class="token punctuation">.</span>bfs<span class="token punctuation">(</span>u<span class="token punctuation">)</span>
    <span class="token keyword">if</span> v <span class="token operator">not</span> <span class="token keyword">in</span> tree<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">&apos;inf&apos;</span><span class="token punctuation">)</span>
    edgecount <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> v <span class="token keyword">is</span> <span class="token operator">not</span> u<span class="token punctuation">:</span>
        edgecount <span class="token operator">+=</span> <span class="token number">1</span>
        v <span class="token operator">=</span> tree<span class="token punctuation">[</span>v<span class="token punctuation">]</span>
    <span class="token keyword">return</span> edgecount
</pre><h2 class="mume-header" id="weighted-graphs-and-shortest-paths">Weighted Graphs and Shortest Paths</h2>

<p>In the <strong>single source, all shortest paths problem</strong>, the goal is to find the shortest path from every vertex to a given source vertex.
If the edges are assumed to have the same length, then BFS solves this problem.
However, it is common to consider <strong>weighted graphs</strong> in which a (positive) real number called the <strong>weight</strong> is assigned to each edge.
We will augment our graph ADT to support a function <code>wt(u,v)</code> that returns the weight of an edge.
Then, the weight of a path is the sum of the weights of the edges on that path.
Now, simple examples make it clear that the shortest path may not be what we get from the BFS tree.</p>
<p>One nice algorithm for the single source, all shortest paths problem on weighted graphs is called Dijkstra&apos;s algorithm.
It looks a lot like DFS and BFS except now, the stack or queue is replaced by a priority queue.
The vertices will be visited in order of their distance to the source.
These distances will be used as the priorities in the priority queue.</p>
<p>We&apos;ll see two different implementations.
The first, although less efficient is very close to DFS and BFS.
Recall that in those algorithms, we visit the vertices, recording the edges used in a dictionary and adding all the neighboring vertices to a stack or a queue to be traversed later.
We&apos;ll do the same here except that we&apos;ll use a priority queue to store the edges to be searched.
We&apos;ll also keep a dictionary of the distances from the start vertex that will be updated when we visit a vertex.
The priority for an edge <code>(u,v)</code> will be the distance to <code>u</code> plus the weight of <code>(u,v)</code>.
So, if we use this edge, the shortest path to <code>v</code> will go through <code>u</code>.
In this way, the tree will encode all the shortest paths from the start vertex.
Thus, the result will be not only the lengths of all the paths, but also an efficient encoding of the paths themselves.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">dijkstra</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tree <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    D <span class="token operator">=</span> <span class="token punctuation">{</span>v<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
    tovisit <span class="token operator">=</span> PriorityQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    tovisit<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> tovisit<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span>b <span class="token operator">=</span> tovisit<span class="token punctuation">.</span>removemin<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> b <span class="token operator">not</span> <span class="token keyword">in</span> tree<span class="token punctuation">:</span>
            tree<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> a
            <span class="token keyword">if</span> a <span class="token keyword">is</span> <span class="token operator">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                D<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> D<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>wt<span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">)</span>
            <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tovisit<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> D<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>wt<span class="token punctuation">(</span>b<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree<span class="token punctuation">,</span> D
</pre><h2 class="mume-header" id="prims-algorithm-for-minimum-spanning-trees">Prim&apos;s Algorithm for Minimum Spanning Trees</h2>

<p>Recall that a subgraph of an undirected graph <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>G</mi><mo>=</mo><mo>(</mo><mi>V</mi><mo separator="true">,</mo><mi>E</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">G = (V,E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">G</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathit" style="margin-right:0.22222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathit" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span> is a <strong>spanning tree</strong> if it is a tree with vertex set <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>V</mi></mrow><annotation encoding="application/x-tex">V</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.22222em;">V</span></span></span></span>.
For a weighted graph, the weight of a spanning tree is the sum of the weights of its edges.
The <strong>Minimum Spanning Tree</strong> (<strong>MST</strong>) Problem is to find <em>a</em> spanning tree of an input graph with minimum weight.
The problem comes up naturally in many contexts.</p>
<p>To find an algorithm for this problem, we start by trying to describe which edges should appear in the minimum spanning tree.
That is, we should think about the object we want to construct first, and only then can we think about <em>how</em> to construct it.
We employed a similar strategy when discussing sorting algorithms.
In that case, we first tried to write a function that would test for correct output.
We won&apos;t go that far now, but we will ask, &quot;How would we know if we had the minimum spanning tree?&quot;</p>
<p>One thing that would certainly be true about the minimum spanning tree is that if we removed an edge (resulting in two trees), we couldn&apos;t find a lighter weight edge connecting these two trees.
Otehrwise, that would be a spanning tree of lower weight.</p>
<p>Something even a little more general is true.
If we split the vertices into any two sets <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">A</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span>, the lowest weight edge with one end in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">A</span></span></span></span> and the other end in <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span> must be in the MST.
Suppose for contradiction that this edge is not in the MST.
Then, we could add that edge and form a cycle, which would have another edge spanning <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit">A</span></span></span></span> and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>B</mi></mrow><annotation encoding="application/x-tex">B</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathit" style="margin-right:0.05017em;">B</span></span></span></span>.
That edge could then be removed, leaving us with a lighter spanning tree.
This is a contradiction, because we assumed that we started with the MST.</p>
<p>So, in light of our previous graph algorithms, we can try to always add the lightest edge from the visited vertices to an unvisited vertex.
This can easily be encoded in a priority queue.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">prim</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tree <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    tovisit <span class="token operator">=</span> PriorityQueue<span class="token punctuation">(</span><span class="token punctuation">)</span>
    tovisit<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> tovisit<span class="token punctuation">:</span>
        a<span class="token punctuation">,</span>b <span class="token operator">=</span> tovisit<span class="token punctuation">.</span>removemin<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> b <span class="token operator">not</span> <span class="token keyword">in</span> tree<span class="token punctuation">:</span>
            tree<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> a
            <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">:</span>
                tovisit<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>wt<span class="token punctuation">(</span>b<span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree
</pre><h2 class="mume-header" id="an-optimization-for-priority-first-search">An optimization for Priority-First search</h2>

<p>The implementation above, although correct, is not technically Dijkstra&apos;s Algorithm, but it&apos;s close.
By trying to improve its asymptotic running time, we&apos;ll get to the real Dijkstra&apos;s Algorithm.
When thinking about how to improve an algorithm, an easy first place to look is for wasted work.
In this case, we can see that many edges added to the priority queue are later removed without being used, because they lead to a vertex that has already been visited (by a shorter path).</p>
<p>It would be better to not have to these edges in the priority queue, but we don&apos;t know when we first see an edge whether or not a later edge will provide a short cut.
We can avoid adding a new entry to the priority and instead modify the existing entry that is no longer valid.</p>
<p>The idea is to store vertices rather than edges in the priority queue.
Then, we&apos;ll use the <code>reducepriority</code> method to update an entry when we find a new shorter path to a given vertex.
Although we won&apos;t know the distances at first, we&apos;ll store the shortest distance we&apos;ve seen so far.
If we find a shortcut to a given vertex, we will reduce it&apos;s priority and update the priority queue.
Updating after finding a shortcut is called <strong>edge relaxation</strong>.
It works as follows.
The distances to the source are stored in a dictionary <code>D</code> that maps vertices to the distance, based on what we&apos;ve searched so far.
If we find that <code>D[n] &gt; D[u] + G.wt(u,n)</code>, then it would be a shorter path to <code>n</code> if we just took the shortest path from the source to <code>u</code> and appended the edge <code>(u,n)</code>.  In that case, we set <code>D[n] = D[u] + G.wt(u,n)</code> and update the priority queue.
<em>Note that we had this algorithm in mind when we added <code>reducepriority</code> to our Priority Queue ADT.</em></p>
<p>Here&apos;s the code.</p>
<pre data-role="codeBlock" data-info="python" class="language-python"><span class="token keyword">def</span> <span class="token function">dijkstra2</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tree <span class="token operator">=</span> <span class="token punctuation">{</span>v<span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">}</span>
    D <span class="token operator">=</span> <span class="token punctuation">{</span>u<span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token string">&apos;inf&apos;</span><span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> self<span class="token punctuation">.</span>vertices<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
    D<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    tovisit <span class="token operator">=</span> PriorityQueue<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> D<span class="token punctuation">[</span>u<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> u <span class="token keyword">in</span> self<span class="token punctuation">.</span>vertices<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> tovisit<span class="token punctuation">:</span>
        u <span class="token operator">=</span> tovisit<span class="token punctuation">.</span>removemin<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> n <span class="token keyword">in</span> self<span class="token punctuation">.</span>nbrs<span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> D<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>wt<span class="token punctuation">(</span>u<span class="token punctuation">,</span>n<span class="token punctuation">)</span> <span class="token operator">&lt;</span> D<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">:</span>
                D<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> D<span class="token punctuation">[</span>u<span class="token punctuation">]</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>wt<span class="token punctuation">(</span>u<span class="token punctuation">,</span>n<span class="token punctuation">)</span>
                tree<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> u
                tovisit<span class="token punctuation">.</span>reducepriority<span class="token punctuation">(</span>n<span class="token punctuation">,</span> D<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree<span class="token punctuation">,</span> D
</pre><p>An important difference with our DFS/BFS code is that the main data structure now stores vertices, not edges.
Also, we don&apos;t have to check if we&apos;ve already visited a vertex, because if we have already visited it, we won&apos;t find an edge to relax (vertices are visited in order of their distance to the source).</p>

      </div>
      <div class="md-sidebar-toc"><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#basic-python">Basic Python</a>
<ul>
<li><a href="#sequence-selection-and-iteration">Sequence, Selection, and Iteration</a></li>
<li><a href="#expressions-and-evaluation">Expressions and Evaluation</a></li>
<li><a href="#variables-types-and-state">Variables, Types,  and State</a></li>
<li><a href="#collections">Collections</a>
<ul>
<li><a href="#strings-str">Strings  (<code>str</code>)</a></li>
<li><a href="#lists-list">Lists (<code>list</code>)</a></li>
<li><a href="#tuples-tuple">Tuples (<code>tuple</code>)</a></li>
<li><a href="#dictionaries-dict">Dictionaries (<code>dict</code>)</a></li>
<li><a href="#sets-set">Sets (<code>set</code>)</a></li>
</ul>
</li>
<li><a href="#some-common-things-to-do-with-collections">Some common things to do with collections</a></li>
<li><a href="#iterating-over-a-collection">Iterating over a collection</a></li>
<li><a href="#other-forms-of-control-flow">Other Forms of Control Flow</a></li>
<li><a href="#modules-and-imports">Modules and Imports</a></li>
</ul>
</li>
<li><a href="#object-oriented-programming">Object-Oriented Programming</a>
<ul>
<li><a href="#a-simple-example">A simple example</a></li>
<li><a href="#encapsulation-and-the-public-interface-of-a-class">Encapsulation and the Public Interface of a Class</a></li>
<li><a href="#inheritance-and-is-a-relationships">Inheritance and &quot;is a&quot; relationships</a></li>
<li><a href="#duck-typing">Duck Typing</a></li>
<li><a href="#composition-and-has-a-relationships">Composition and &quot;has a&quot; relationships</a></li>
</ul>
</li>
<li><a href="#testing">Testing</a>
<ul>
<li><a href="#writing-tests">Writing Tests</a></li>
<li><a href="#unit-testing-with-unittest">Unit Testing with <code>unittest</code></a></li>
<li><a href="#test-driven-development">Test-Driven Development</a></li>
<li><a href="#what-to-test">What to Test</a></li>
<li><a href="#testing-and-object-oriented-design">Testing and Object-Oriented Design</a></li>
</ul>
</li>
<li><a href="#running-time-analysis">Running Time Analysis</a>
<ul>
<li><a href="#timing-programs">Timing Programs</a></li>
<li><a href="#example-adding-the-first-k-numbers">Example: Adding the first k numbers.</a></li>
<li><a href="#modeling-the-running-time-of-a-program">Modeling the Running Time of a Program</a>
<ul>
<li><a href="#list-operations">List Operations</a></li>
<li><a href="#dictionary-operations">Dictionary Operations</a></li>
<li><a href="#set-operations">Set Operations</a></li>
</ul>
</li>
<li><a href="#asymptotic-analysis-and-the-order-of-growth">Asymptotic Analysis and the Order of Growth</a></li>
<li><a href="#focus-on-the-worst-case">Focus on the Worst Case</a></li>
<li><a href="#big-o">Big-O</a></li>
<li><a href="#the-most-important-features-of-big-o-usage">The most important features of big-O usage</a></li>
</ul>
</li>
<li><a href="#practical-use-of-the-big-o-and-common-functions">Practical Use of the Big-O and Common Functions</a>
<ul>
<li><a href="#bases-for-logarithms">Bases for Logarithms</a></li>
</ul>
</li>
<li><a href="#practice-examples">Practice examples</a></li>
<li><a href="#stacks-and-queues">Stacks and Queues</a>
<ul>
<li><a href="#abstract-data-types">Abstract Data Types</a></li>
<li><a href="#the-stack-adt">The Stack ADT</a></li>
<li><a href="#the-queue-adt">The Queue ADT</a></li>
<li><a href="#dealing-with-errors">Dealing with errors</a></li>
</ul>
</li>
<li><a href="#deques-and-linked-lists">Deques and Linked Lists</a>
<ul>
<li><a href="#the-deque-adt">The Deque ADT</a></li>
<li><a href="#linked-lists">Linked Lists</a></li>
<li><a href="#implementing-a-queue-with-a-linkedlist">Implementing a Queue with a LinkedList</a></li>
<li><a href="#storing-the-length">Storing the length</a></li>
<li><a href="#testing-against-the-adt">Testing Against the ADT</a></li>
<li><a href="#the-main-lessons">The Main Lessons:</a></li>
<li><a href="#design-patterns-the-wrapper-pattern">Design Patterns:  The Wrapper Pattern</a></li>
<li><a href="#the-main-lessons-1">The Main Lessons:</a></li>
</ul>
</li>
<li><a href="#doubly-linked-lists">Doubly-Linked Lists</a>
<ul>
<li><a href="#concatenating-doubly-linked-lists">Concatenating Doubly Linked Lists</a></li>
</ul>
</li>
<li><a href="#recursion">Recursion</a>
<ul>
<li><a href="#recursion-and-induction">Recursion and Induction</a></li>
<li><a href="#some-basics">Some Basics</a></li>
<li><a href="#the-function-call-stack">The Function Call Stack</a></li>
<li><a href="#the-fibonacci-sequence">The Fibonacci Sequence</a></li>
<li><a href="#euclids-algorithm">Euclid&apos;s Algorithm</a></li>
</ul>
</li>
<li><a href="#dynamic-programming">Dynamic Programming</a>
<ul>
<li><a href="#a-greedy-algorithm">A Greedy Algorithm</a></li>
<li><a href="#a-recursive-algorithm">A Recursive Algorithm</a></li>
<li><a href="#a-memoized-version">A Memoized Version</a></li>
<li><a href="#a-dynamic-programming-algorithm">A Dynamic Programming Algorithm</a></li>
<li><a href="#another-example">Another example</a></li>
</ul>
</li>
<li><a href="#binary-search">Binary Search</a>
<ul>
<li><a href="#the-sorted-list-adt">The Sorted List ADT</a></li>
</ul>
</li>
<li><a href="#sorting">Sorting</a>
<ul>
<li><a href="#the-quadratic-time-sorting-algorithms">The Quadratic-Time Sorting Algorithms</a></li>
<li><a href="#sorting-in-python">Sorting in Python</a></li>
</ul>
</li>
<li><a href="#sorting-with-divide-and-conquer">Sorting with Divide and Conquer</a>
<ul>
<li><a href="#mergesort">Mergesort</a>
<ul>
<li><a href="#an-analysis">An Analysis</a></li>
<li><a href="#merging-iterators">Merging Iterators</a></li>
</ul>
</li>
<li><a href="#quicksort">Quicksort</a></li>
</ul>
</li>
<li><a href="#selection">Selection</a>
<ul>
<li><a href="#the-quickselect-algorithm">The <code>quickselect</code> algorithm</a></li>
<li><a href="#analysis">Analysis</a></li>
<li><a href="#one-last-time-without-recursion">One last time without recursion</a></li>
<li><a href="#divide-and-conquer-recap">Divide-and-Conquer Recap</a></li>
<li><a href="#a-note-on-derandomization">A Note on Derandomization</a></li>
</ul>
</li>
<li><a href="#mappings-and-hash-tables">Mappings and Hash Tables</a>
<ul>
<li><a href="#the-mapping-adt">The Mapping ADT</a></li>
<li><a href="#a-minimal-implementation">A minimal implementation</a></li>
<li><a href="#the-extended-mapping-adt">The extended Mapping ADT</a></li>
<li><a href="#its-too-slow">It&apos;s Too Slow!</a>
<ul>
<li><a href="#how-many-buckets-should-we-use">How many buckets should we use?</a></li>
<li><a href="#rehashing">Rehashing</a></li>
</ul>
</li>
<li><a href="#factoring-out-a-superclass">Factoring Out A Superclass</a></li>
</ul>
</li>
<li><a href="#trees">Trees</a>
<ul>
<li><a href="#some-more-definitions">Some more definitions</a></li>
<li><a href="#a-recursive-view-of-trees">A recursive view of trees</a></li>
<li><a href="#tree-traversal">Tree Traversal</a></li>
<li><a href="#if-you-want-to-get-fancy">If you want to get fancy...</a>
<ul>
<li><a href="#theres-a-catch">There&apos;s a catch!</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#binary-search-trees">Binary Search Trees</a>
<ul>
<li><a href="#the-sorted-mapping-adt">The Sorted Mapping ADT</a></li>
<li><a href="#binary-search-tree-properties-and-definitions">Binary Search Tree Properties and Definitions</a></li>
<li><a href="#a-minimal-implementation-1">A Minimal implementation</a>
<ul>
<li><a href="#the-floor-function">The <code>floor</code> function</a></li>
<li><a href="#iteration">Iteration</a></li>
</ul>
</li>
<li><a href="#removal">Removal</a></li>
</ul>
</li>
<li><a href="#balanced-binary-search-trees">Balanced Binary Search Trees</a>
<ul>
<li><a href="#a-bstmapping-implementation">A <code>BSTMapping</code> implementation</a>
<ul>
<li><a href="#forward-compatibility-of-factories">Forward Compatibility of Factories</a></li>
</ul>
</li>
<li><a href="#weight-balanced-trees">Weight Balanced Trees</a></li>
<li><a href="#height-balanced-trees-avl-trees">Height-Balanced Trees (AVL Trees)</a></li>
<li><a href="#splay-trees">Splay Trees</a></li>
</ul>
</li>
<li><a href="#priority-queues">Priority Queues</a>
<ul>
<li><a href="#the-priority-queue-adt">The Priority Queue ADT</a></li>
<li><a href="#using-a-list">Using a list</a></li>
<li><a href="#heaps">Heaps</a></li>
<li><a href="#storing-a-tree-in-a-list">Storing a tree in a list</a></li>
<li><a href="#building-a-heap-from-scratch">Building a Heap from scratch</a></li>
<li><a href="#changing-priorities">Changing priorities</a></li>
</ul>
</li>
<li><a href="#graphs">Graphs</a>
<ul>
<li><a href="#a-graph-adt">A Graph ADT</a></li>
<li><a href="#the-edgesetgraph-implementation">The <code>EdgeSetGraph</code> Implementation</a></li>
<li><a href="#the-adjacencysetgraph-implementation">The <code>AdjacencySetGraph</code> Implementation</a></li>
<li><a href="#paths-and-connectivity">Paths and Connectivity</a></li>
</ul>
</li>
<li><a href="#graph-search">Graph Search</a>
<ul>
<li><a href="#depth-first-search">Depth-First Search</a></li>
<li><a href="#removing-the-recursion">Removing the Recursion</a></li>
<li><a href="#breadth-first-search">Breadth-First Search</a></li>
<li><a href="#weighted-graphs-and-shortest-paths">Weighted Graphs and Shortest Paths</a></li>
<li><a href="#prims-algorithm-for-minimum-spanning-trees">Prim&apos;s Algorithm for Minimum Spanning Trees</a></li>
<li><a href="#an-optimization-for-priority-first-search">An optimization for Priority-First search</a></li>
</ul>
</li>
</ul>
</div>
      <a id="sidebar-toc-btn">&#x2261;</a>
    
    
    
    
    
    
    
    
<script>

var sidebarTOCBtn = document.getElementById('sidebar-toc-btn')
sidebarTOCBtn.addEventListener('click', function(event) {
  event.stopPropagation()
  if (document.body.hasAttribute('html-show-sidebar-toc')) {
    document.body.removeAttribute('html-show-sidebar-toc')
  } else {
    document.body.setAttribute('html-show-sidebar-toc', true)
  }
})
</script>
      
  
    </body></html>